<div #postReplySection id="post_reply"class="post-reply">
  <div class="post-reply__head" *ngIf="inBottomSheet">
    <span *ngIf="!onlyEscalation; else escalateText" [ngClass]="{'small_font-size' : !defaultLayout}" class="post-reply__head--title">{{ bulkmessage }}</span>
    <ng-template #escalateText>
      <span [ngClass]="{'small_font-size' : !defaultLayout}" class="post-reply__head--title">{{ bulkmessage}}</span>
    </ng-template>
    <span class="post-reply__head--action right-auto">
      <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" (click)="closePostReply()">close</mat-icon>
    </span>
  </div>
  <form novalidate (ngSubmit)="saveReply()" [formGroup]="replyForm">
    <div class="post-reply__body post__reply--block--body">
      <!-- Post Reply  -->
      <div class="post__reply--block--conversation" [ngClass]="{'mt-8' : defaultLayout}" fxLayout="row" *ngIf="
          (showReplySection && !onlySendMail) ||
          (isEmailChannel && showEscalateview && !onlySendMail) || (isEmailChannel && showReplyAssignView && !onlySendMail)"
          [ngClass]="{'small_font-size ai-layout' : !defaultLayout}">
        <div class="custom__column custom__column--left right-border" fxFlex="30%">
          <ng-template [ngIf]="!showEscalateview && !isEmailChannel && !showReplyAssignView">
            <ng-template [ngIf]="this.ticketReplyDTO.replyOptions">
              <mat-form-field class="material__select material__select--adaptive h-55" appearance="outline"
                [disabled]="ssreSimulationRight ? 'true' : null">
                <mat-label [ngClass]="{'small_font-size' : !defaultLayout}">{{'Reply-Type' | translate}}</mat-label>
                <mat-select [ngClass]="{'small_font-size' : !defaultLayout}" formControlName="replyType" [(ngModel)]="selectedReplyType" 
                  (selectionChange)="replyTypeChange($event.value)">
                  <ng-container *ngFor="let item of this.ticketReplyDTO.replyOptions">

                    <ng-container *ngIf="item.id == 5 && currentUser?.data?.user?.actionButton?.ticketEscalationEnabled">
                      <mat-option [ngClass]="{'small_font-size' : !defaultLayout}" [value]="item.id"> {{ item.value | translate }} </mat-option>
                    </ng-container>
                
                    <ng-container *ngIf="item.id == 18 && (currentUser?.data?.user?.actionButton?.assignmentEnabled || currentUser?.data?.user?.actionButton?.allowAssignment)">
                      <mat-option [ngClass]="{'small_font-size' : !defaultLayout}" [value]="item.id"> {{ item.value | translate }} </mat-option>
                    </ng-container>
                    
                    <ng-container *ngIf="item.id != 5 && item.id != 18 ">
                      <mat-option [ngClass]="{'small_font-size' : !defaultLayout}" [value]="item.id"> {{ item.value | translate }} </mat-option>
                    </ng-container>

                  </ng-container>
                
                </mat-select>
              </mat-form-field>
            </ng-template>
            <ng-template [ngIf]="this.ticketReplyDTO.handleNames && this.ticketReplyDTO.handleNames.length > 0">
              <mat-form-field class="material__select material__select--adaptive pr-0 h-55" appearance="outline">
                <mat-label [ngClass]="{'small_font-size' : !defaultLayout}">{{'Reply-Handle' | translate}}</mat-label>
                <mat-select [ngClass]="{'small_font-size' : !defaultLayout}" formControlName="replyHandler" (selectionChange)="replyHandleChanged()">
                  <mat-option [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let item of this.ticketReplyDTO.handleNames" [value]="item.socialId">{{
                    item.handleName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ng-template>
            <ng-container *ngIf="handlesLoader">
              <div class="component__loader" [@fadeInOut]>
                <div class="loader__content">
                  <div class="loader__content--info d-flex-items-center">
                    <div class="loader__content--info--line w-250 h-45"></div>
                  </div>
                </div>
              </div>
            </ng-container>
          </ng-template>
          <div cdkScrollable [ngClass]="{'element__disable': csdUserId>0}"
            [disabled]="ssreSimulationRight  ? 'true' : null" [style.display]="showEscalateview ? 'flex' : 'none'"
            class="position-relative">
            <!-- <label class="text__label">Reply Handle</label> -->
            <app-assign-user-dropdown *ngIf="ticketReplyDTO.autoQueueConfig && customAgentList" class="border--right--none" formControlName="escalateUsers"
              [value]="escalateUsers | translate" [applyForAIModel]="true" [options]="customAgentList"
              [queuesettings]="ticketReplyDTO.autoQueueConfig" [label]="escalationLabel" [postDetailTab]="postDetailTab"
              [showSortMenu]="true" [style.flex]="showEscalateview ? '1' : '1'" [loader]="userListLoading" [assignToPopup]="assignToPopup" [tagID]="baseMentionObj?.tagID"
              (selectedData)="setEscalateUsers($event)" style="width: 80%">
            </app-assign-user-dropdown>
            <mat-icon fontSet="material-icons-outlined" class="pl-4 mt-10" [ngClass]="{'small-icon-font-size' : !defaultLayout}" (click)="refreslList(true)" *ngIf="!userListLoading" style="cursor: pointer;">refresh</mat-icon>
            <ng-container *ngIf="!ticketReplyDTO.autoQueueConfig || !customAgentList">
              <div class="component__loader" [@fadeInOut]>
                <div class="loader__content h-0">
                  <div class="loader__content--info d-flex-items-center">
                    <div class="loader__content--info--line w-275 h-45"></div>
                  </div>
                </div>
              </div>
            </ng-container>
          </div>
          <div cdkScrollable  [ngClass]="{'element__disable': defaultAgentID>0}"
            [style.display]="showReplyAssignView ? 'inline' : 'none'" class="position-relative">
            <div class="d-flex-items-center w-100-p">
              <app-assign-user-dropdown formControlName="assignToName" [loader]="loadingUserList" [options]="assignTo | async"
                [label]="'Select-User' | translate" [applyForAIModel]="true" [value]="selectedAssignTo" [assignToPopup]="true" (selectedTeamData)="teamSelectedData = $event"
                (selectedData)="setAssigntoFromValue($event)" class="w-100-p">
              </app-assign-user-dropdown>
              <mat-icon fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="pl-4" style="margin-top: -0.8rem;cursor: pointer;" (click)="refreshAssignList()"
                *ngIf="!loadingUserList">refresh</mat-icon>
            </div>
          </div>
          <!-- <ng-container *ngIf="
              customAgentListAsync$ | async as customerAgentList;
              else NoUserData
            ">
            <div *ngIf="showEscalateview && customerAgentList?.length == 0">
              <mat-form-field appearance="outline" class="material__select material__select--adaptive">
                <mat-label>{{ escalationLabel }}</mat-label>
                <mat-select>
                  <mat-option> No User Found </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </ng-container> -->
          <!-- <mat-form-field [disabled]="ssreSimulationRight ? 'true' : null" [style.display]="showEscalateview ? 'block':'none'" appearance="outline">
                        <mat-label>Escalate To</mat-label>
                        <mat-select formControlName="escalateUsers">
                            <mat-option *ngFor="let item of customAgentList" [value]="item.agentID">{{ item.agentName }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field> -->
          

                    <ng-template [ngIf]="!showEscalateview && !isEmailChannel && !showReplyAssignView && !isBulkPostReply">
                      <mat-form-field class="material__select material__select--adaptive pr-0 conv-tag tag_type_inputs" appearance="outline"
                        [disabled]="ssreSimulationRight ? 'true' : null" *ngIf="taggedUsersAsync$ | async as taggedUsers">
                        <mat-label [ngClass]="{'small_font-size' : !defaultLayout}">{{'Tag-Users' | translate}}</mat-label>
                        <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #tagUserChipList class="chiplist-height__select">
                          <ng-container *ngFor="let item of selectedTagUsers">
                            <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="item.Checked" [selectable]="selectable" [removable]="!item?.Disabled"
                              (removed)="onTaggedUserChange({checked:false, source:{value : item.Userid}})">
                              {{item.Name}}
                              <mat-icon matChipRemove [ngClass]="{'small-icon-font-size' : !defaultLayout}" *ngIf="!item?.Disabled" class="pl-4 pr-0">cancel</mat-icon>
                            </mat-chip-row>
                          </ng-container>
                          <input #searchTagUser [ngClass]="{'small_font-size' : !defaultLayout}" placeholder="{{ 'Search-Users' | translate }}" [matChipInputFor]="tagUserChipList"
                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matAutocomplete]="tagUserList"
                            (input)="onSearchTagUser($event)">
                          <mat-autocomplete #tagUserList="matAutocomplete"
                            (optionSelected)="onTaggedUserChange({checked:true, source:{value : $event?.option?.value?.Userid || ''}})" (closed)="searchTagUser.value = ''">
                            <ng-container *ngFor="let item of taggedUsersAsync$ | async">
                              <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="!item.Checked" [value]="item">
                                {{ item?.Name }}
                              </mat-option>
                            </ng-container>
                          </mat-autocomplete>
                        </mat-chip-grid>
                      </mat-form-field>
                    </ng-template>

          <!-- new place UI left side -->
          <!-- <ng-template [ngIf]="!showEscalateview && !isEmailChannel && !showReplyAssignView">
            <div [disabled]="ssreSimulationRight ? 'true' : null" *ngIf="taggedUsersAsync$ | async as taggedUsers"
              class="d-flex-items-center mb-12 custom__column--replyTag pl-0">
              <label class="text__label--sm mr-12">Tag Users : </label>
              <div *ngFor="let item of taggedUsers" class="input__wrapper input__wrapper--sm">
                <mat-checkbox [disabled]="
                    item.Disabled || ssreSimulationRight ? 'true' : null
                  " [value]="item.Userid" [checked]="item.Checked" (change)="onTaggedUserChange($event)"><span
                    class="text__regular--sm">{{
                    item.Name
                    }}</span></mat-checkbox>
              </div>
            </div>
          </ng-template> --> 
          <!-- <mat-form-field *ngIf="selectedTicketView==1" appearance="outline" class="send-email__item material__select">
            <mat-label>Tag Users</mat-label>
            <mat-select formControlName="replyType" [(ngModel)]="selectedReplyType" 
              (selectionChange)="replyTypeChange($event.value)">
          
              <ng-container *ngFor="let item of this.ticketReplyDTO.replyOptions">
          
                <ng-container *ngIf="item.id == 5 && ticketHistoryData?.actionButton?.ticketEscalationEnabled">
                  <mat-option [value]="item.id"> {{ item.value }} </mat-option>
                </ng-container>
          
                <ng-container
                  *ngIf="item.id == 18 && (ticketHistoryData?.actionButton.assignmentEnabled || ticketHistoryData?.actionButton?.allowAssignment)">
                  <mat-option [value]="item.id"> {{ item.value }} </mat-option>
                </ng-container>
          
                <ng-container *ngIf="item.id != 5 && item.id != 18 ">
                  <mat-option [value]="item.id"> {{ item.value }} </mat-option>
                </ng-container>
          
              </ng-container>
          
            </mat-select>
          </mat-form-field> -->
          <!-- <ng-container>
            <div class="component__loader" [@fadeInOut]>
              <div class="loader__content">
                <div class="loader__content--info d-flex-items-center">
                  <div class="loader__content--info--line w-20 h-20"></div>
                  <div class="loader__content--info--line w-80 h-10 ml-12"></div>
                  <div class="loader__content--info--line w-20 h-20 ml-30"></div>
                  <div class="loader__content--info--line w-80 h-10 ml-12"></div>
                </div>
              </div>
            </div>
          </ng-container> -->
        </div>
        <div #postReplyScroll class="custom__column custom__column--right flex-parent right-scroll" fxFlex="70%">
          <!-- <div class="ai-note" *ngIf="isAICaution">
              <p><span class="text__label ai-note__title">Caution: </span> <span class="ai-note__note">{{cautionText}}</span></p>
              <mat-icon fontSet="material-icons-outlined" class="cursor-pointer" (click)="this.isAICaution = false">close</mat-icon>
          </div> -->
          <!-- <app-reply-loader></app-reply-loader> -->
          <!-- <ng-template [ngIf]="!showEscalateview && !isEmailChannel">
                        <div [disabled]="ssreSimulationRight ? 'true' : null" *ngIf="taggedUsersAsync$ | async as taggedUsers" class="d-flex-items-center mb-20">
                            <label class="text__label">Tag Users : </label>
                            <div *ngFor="let item of taggedUsers" class="input__wrapper input__wrapper--sm ml-12">
                                <mat-checkbox [disabled]="item.Disabled || ssreSimulationRight ? 'true' : null" [value]="item.Userid" [checked]="item.Checked" (change)="onTaggedUserChange($event)">{{ item.Name }}</mat-checkbox>
                            </div>
                        </div>
                    </ng-template> -->
          <div class="d-flex-items-center g-8 flex-container__item-wrap" [ngClass]="{'pb-10' : defaultLayout, 'pb-5' : !defaultLayout}" *ngIf="!showEscalateview && !isEmailChannel && !showReplyAssignView && !isBulkPostReply && unSelectedTagUsers?.length > 0">
            <span class="d-flex-items-center">
              <span class="font-weight-500" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Following-Users-Not-Tagged' | translate}}</span>
              <img matTooltip="{{'Users-Not-Tagged-Tooltip' | translate}}"
              matTooltipClass="custom__tooltip-normal " class="ml-5 w-12" src="assets/images/account-profile/info-button-grey.svg"
              [ngClass]="{'small-image-width' : !defaultLayout}">
            </span>
            <ng-container *ngFor="let item of unSelectedTagUsers">
              <span class="custom__pill--round" [ngClass]="{'font-size-14' : defaultLayout, 'small_font-size' : !defaultLayout}" *ngIf="!(item.Checked)">
                &#64;<span>{{item.Name}}</span>
                <mat-icon class="ml-2 colored__main--light cursor-pointer s-14" [ngClass]="{'small-icon-font-size' : !defaultLayout}" (click)="onTaggedUserChange({checked:true, source:{ value: item.Userid }})">close</mat-icon>
              </span>
            </ng-container>
          </div>
          <div class="textarea-featured flex-parent__main" *ngIf="!showEscalateview && !showReplyAssignView">
            <div [disabled]="ssreSimulationRight ? 'true' : null" class="textarea-featured__body"
              [ngClass]="{ 'mt-10': textAreaCount.length > 1 }" *ngIf="!isEmailChannel" #newTextArea>
              <!-- <textarea formControlName="replyText" [(ngModel)]="replyTextInitialValue" [maxlength]="this.ticketReplyDTO.maxlength" rows="5" (input)="ReplyInputChanges($event)" class="textarea-featured__input customClassReplyText"></textarea>

                                <a class="textarea-featured__emoji"  [matMenuTriggerFor]="emojiMenu" mat-icon-button href="javacript:void(0)">
                                    <mat-icon>sentiment_satisfied_alt</mat-icon>
                                </a>
                                <mat-menu #emojiMenu="matMenu" class="custom__matmenu"  xPosition="before" yPosition="above">
                                    <div (click)="$event.stopPropagation();$event.preventDefault();">
                                        <emoji-mart [set]="emojiSet" [emojisToShowFilter]="filterEmojis" [showPreview]="false" (emojiSelect)="selectEmoji($event)"></emoji-mart>
                                    </div>
                                </mat-menu> -->

              <!-- new place UI for textarea -->
              <!-- <ng-template ngFor let-item [ngForOf]="textAreaCount"> -->
              <div *ngFor="
                  let item of textAreaCount;
                  let index = index;
                  trackBy: trackByIndex
                ">
                <div class="textarea-featured__block position-relative compose-post__container--textarea" #textAreaDiv>
                  <!-- <textarea formControlName="replyText" [(ngModel)]="replyTextInitialValue" (input)="ReplyInputChanges($event)" class="textarea-featured__input customClassReplyText"></textarea>   -->
                  <!-- <textarea [ngModelOptions]="{standalone: true}" (paste)="ReplyInputChangesModified($event,item.id)" [maxlength]="item.maxPostCharacters"  [(ngModel)]="textAreaCount[index].text" (input)="ReplyInputChangesModified($event,item.id)"  class="textarea-featured__input customClassReplyText" #txtArea>{{item.text}}</textarea>  -->
                  <textarea [ngModelOptions]="{ standalone: true }" [(ngModel)]="item.text" (click) = "$event.stopPropagation();"
                    [maxlength]="baseMentionObj.channelGroup == channelGroup?.GoogleBusinessMessages ? 3072 :baseMentionObj.channelGroup == channelGroup?.AppStoreReviews ? 4000:  null"
                    (keydown)="eventHandler($event,index)" (itemSelected)="itemSelected($event)" [mention]="twitterHandleList" [id]='index' #txtArea
                    [ngClass]="[
                      baseMentionObj.channelGroup == channelGroup?.GoogleBusinessMessages ? 'mb-10' : 'mb-30',
                      !defaultLayout ? 'small_font-size' : ''
                    ]" class="textarea-featured__input customClassReplyText position-relative h-95 pb-0" (searchTerm)="searchitem($event)"
                    (input)="baseMentionObj.channelGroup == channelGroup.Twitter?inputReplyEvent($event, item.id,'remove',index):ReplyInputChangesModified($event, item.id,'remove',index)"
                    [placeholder]="rephraseLoaderForTextarea ? '': ('Write-Reply' | translate)" [mentionListTemplate]="mentionListTemplate"
                    [mentionConfig]="{labelKey:this.currentUser?.data?.user?.categoryId == 1905 ? 'code': 'screen_name', disableSearch:	true,mentionSelect: itemMentioned, allowSpace:true,triggerChar:'@'}">{{ item.text }}
                  </textarea>
                  <span class="max-length" *ngIf = "baseMentionObj.channelGroup == channelGroup?.GoogleBusinessMessages">{{item.text.length}} / 3072</span>
                    <ng-template #mentionListTemplate let-item="item">
                      <ng-container  *ngIf="currentUser?.data?.user?.categoryId != 1905">
                          <img class="mr-3" [ngClass]="{'small-image-width' : !defaultLayout}" src="{{ item.profile_image_url?item.profile_image_url:'assets/images/agentimages/sample-image.svg' }}"
                            alt="" width="50" height="50" />
                          &nbsp;
                          <span [ngClass]="{'small_font-size' : !defaultLayout}">{{ item.screen_name }}</span>
                      </ng-container>
                      <span [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="currentUser?.data?.user?.categoryId == 1905">{{ item.handle + " (" + item.zone +") " }}</span>
                    </ng-template>
                  <app-component-loader class="message__line--loader" *ngIf="rephraseLoaderForTextarea" [postCountTotal]="2" [loaderType]="loaderTypeEnum.messageline" [rephraseLoader]="true">
                  </app-component-loader>

                  <div class="textarea-featured__left d-flex-items-center">
                    <a class="textarea-featured__left--emoji" matTooltip="{{'Emoji' | translate}}"
                    matTooltipClass="custom-tooltip" matTooltipPosition="above" mat-icon-button
                    [ngClass]="[
                      defaultLayout ? 'mt-11' : 'd-flex-items-center justify-content__center',
                      layout == 'ltr' ? 'ml-2' : '',
                      layout == 'rtl' ? 'mr-2' : ''
                    ]"
                    [matMenuTriggerFor]="emojiMenu" href="javascript:void(0)">
                      <mat-icon [ngClass]="{'d-flex-items-center justify-content__center' : !defaultLayout}">sentiment_satisfied_alt</mat-icon>
                    </a>

                    <ng-container *ngIf="showAiFeature && loadAiFeature && isRephraseToolbar && !this.showAICreditExpired; else otherRephraseIcon">
                      <img [src]="AIFeatureStyleObj?.rephraseIcon" class="cursor-pointer w-18" [ngClass]="{'element__disable': !item.text && item.text.length <= 0, 'small-image-width': !defaultLayout}"
                        (click)="setSelectText( false, false); $event.stopPropagation(); openRephrasePopup(index);"
                        [id]="'rephrase_'+ index " [matTooltip]="AIFeatureStyleObj?.rephraseTootip"
                        [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip" matTooltipClass="custom-tooltip">
                    </ng-container>

                    <ng-template #otherRephraseIcon>
                      <img class="w-18" [src]="AIFeatureStyleObj?.rephraseIcon" [matTooltip]="AIFeatureStyleObj?.rephraseTootip"
                            [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip" [ngClass]="{'small-image-width' : !defaultLayout}" matTooltipClass="custom-tooltip">
                    </ng-template>
                    
                    <ng-container *ngIf="AIFeatureStyleObj?.suggestIcon && !isBulkPostReply">
                      <ng-container
                        *ngIf="showAiFeature && rephraseOptions?.isAISuggestion && loadAiFeature && !this.showAICreditExpired; else otherSuggestIcon">
                        <span  (click)="openAISmartSuggestion($event);aiMessageFeedback = 2" class="d-flex-items-center">
                            <img [src]="AIFeatureStyleObj?.suggestIcon" (click) = "aiMessageFeedback = 2"
                              [ngClass]="{
                                'element__disable': aiSuggestionLoader,
                                'w-20': defaultLayout,
                                'small-image-width': !defaultLayout,
                                'ml-13': layout == 'ltr',
                                'mr-13': layout == 'rtl'
                              }" class="cursor-pointer aiSmartSuggesionMenu" [matMenuTriggerFor]="showLockStrip ? '' :menu"
                              [matTooltip]="AIFeatureStyleObj?.suggestTootip" [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip"
                              matTooltipClass="custom-tooltip" [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip"
                              (menuOpened)="validate()" (menuClosed)="removeCloneBackdrop()"/>
                        </span>
                      </ng-container>
                      <ng-template #otherSuggestIcon>
                                              <img class="w-20" [src]="AIFeatureStyleObj?.suggestIcon"
                                                [ngClass]="{ element__disable: aiSuggestionLoader, 'small-image-width': !defaultLayout }" class="cursor-pointer ml-13" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                            [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip" />
                      </ng-template>
                    </ng-container>

                    <!-- <ng-template> -->
                      <img class="w-20 cursor-pointer" [ngClass]="{'small-image-width' : !defaultLayout, 'ml-13' : layout == 'ltr', 'mr-13' : layout == 'rtl'}"
                        (click)="openCannedResponse(index)" src="assets/images/chatbot/canned.svg" matTooltip="{{'Canned-Response' | translate}}"
                        matTooltipClass="custom-tooltip">
                    <!-- </ng-template> -->

                    <ng-container *ngIf="showMediaButton">
                      <a matTooltip="{{'Attach-Media' | translate}}" matTooltipClass="custom-tooltip" href="javascript:void(0)"
                        [ngClass]="{'element__disable' : ssreSimulationRight, 'ml-13' : layout == 'ltr', 'mr-13' : layout == 'rtl'}" (click)="openMediaDialog()">
                        <mat-icon class="s-22" fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size' : !defaultLayout}" style="color:var(--color-light-text)">insert_photo</mat-icon>
                      </a>
                    </ng-container>

                    <ng-container
                      *ngIf="currentUser?.data?.user?.categoryId == 1596 && (baseMentionObj.channelGroup == channelGroup.AppStoreReviews || baseMentionObj.channelGroup == channelGroup.GooglePlayStore)">
                      <mat-icon matTooltip="{{'Generate-MMT-Link' | translate}}"
                        [ngClass]="{
                          'small-icon-font-size': !defaultLayout,
                          'element__disable': mmtLinkLoader,
                          'ml-8' : layout == 'ltr',
                          'mr-8' : layout == 'rtl'
                        }" 
                        class="cursor-pointer colored__locobuzz" (click)="onTaggedMMTLink()">link</mat-icon>
                      <mat-spinner [diameter]="15" *ngIf="mmtLinkLoader" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="loader-spinner ml-5">
                      </mat-spinner>
                    </ng-container>
                  
                    <div class="block-center" (click)="$event.stopPropagation();" matTooltip="{{'Prompt' | translate}}"
                      [ngClass]="{'element__disable': rephraseLoader, 'ml-10' : layout == 'ltr', 'mr-10' : layout == 'rtl'}">

                      <!-- <mat-slide-toggle class="ml-auto " matTooltip="AISmartSuggestion" [(ngModel)]="showAISmartSuggestion"
                        (change)="openAISmartSuggestion($event)"></mat-slide-toggle> -->

                    </div>

                    <span *ngIf="item.showAttachmentText" class="textarea-featured__left--warn tooltip">
                      <mat-icon class="cursor-pointer" [ngClass]="{'small-icon-font-size' : !defaultLayout}">error_outline</mat-icon>
                      <span class="tooltiptext" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Attachment-Linked' | translate}}</span>
                    </span>
                  </div>
                  <div class="textarea-featured__right">
                    <!-- <span *ngIf="item.showAddNewReply" class="hover__text--blue" style="cursor: pointer"
                      (click)="addNewElement(item.id)">Add New Reply
                      <span class="ml-8"> | </span>
                    </span> -->
                    <span *ngIf="item.showAddNewReply" matTooltip="{{'Add-New-Reply' | translate}}" matTooltipPosition="above" (click)="addNewElement(item.id)"
                      matTooltipClass="custom-tooltip" class="d-flex-items-center hover__text--blue w-20 h-20 bg__grey--light border-radius-100 s-16" style="cursor: pointer"
                      [ngClass]="{'mr-8' : layout == 'ltr', 'ml-8' : layout == 'rtl'}">
                      <mat-icon class="s-20" [ngClass]="{'small-icon-font-size' : !defaultLayout}">add</mat-icon>
                      <span [ngClass]="{'small_font-size' : !defaultLayout, 'ml-10' : layout == 'ltr', 'mr-10' : layout == 'rtl'}"> | </span>
                    </span>
                    <!-- <span class="ml-8" *ngIf="item.showPost">{{ item?.postCharacters}} Reply Characters remaining out
                      of {{ maxLengthInput }}
                      
                    </span>
                    <span class="ml-8" *ngIf="baseMentionObj.channelGroup==channelGroup.AppStoreReviews || baseMentionObj.channelGroup == channelGroup?.GoogleBusinessMessages">{{ item?.text?.length}} Reply Characters remaining out
                      of 4000
                      
                    </span> -->
                    <span [ngClass]="{'small_font-size' : !defaultLayout, 'ml-8 pl-12' : layout == 'ltr', 'mr-8 pr-12' : layout == 'rtl'}"
                      *ngIf="item.showPost">{{ item?.postCharacters}}/{{ maxLengthInput }}                    
                    </span>

                    <span [ngClass]="{'small_font-size' : !defaultLayout, 'ml-8 pl-12' : layout == 'ltr', 'mr-8 pr-12' : layout == 'rtl'}"
                      *ngIf="baseMentionObj.channelGroup==channelGroup.AppStoreReviews || baseMentionObj.channelGroup == channelGroup?.GoogleBusinessMessages">{{
                      item?.text?.length}}/4000                    
                    </span>
                    <!-- <span *ngIf = "item.showTotal" class="textarea-featured__right--character">{{maxLengthInput}} Total Characters remaining</span> -->
                  </div>
                  <mat-menu #emojiMenu="matMenu" class="custom__matmenu" xPosition="after" yPosition="above">
                    <div (click)="
                        $event.stopPropagation(); $event.preventDefault()
                      ">
                      <emoji-mart [set]="emojiSet" [enableSearch]="false"
                        [darkMode]="false" [emojisToShowFilter]="filteredEmojis" [showPreview]="false"
                        (emojiSelect)="selectEmoji($event, item.id)"></emoji-mart>
                    </div>
                  </mat-menu>
                  <span *ngIf="item.showSpan" [ngClass]="{'small_font-size' : !defaultLayout}" class="previewTextarea__count">{{
                    index + 1
                    }}/{{textAreaCount.length}}</span>
                </div>
              </div>
              <!-- </ng-template> -->
              <!-- <div class="textarea-featured__block">
                                    <textarea class="textarea-featured__input customClassReplyText"></textarea>
                                <div class="textarea-featured__left">
                                    <a class="textarea-featured__left--emoji"  [matMenuTriggerFor]="emojiMenu" mat-icon-button href="javacript:void(0)">
                                        <mat-icon>sentiment_satisfied_alt</mat-icon>
                                    </a>
                                    <span class="textarea-featured__left--warn"><mat-icon>error_outline</mat-icon> Attachment will be link with this reply</span>
                                </div>
                                <div class="textarea-featured__right">
                                    <span class="textarea-featured__right--character">0 post characters remaining</span>
                                </div>
                                <mat-menu #emojiMenu="matMenu" class="custom__matmenu"  xPosition="before" yPosition="above">
                                    <div (click)="$event.stopPropagation();$event.preventDefault();">
                                        <emoji-mart [set]="emojiSet" [showPreview]="false" (emojiSelect)="selectEmoji($event)"></emoji-mart>
                                    </div>
                                </mat-menu>
                                <span class="previewTextarea__count">1/2</span>
                                </div> -->
            </div>
            <!-- <div class="textarea-featured__body" *ngIf="isEmailChannel">
              <app-send-email></app-send-email>
            </div> -->
            <ng-container *ngIf="false"> <!-- false due to SFDC CRM -->
            <div class="textarea-featured__foot pl-0 mt-0" *ngIf="!isEmailChannel">
              <!-- new place UI -->
              <!-- <div class="textarea-featured__foot--item">
                                <a [ngClass]="{'element__disable' : ssreSimulationRight }" class="textarea-featured__foot--icon" href="javascript:void(0)" (click)="openMediaDialog()">
                                    <mat-icon fontSet="material-icons-outlined">insert_photo</mat-icon> Attached Media (2)
                                </a>
                                <a href="javascript:void(0)" class="textarea-featured__foot--icon">
                                    UGC
                                </a>
                            </div> -->
              <div class="textarea-featured__foot--item" *ngIf="showMediaButton">
                <!-- <a [ngClass]="{'element__disable' : ssreSimulationRight }" href="javascript:void(0)" (click)="openMediaDialog()">
                                    <mat-icon fontSet="material-icons-outlined">insert_photo</mat-icon>
                                </a> -->
                <a [ngClass]="{ element__disable: ssreSimulationRight }"
                  class="textarea-featured__foot--icon text__regular--sm" href="javascript:void(0)"
                  (click)="openMediaDialog()">
                  <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" fontSet="material-icons-outlined custom__icon--md">insert_photo</mat-icon>
                  <span [ngClass]="{'small_font-size' : !defaultLayout}">{{'Attach-Media' | translate}}</span>
                  <span [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="selectedMedia.length > 0">({{ selectedMedia.length }})</span>
                </a>
                <!-- <a href="javascript:void(0)" class="textarea-featured__foot--icon">
                                    UGC
                                </a> -->
              </div>
              <div class="ml-auto d-flex-items-center" [ngClass]="{ element__disable: aiSuggestionLoader}">
                <ng-container *ngIf="AIFeatureStyleObj?.suggestIcon">
                  <ng-container *ngIf="showAiFeature && rephraseOptions?.isAISuggestion && loadAiFeature && !this.showAICreditExpired; else otherSuggestIcon">
                    <div class="textarea-featured__foot--item" (click)="openAISmartSuggestion($event);aiMessageFeedback = 2">
                      <a href="javascript:void(0)" [matMenuTriggerFor]="showLockStrip ? '' :menu" class="textarea-featured__foot--boxed text__regular--sm" [ngStyle]="{'border': AIFeatureStyleObj?.suggestionBorder}" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                            [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip" (menuOpened)="validate()" (menuClosed)="removeCloneBackdrop()">
                        <img [src]="AIFeatureStyleObj?.suggestIcon" [ngClass]="{'m-3 ml-0': !showAICreditExpired && !showAICreditExpiredAlert, 'small-image-width': !defaultLayout}">
                        {{'Smart-Suggestions' | translate}}
                      </a>
                    </div>
                  </ng-container>
                  <ng-template #otherSuggestIcon>
                    <div class="textarea-featured__foot--item">
                      <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="textarea-featured__foot--boxed text__regular--sm" [ngStyle]="{'border': AIFeatureStyleObj?.suggestionBorder}" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                            [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip">
                        <img class="m-3" [src]="AIFeatureStyleObj?.suggestIcon" [ngClass]="{'m-3 ml-0': (!showAICreditExpired && !showAICreditExpiredAlert) ||(!rephraseOptions?.isAISuggestion), 'small-image-width': !defaultLayout}" >
                        {{'Smart-Suggestions' | translate}}
                      </a>
                    </div>
                  </ng-template>
                </ng-container>
              <!-- <div
                [ngClass]="{ element__disable: ssreSimulationRight || (autoSuggestionLoader || !showSuggestionButton)}"
                *ngIf="!isEmailChannel && currentBrand && currentBrand.isAutoSuggestionEnabled" class="textarea-featured__foot--item" (click)="openSmartSuggestion()">
                <a href="javascript:void(0)"
                  [ngClass]="{'colored__grey': !showSuggestionButton,'colored__blue':showSuggestionButton}" class="
                    textarea-featured__foot--boxed
                    text__regular--sm
                  ">Smart Suggestions</a>
                <mat-spinner [diameter]="15" *ngIf="autoSuggestionLoader" class="loader-spinner colore__locobuzz">
                </mat-spinner>
              </div> -->
              <div [ngClass]="{ element__disable: ssreSimulationRight}" class="textarea-featured__foot--item"
                (click)="openCannedResponse()">
                <a [ngClass]="{'small_font-size' : !defaultLayout}" href="javascript:void(0)" class="text__regular--sm textarea-featured__foot--boxed">
                  {{'Canned-Response' | translate}}</a>
              </div>

              </div>
              <!-- <div class="textarea-featured__foot--item">
                                <span *ngIf="ticketReplyDTO.maxlength != 8000 &&  !isEmailChannel" class="colored__grey--light" style="color:red !important;"> {{
                  maxLengthInput }} CHARACTERS</span>
                            </div> -->

              <!-- <ng-container>
                <div class="component__loader w-100-p" [@fadeInOut]>
                  <div class="loader__content">
                    <div class="loader__content--info d-flex-items-center mb-8">
                      <div class="loader__content--info--line w-100 h-20"></div>
                      <div class="loader__content--info--line w-100 h-20 ml-auto"></div>
                      <div class="loader__content--info--line w-100 h-20 ml-25"></div>
                    </div>
                    <div class="loader__content--info d-flex-items-center">
                      <div class="loader__content--info--line w-15 h-15"></div>
                      <div class="loader__content--info--line w-60 h-10 ml-12"></div>
                      <div class="loader__content--info--line w-15 h-15 ml-30"></div>
                      <div class="loader__content--info--line w-60 h-10 ml-12"></div>
                      <div class="loader__content--info--line w-15 h-15"></div>
                      <div class="loader__content--info--line w-60 h-10 ml-12"></div>
                    </div>
                  </div>
                </div>
              </ng-container> -->

            </div>
            </ng-container>
            <!-- new place UI for attached Media-->
            <div [ngClass]="{ element__disable: ssreSimulationRight }"
              *ngIf="mediaSelectedAsync$ | async as MediaSelected" class="textarea-featured__foot--item--media">
              <ng-template ngFor let-ugc [ngForOf]="MediaSelected">
                <span *ngIf="ugc.mediaType == 2" class="textarea-featured__foot--item--icon"
                  matTooltip="{{ugc?.displayFileName}}">
                  <img class="media__img--icon" [ngClass]="{'small-icon-font-size' : !defaultLayout}" [src]="ugc.mediaPath" alt="" />
                  <span class="item__overlay">
                    <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                  </span>
                </span>
                <span *ngIf="ugc.mediaType == 3 || ugc.mediaType == 7" class="textarea-featured__foot--item--icon"
                  matTooltip="{{ugc?.displayFileName}}">
                  <video class="media__img--icon">
                    <source [src]="ugc.mediaPath" data-autoplay="false" type="video/m4v" />
                    <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mp4" />
                    <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mpeg" />
                    <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-msvideo" />
                    <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-ms-wmv" />
                    <source [src]="ugc.mediaPath" data-autoplay="false" type="video/avi" />
                  </video>
                  <span class="item__overlay--video">
                    <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                    <mat-icon class="play__img--icon">play_circle_outline</mat-icon>
                  </span>
                </span>
                <span
                  *ngIf="ugc.mediaType == mediaTypeEnum.PDF || ugc.mediaType == mediaTypeEnum.DOC || ugc.mediaType == mediaTypeEnum.EXCEL"
                  class="textarea-featured__foot--item--icon" matTooltip="{{ugc?.displayFileName}}">
                  <img src="assets/images/common/pdf.png" *ngIf="ugc.mediaType == mediaTypeEnum.PDF"
                    class="media__img--icon">
                  <img src="assets/images/common/word.png" *ngIf="ugc.mediaType == mediaTypeEnum.DOC"
                    class="media__img--icon">
                  <img src="assets/images/common/excel-file.png" *ngIf="ugc.mediaType == mediaTypeEnum.EXCEL"
                    class="media__img--icon">

                  <span class="item__overlay">
                    <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                  </span>
                </span>

              </ng-template>
            </div>
            <p [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="caption" class="caption"><b>{{'Caption' | translate}}:</b> {{caption}}</p>

            <div [ngClass]="{ element__disable: ssreSimulationRight }" class="input__wrapper input__wrapper--gap"
              *ngIf="replyLinkCheckbox && !showEscalateview && !showReplyAssignView && !showGroupsView && !isEmailChannel">
               <ng-container *ngFor="let item of replyLinkCheckbox">
                  <mat-checkbox [checked]="item.checked" [value]="item.replyLinkId" [ngClass]="defaultLayout ? 'checkbox_align' : ''"
                    *ngIf = "(selectedReplyType == ActionStatusEnum?.ReplyAndClose && item?.name == 'Send Feedback') || item.name != 'Send Feedback'"  
                    [disabled]="item.disabled || ssreSimulationRight ? 'true' : null" (change)="onReplyLinkChange($event,item.name)">
                    <span class="text__regular--sm" [ngClass]="{'small_font-size' : !defaultLayout}">{{ item.name | translate }}</span>
                      <mat-icon matTooltipPosition="above" matTooltipClass="custom-tooltip " [ngClass]="{'small-icon-font-size mt-5' : !defaultLayout}" class="ml-7" aria-label="remove_red_eye"
                        matTooltip="{{'Send-Feedback-Tooltip' | translate}}"
                        *ngIf="item.name=='Send Feedback' && item.checked && !item.disabled && (baseMentionObj.channelType==channelType.DirectMessages || baseMentionObj.channelType==channelType.FBMessages) "
                        >remove_red_eye
                      </mat-icon>
                  </mat-checkbox>
               </ng-container>
            </div>
          </div>
          <div class="textarea-featured flex-parent__main" [style.display]="showEscalateview ? 'block' : 'none'">
            <div class="textarea-featured__body mb-12">
              <textarea formControlName="replyEscalateNote"rows="5" class="border__light-grey textarea-featured__input"
                [placeholder]="escalationPlaceholder | translate" (input)="noteTextChange('replyEscalateNote')" [ngClass]="{'small_font-size' : !defaultLayout}" autofocus></textarea>
                <app-attach-media class="w-full" *ngIf="baseMentionObj" [postData]="baseMentionObj" [postDetailTab]="postDetailTab"></app-attach-media>

                  <!-- <a [ngClass]="{ element__disable: ssreSimulationRight }"
                    class="textarea-featured__foot--icon textarea-featured__foot--item" href="javascript:void(0)"
                    (click)="openMediaDialog()">
                    <mat-icon fontSet="material-icons-outlined">insert_photo</mat-icon>
                    <span>Attach Media</span>
                    <span *ngIf="selectedMedia.length > 0">({{ selectedMedia.length }})</span>
                  </a>
                    <div [ngClass]="{ element__disable: ssreSimulationRight }" *ngIf="mediaSelectedAsync$ | async as MediaSelected"
                      class="textarea-featured__foot--item--media pt-10">
                      <ng-template ngFor let-ugc [ngForOf]="MediaSelected">
                        <span *ngIf="ugc.mediaType == 2" matTooltip="{{ugc?.displayFileName}}" class="textarea-featured__foot--item--icon">
                          <img class="media__img--icon" [src]="ugc.mediaPath" alt="" />
                          <span class="item__overlay">
                            <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                          </span>
                        </span>
                        <span *ngIf="ugc.mediaType == 3" matTooltip="{{ugc?.displayFileName}}" class="textarea-featured__foot--item--icon">
                          <video class="media__img--icon">
                            <source [src]="ugc.mediaPath" data-autoplay="false" type="video/m4v" />
                            <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mp4" />
                            <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mpeg" />
                            <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-msvideo" />
                            <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-ms-wmv" />
                            <source [src]="ugc.mediaPath" data-autoplay="false" type="video/avi" />
                          </video>
                          <span class="item__overlay--video">
                            <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                            <mat-icon class="play__img--icon">play_circle_outline</mat-icon>
                          </span>
                        </span>
                        <span matTooltip="{{ugc?.displayFileName}}"
                          *ngIf="ugc.mediaType == mediaTypeEnum.PDF || ugc.mediaType == mediaTypeEnum.DOC || ugc.mediaType == mediaTypeEnum.EXCEL"
                          class="textarea-featured__foot--item--icon">
                          <img src="assets/images/common/pdf.png" *ngIf="ugc.mediaType == mediaTypeEnum.PDF" class="media__img--icon">
                          <img src="assets/images/common/word.png" *ngIf="ugc.mediaType == mediaTypeEnum.DOC" class="media__img--icon">
                          <img src="assets/images/common/excel-file.png" *ngIf="ugc.mediaType == mediaTypeEnum.EXCEL"
                            class="media__img--icon">
                          <span class="item__overlay">
                            <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                          </span>
                        </span>
                      </ng-template>
                    </div> -->
              <!-- <textarea class="textarea-featured__input"></textarea> -->
            </div>
            <div [ngClass]="{ element__disable: ssreSimulationRight }" class="input__wrapper fdsf" *ngIf="
                replyLinkCheckbox &&
                !showGroupsView &&
                !isEmailChannel &&
                !chatBotView &&
                (baseMentionObj.channelGroup != channelGroup.Voice)
              ">
              <ng-container *ngFor="let item of replyLinkCheckbox">
                <mat-checkbox *ngIf="item.name != 'Send Feedback'" [checked]="item.checked" [disabled]="
                                  item.disabled || ssreSimulationRight ? 'true' : null
                                " [value]="item.replyLinkId" (change)="onReplyLinkChange($event,item.name)"><span
                    class="text__regular--sm" [ngClass]="{'small_font-size' : !defaultLayout}">{{
                    item.name | translate
                    }}</span></mat-checkbox>
              </ng-container>
              <div *ngIf="!showEscalateview" [ngClass]="{ element__disable: ssreSimulationRight }"
                class="textarea-featured__foot--item ml-auto mt-4" (click)="openCannedResponse()">
                <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="text__regular--sm textarea-featured__foot--boxed">{{'Canned-Response' | translate}}</a>
              </div>
            </div>
          </div>
          <div class="textarea-featured flex-parent__main" [style.display]="showReplyAssignView ? 'block' : 'none'">
            <div class="textarea-featured__body mb-12">
              <textarea formControlName="replyEscalateNote" [ngClass]="{'small_font-size' : !defaultLayout}" rows="5"
                class="border__light-grey textarea-featured__input" placeholder="{{'Add-Note' | translate}}" (input)="noteTextChange('replyEscalateNote')"></textarea>
              <app-attach-media class="w-full" *ngIf="baseMentionObj" [postData]="baseMentionObj" [postDetailTab]="postDetailTab"></app-attach-media>
            </div>
              <!-- <div [ngClass]="{ element__disable: ssreSimulationRight }" class="input__wrapper fdsf" *ngIf="
                              replyLinkCheckbox &&
                              !showGroupsView &&
                              !isEmailChannel &&
                              !chatBotView &&
                              (baseMentionObj.channelGroup != channelGroup.Voice)
                            ">
                <mat-checkbox *ngFor="let item of replyLinkCheckbox" [checked]="item.checked" [disabled]="
                                item.disabled || ssreSimulationRight ? 'true' : null
                              " [value]="item.replyLinkId" (change)="onReplyLinkChange($event,item.name)"><span
                    class="text__regular--sm">{{
                    item.name
                    }}</span></mat-checkbox>
            </div> -->
          </div>
          <!-- <div [ngClass]="{'element__disable' : ssreSimulationRight }" *ngIf="mediaSelectedAsync$ | async as MediaSelected" class="post-reply__media">
                        <div *ngFor="let ugc of MediaSelected" class="post-reply__media--item">
                            <img class="w-20 mr-8" src="https://images.locobuzz.com/1178920845013475329.jpg" alt="">
                            <span class="text__sub">{{ugc.displayFileName}}</span>
                            <mat-icon class="post-reply__media--close" (click)="removeSelectedMedia(ugc)">highlight_off</mat-icon>
                        </div>
                    </div> -->

          <!-- <ng-container *ngIf="replyloader" >
                        <app-reply-loader></app-reply-loader>
                    </ng-container> -->
        </div>
        <!-- <app-reply-loader></app-reply-loader> -->
      </div>

      <!-- Reply Group -->
      <div cdkScrollable [ngClass]="{ element__disable: ssreSimulationRight }" class="reply-group p-12"
        *ngIf="showGroupsView">
        <label class="post-reply__body--title" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Send-To-Email-Group' | translate }}</label>
        <!-- <div *ngIf ="groupEmailListAsync$ | async as customGroupEmailList"> -->

        <!-- <mat-form-field class="custom-input-size" appearance="outline">
                    <mat-label>Send to Email Group</mat-label>
                    <mat-select (selectionChange)="emailGroupChange($event)">
                        <mat-option *ngFor="let item of customGroupEmailList" [value]="item.groupID">{{ item.groupName }}
                        </mat-option>
                    </mat-select>
                </mat-form-field> -->
        <mat-form-field class="custom-input-size send_group_reply" appearance="outline">
          <mat-label [ngClass]="{'small_font-size' : !defaultLayout}">{{'Send-To-Email-Group' | translate}}</mat-label>
          <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #emailgroupchipList aria-label="Fruit selection" class="to_tag_input">
            <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let item of selectedGroupEmailList" [selectable]="selectable" [removable]="removable"
              (removed)="removeEmailGroup(item.groupID)">
              {{ item.groupName }}
              <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" matChipRemove *ngIf="removable">cancel</mat-icon>
            </mat-chip-row>
            <input [placeholder]="emailPlaceHolder" #emaigroupInput #autoCompleteInput [matAutocomplete]="auto"
              [matChipInputFor]="emailgroupchipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              (matChipInputTokenEnd)="add($event)" [ngClass]="{'small_font-size' : !defaultLayout}"/>
          </mat-chip-grid>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="matEmailGroupChange($event)">
            <mat-option [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let item of customGroupEmailList" [value]="item.groupID">
              {{ item.groupName }}
            </mat-option>
          </mat-autocomplete>
          <!-- <mat-select (selectionChange)="emailGroupChange($event)">
                        <mat-option *ngFor="let item of customGroupEmailList" [value]="item.groupID">
                            {{item.groupName}}
                        </mat-option>
                    </mat-select> -->
        </mat-form-field>
        <!-- </div>  -->
        <!-- <mat-form-field appearance="outline">
          <mat-label>Email Groups</mat-label>
          <mat-chip-list #chipList>
            <mat-chip *ngFor="let tag of tags" [selectable]="selectable"
            [removable]="removable" (removed)="removePill(tag)">
              {{tag.name}}
              <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
            </mat-chip>
            <input placeholder="New tag..."
                   [matChipInputFor]="chipList"
                   [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                   [matChipInputAddOnBlur]="addOnBlur"
                   (matChipInputTokenEnd)="addPill($event)">
          </mat-chip-list>
        </mat-form-field> -->
        <div cdkDropListGroup>
          <mat-form-field class="custom-input-size to_tag_input send_group_reply" appearance="outline">
            <mat-label [ngClass]="{'small_font-size' : !defaultLayout}">{{'To' | translate}}</mat-label>
            <div class="chip-container" (keydown)="handleKeyboardEvent($event,groupToEmails,'groupto')" (keyup)="onParentKeyup($event)">
              <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #groupToEmail cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="groupToEmails"
                (cdkDropListDropped)="droppedItem($event)" id="groupto">
                <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let mail of groupToEmails" [selectable]="selectable" [removable]="removable"
                  [class.selected]="selectedChips['groupto']?.includes(mail)" [class.blacklist]="blackListedGrpChips['groupto'].has(mail) && showBlackList" (removed)="removePill(mail, 'to')" cdkDrag [cdkDragData]="selectedChips['groupto']?.length >0 ? selectedChips['groupto'] : mail" 
                  (keydown)="handleCtrlKey($event,groupToEmails,'groupto')" (click)="selectChip($event,mail,'groupto')">
                 <span class="cursor_move" [ngClass]="{'small_font-size' : !defaultLayout}">{{ mail }}</span>
                  <mat-icon matChipRemove *ngIf="removable" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="pl-2 pr-0 mt-1">cancel</mat-icon>
                </mat-chip-row>
                <input [matChipInputFor]="groupToEmail"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                  (matChipInputTokenEnd)="addPill($event, 'groupto')" [matAutocomplete]="autoEmailReply" (input) = "onChangeTo($event,'groupto')" (click)="selectedChips['groupto'] = []" (keydown.enter)="onChangeTo($event,'groupto')"/>
                  <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addGroupBCC($event,'to')">
                    <ng-container *ngIf="inputRecvd['groupto']" [ngClass]="{'small_font-size' : !defaultLayout}">
                      <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length">{{'Suggested-Email-Groups' | translate}}</p>
                      <mat-option [ngClass]="{'small_font-size' : !defaultLayout}" class="h-30" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                      <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length">{{'Suggested-Emails' | translate}}</p>
                      <mat-option [ngClass]="{'small-font-size' : !defaultLayout}" class="h-30" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
              </mat-chip-grid>
            </div>
            <span matSuffix class="d-flex-items-center" class="material__select--suffix">
              <a href="javascript:void(0)" [ngClass]="{'medium-font-size' : !defaultLayout}" class="mr-8" (click)="replyGroupEmailcc=true" *ngIf="!replyGroupEmailcc">+ {{'Cc' | translate}}</a>
              <a href="javascript:void(0)" [ngClass]="{'medium-font-size' : !defaultLayout}" (click)="replyGroupEmailBcc=true" *ngIf="!replyGroupEmailBcc">+ {{'Bcc' | translate}}</a>
            </span>
          </mat-form-field>
          <mat-form-field *ngIf="replyGroupEmailcc" class="custom-input-size to_tag_input send_group_reply cc_bcc_position" appearance="outline">
            <mat-label [ngClass]="{'small_font-size' : !defaultLayout}">{{'Cc' | translate}}</mat-label>
            <div class="chip-container" (keydown)="handleKeyboardEvent($event,groupCCEmails,'groupcc')" (keyup)="onParentKeyup($event)">
              <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #groupccEmail cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="groupCCEmails"
                (cdkDropListDropped)="droppedItem($event)" id="groupcc">
                <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let mail of groupCCEmails" [selectable]="selectable" [removable]="removable"
                  [class.selected]="selectedChips['groupcc']?.includes(mail)" [class.blacklist]="blackListedGrpChips['groupcc'].has(mail) && showBlackList" (removed)="removePill(mail, 'cc')" cdkDrag [cdkDragData]="selectedChips['groupcc']?.length >0 ? selectedChips['groupcc'] : mail"
                  (keydown)="handleCtrlKey($event,groupCCEmails,'groupcc')" (click)="selectChip($event,mail,'groupcc')">
                  <span [ngClass]="{'small_font-size' : !defaultLayout}" class="cursor_move">{{ mail }}</span>
                  <mat-icon matChipRemove [ngClass]="{'small-icon-font-size' : !defaultLayout}" *ngIf="removable" class="pl-2 pr-0 mt-1">cancel</mat-icon>
                </mat-chip-row>
                <input placeholder="{{'New-CC-Email' | translate}}" [matChipInputFor]="groupccEmail"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [ngClass]="{'small_font-size' : !defaultLayout}" [matChipInputAddOnBlur]="addOnBlur"
                  (matChipInputTokenEnd)="addPill($event, 'groupcc')" [matAutocomplete]="autoEmailReply"  (input) = "onChangeTo($event,'groupcc')" (click)="selectedChips['groupcc'] = []" (keydown.enter)="onChangeTo($event,'groupcc')"/>
                  <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addGroupBCC($event,'cc')">
                    <ng-container *ngIf="inputRecvd['groupcc']">
                      <p class="autoSendEmailCC" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{'Suggested-Email-Groups' | translate}}</p>
                      <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                      <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{'Suggested-Emails' | translate}}</p>
                      <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
              </mat-chip-grid>
            </div>
            <span matSuffix class="d-flex-items-center" class="material__select--suffix">
              <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" (click)="replyGroupEmailcc=false" *ngIf="replyGroupEmailcc" class="colored__locobuzz">- {{'Cc' | translate}}</a>
            </span>
          </mat-form-field>
          <mat-form-field *ngIf="replyGroupEmailBcc" class="custom-input-size to_tag_input send_group_reply cc_bcc_position" appearance="outline">
            <mat-label [ngClass]="{'small_font-size' : !defaultLayout}" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Bcc' | translate}}</mat-label>
            <div class="chip-container" (keydown)="handleKeyboardEvent($event,groupBCCEmails,'groupbcc')" (keyup)="onParentKeyup($event)">
              <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #groupbccEmail  cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="groupBCCEmails"
                (cdkDropListDropped)="droppedItem($event)" id="groupbcc">
                <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let mail of groupBCCEmails" [selectable]="selectable" [removable]="removable"
                  [class.selected]="selectedChips['groupbcc']?.includes(mail)" [class.blacklist]="blackListedGrpChips['groupbcc'].has(mail) && showBlackList" (removed)="removePill(mail, 'bcc')" cdkDrag [cdkDragData]="selectedChips['groupbcc']?.length >0 ? selectedChips['groupbcc'] : mail"
                  (keydown)="handleCtrlKey($event,groupBCCEmails,'groupbcc')" (click)="selectChip($event,mail,'groupbcc')">
                  <span class="cursor_move" [ngClass]="{'small_font-size' : !defaultLayout}">{{ mail }}</span>
                  <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" matChipRemove *ngIf="removable">cancel</mat-icon>
                </mat-chip-row>
                <input #emailField1 placeholder="{{'New-Bcc-Email' | translate}}" [matChipInputFor]="groupbccEmail" [ngClass]="{'small_font-size' : !defaultLayout}"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                  (matChipInputTokenEnd)="addPill($event, 'groupbcc')" (input) = "onChangeTo($event,'groupbcc')" [matAutocomplete]="autoSendEmail" (click)="selectedChips['groupbcc'] = []" (keydown.enter)="onChangeTo($event,'groupbcc')"/>
                  <mat-autocomplete #autoSendEmail="matAutocomplete" (optionSelected)="addGroupBCC($event,'bcc')">
                    <ng-container *ngIf="inputRecvd['groupbcc']" [ngClass]="{'small_font-size' : !defaultLayout}">
                      <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{'Suggested-Email-Groups' | translate}}</p>
                      <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                      <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{'Suggested-Emails' | translate}}</p>
                      <mat-option class="h-30" [ngClass]="{'small-font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
              </mat-chip-grid>
            </div>
            <span matSuffix class="d-flex-items-center" class="material__select--suffix">
              <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" (click)="replyGroupEmailBcc=false" *ngIf="replyGroupEmailBcc" class="colored__locobuzz">-
                {{'Bcc' | translate}}</a>
            </span>
          </mat-form-field>
        </div>
        <!-- email friendly mail group -->
        <ng-container *ngIf="selectedTicketView == 3 && !onlySendMail && !showGroupsView">
          <div class="send-email__item send-email__emailfriendly">
            <div class="send-email__emailfriendly--left" [ngClass]="{'w-5-p': pageType == pageTypeEnum.TicketHistory}">
              <span class="font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'To' | translate}}</span>
            </div>
            <div class="send-email__emailfriendly--right" [ngClass]="{'w-95-p': pageType == pageTypeEnum.TicketHistory}">
              <mat-form-field appearance="outline" class="material__select to_tag_input">
                <mat-label [ngClass]="{'small_font-size' : !defaultLayout}"></mat-label>
                <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailToEmail,'rTo')" (keyup)="onParentKeyup($event)">
                  <mat-chip-grid #sendtoemailchip cdkDropList
                                cdkDropListOrientation="horizontal" [cdkDropListData]="emailToEmail"
                                (cdkDropListDropped)="reorderDroppedItem($event)" [ngClass]="{'small_font-size' : !defaultLayout}" id="rTo">
                    <ng-container *ngFor="let mail of emailToEmail">
                      <mat-chip-row [selectable]="selectable" [removable]="removable" [class.selected]="selectedChips['rTo']?.includes(mail)" (removed)="removeEmailPill(mail, 'to')" cdkDrag [cdkDragData]="selectedChips['rTo']?.length >0 ? selectedChips['rTo'] : mail" 
                        (keydown)="handleCtrlKey($event,emailToEmail,'rTo')" (click)="selectChip($event,mail,'rTo')">
                        <span class="cursor_move" [ngClass]="{'small_font-size' : !defaultLayout}">{{ mail }}</span>
                        <mat-icon matChipRemove  class="s-16 pl-2 pr-0 mt-1" [ngClass]="{'small-icon-font-size' : !defaultLayout}">cancel</mat-icon>
                      </mat-chip-row>
                    </ng-container>
                    <input #inputRef placeholder="{{'Enter-Email-Address' | translate}}" [matChipInputFor]="sendtoemailchip"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                      (matChipInputTokenEnd)="addEmailPill($event, 'rTo')" [ngClass]="{'small_font-size' : !defaultLayout}" (input) = "onChangeTo($event,'rTo')" [matAutocomplete]="autoEmailReply" (click)="selectedChips['rTo'] = []" (keydown.enter)="onChangeTo($event,'rTo')"/>
                      <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'to',inputRef)">
                        <ng-container *ngIf="inputRecvd['rTo']">
                          <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{'Suggested-Email-Groups' | translate}}</p>
                          <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                            {{ email?.groupName }}
                          </mat-option>
                          <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{'Suggested-Emails' | translate}}</p>
                          <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                            {{ email }}
                          </mat-option>
                        </ng-container>
                      </mat-autocomplete>
                  </mat-chip-grid>
                </div>
                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
            <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="mr-8 colored__locobuzz" (click)="replyEmailcc=true" *ngIf="!replyEmailcc">+
              {{ 'Cc' | translate }}</a>
            <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="colored__locobuzz" (click)="replyEmailBcc=true" *ngIf="!replyEmailBcc">+
              {{ 'Bcc' | translate }}</a>
                </span>
              </mat-form-field>
            </div>
          </div>
          <div class="send-email__item send-email__emailfriendly"
            *ngIf="replyEmailcc && selectedTicketView==3">
            <div class="send-email__emailfriendly--left" [ngClass]="{'w-5-p': pageType == pageTypeEnum.TicketHistory}">
              <span class="font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{ 'Cc' | translate }}</span>
            </div>
            <div class="send-email__emailfriendly--right" [ngClass]="{'w-95-p': pageType == pageTypeEnum.TicketHistory}">
              <mat-form-field appearance="outline" class="material__select to_tag_input cc_bcc_position">
                <mat-label [ngClass]="{'small_font-size' : !defaultLayout}"></mat-label>
                <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailCCEmails,'rCC')" (keyup)="onParentKeyup($event)">
                  <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #emailchipList cdkDropList
                                cdkDropListOrientation="horizontal" [cdkDropListData]="emailCCEmails"
                                (cdkDropListDropped)="reorderDroppedItem($event)" id="rCC">
                    <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let mail of emailCCEmails" [selectable]="selectable" [removable]="removable"
                      [class.selected]="selectedChips['rCC']?.includes(mail)" (removed)="removeEmailPill(mail, 'cc')" cdkDrag [cdkDragData]="selectedChips['rCC']?.length >0 ? selectedChips['rCC'] : mail"
                      (keydown)="handleCtrlKey($event,emailCCEmails,'rCC')" (click)="selectChip($event,mail,'rCC')">
                      <span [ngClass]="{'small_font-size' : !defaultLayout}" class="cursor_move">{{ mail }}</span>
                      <mat-icon matChipRemove [ngClass]="{'small-icon-font-size' : !defaultLayout}" *ngIf="removable" class="s-16 pl-2 pr-0 mt-1">cancel</mat-icon>
                    </mat-chip-row>
                    <input inputRef placeholder="{{'Enter-Email-Address' | translate}}" [ngClass]="{'small_font-size' : !defaultLayout}" [matChipInputAddOnBlur]="addOnBlur" [matChipInputFor]="emailchipList"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="addEmailPill($event, 'rCC')" [matAutocomplete]="autoEmailReply"  (input) = "onChangeTo($event,'rCC')" (click)="selectedChips['rCC'] = []" (keydown.enter)="onChangeTo($event,'rCC')"/>
                    <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'cc',inputRef)">
                      <ng-container *ngIf="inputRecvd['rCC']">
            <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
            <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                          {{ email?.groupName }}
                        </mat-option>
            <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
            <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                          {{ email }}
                        </mat-option>
                      </ng-container>
                    </mat-autocomplete>
                  </mat-chip-grid>
                </div>
                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
            <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="mr-8 colored__locobuzz" (click)="replyEmailcc=false" *ngIf="replyEmailcc">-
              {{ 'Cc' | translate }}</a>
                </span>
              </mat-form-field>
            </div>
          </div>
          <div class="send-email__item send-email__emailfriendly"
            *ngIf="replyEmailBcc && selectedTicketView==3">
            <div class="send-email__emailfriendly--left" [ngClass]="{'w-5-p': pageType == pageTypeEnum.TicketHistory, 'small_font-size': !defaultLayout}">
              <span class="font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Bcc' | translate}}</span>
            </div>
            <div class="send-email__emailfriendly--right" [ngClass]="{'w-95-p': pageType == pageTypeEnum.TicketHistory}">
              <mat-form-field appearance="outline" class="material__select to_tag_input cc_bcc_position">
                <mat-label></mat-label>
                <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailBCCEmails,'rBCC')" (keyup)="onParentKeyup($event)">
                  <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #bccEmailchipList cdkDropList
                                cdkDropListOrientation="horizontal" [cdkDropListData]="emailBCCEmails"
                                (cdkDropListDropped)="reorderDroppedItem($event)" id="rBCC">
                    <mat-chip-row *ngFor="let mail of emailBCCEmails" [selectable]="selectable" [removable]="removable"
                      [class.selected]="selectedChips['rBCC']?.includes(mail)" (removed)="removeEmailPill(mail, 'bcc')" cdkDrag [cdkDragData]="selectedChips['rBCC']?.length >0 ? selectedChips['rBCC'] : mail"
                      (keydown)="handleCtrlKey($event,emailBCCEmails,'rBCC')" [ngClass]="{'small_font-size' : !defaultLayout}" (click)="selectChip($event,mail,'rBCC')">
                      <span class="cursor_move" [ngClass]="{'small_font-size' : !defaultLayout}">{{ mail }}</span>
                      <mat-icon matChipRemove *ngIf="removable" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="s-16 pl-2 pr-0 mt-1">cancel</mat-icon>
                    </mat-chip-row>
                    <input #emailField2  placeholder="{{'Enter-Email-Address' | translate}}" [matChipInputFor]="bccEmailchipList"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                      (matChipInputTokenEnd)="addEmailPill($event, 'rBCC')" [ngClass]="{'small_font-size' : !defaultLayout}" (input) = "onChangeTo($event,'rBCC')" [matAutocomplete]="autoEmailReply1" (click)="selectedChips['rBCC'] = []" (keydown.enter)="onChangeTo($event,'rBCC')"/>
                      <mat-autocomplete #autoEmailReply1="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'bcc',emailField2)">
                        <ng-container *ngIf="inputRecvd['rBCC']">
              <p class="toEmailGroupLabel"  [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
              <mat-option class="h-30"  [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                            {{ email?.groupName }}
                          </mat-option>
              <p class="toEmailGroupLabel"  [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
              <mat-option class="h-30"  [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                            {{ email }}
                          </mat-option>
                        </ng-container>
                      </mat-autocomplete>
                  </mat-chip-grid>
                </div>
                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
            <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" (click)="replyEmailBcc=false" *ngIf="replyEmailBcc" class="colored__locobuzz">-
              {{ 'Bcc' | translate }}</a>
                </span>
              </mat-form-field>
            </div>
          </div>
        </ng-container>
        <!-- email friendly mail group ends -->
        <div *ngIf="groupBlackListDisabled && showBlackList" class="blackListErrorMessage" [ngClass]="{'mt-0 mb-8' : !defaultLayout}">
          <mat-icon [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}" style="margin-right: 8px; color: #f44336;">error</mat-icon>
          <span [ngClass]="{'small_font-size' : !defaultLayout}">{{ 'You-Can-Only-Use-Emails' | translate }}</span>
        </div>
      </div>
      <!-- Send Email  -->
      <div class="send-email p-12" *ngIf="onlySendMail && !showGroupsView">
        <div class="send-email__item" *ngIf = "emailForward">
          <ng-template [ngIf]="
                        this.ticketReplyDTO.handleNames &&
                        this.ticketReplyDTO.handleNames.length > 0
                      ">
            <!-- <mat-form-field class="material__select" appearance="outline">
              <mat-label>Reply Handle</mat-label>
              <mat-select formControlName="replyHandler" (selectionChange)="replyHandleChanged()">
                <mat-option
                  matTooltip="{{item.handleName.length + item.handleId.length>25?item.handleName+ ' ' +'('+ item.handleId+')':''}}"
                  *ngFor="let item of this.ticketReplyDTO.handleNames" [value]="item.socialId">
                  {{item.handleName }} ({{item.handleId}})
                </mat-option>
              </mat-select>
            </mat-form-field> -->
            <div class="d-flex-items-center g-10">
              <div class="blue-pill reply-type-pill width-fit px-10 py-5 border-radius-16 d-flex-items-center g-10">
              <p class="colored__main--text font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{ 'Reply-Handle' | translate }}</p>
                <mat-select formControlName="replyHandler" (selectionChange)="replyHandleChanged()"
                  class="d-flex-items-center w-230 h-20" [ngClass]="{'small_font-size' : !defaultLayout}">
                  <mat-option [ngClass]="{'small_font-size' : !defaultLayout}"
                    matTooltip="{{item.handleName.length + item.handleId.length>25?item.handleName+ ' ' +'('+ item.handleId+')':''}}"
                    *ngFor="let item of this.ticketReplyDTO.handleNames" [value]="item.socialId">
                    {{item.handleName }} ({{item.handleId}})
                  </mat-option>
                </mat-select>
              </div>
              <div class="grey-pill w-100-p border-radius-16 h-30 px-10 py-5 d-flex-items-center g-10 " matTooltip="{{sendEmailSubject}}">
                <p class="colored__main--text font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Subject' | translate}}:</p>
                <input class="p-0 bg-inherit w-100-p text__ellipsis" matInput [(ngModel)]="sendEmailSubject" [ngModelOptions]="{ standalone: true }" [ngClass]="{'element__disable': (emailForward && !newThreadEmail), 'small_font-size' : !defaultLayout}"/>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- <div class="send-email__item" [ngClass] = "{'element__disable' : (emailForward && !newThreadEmail)}">
          <mat-form-field appearance="outline" class="material__select">
            <mat-label>Subject</mat-label>
            <input matInput [(ngModel)]="sendEmailSubject" [ngModelOptions]="{ standalone: true }" />
          </mat-form-field>
        </div> -->

        <div cdkDropListGroup class="flex-direction-column g-1">
          <div class="send-email__item flex-direction-column g-10">
            <!-- <mat-form-field appearance="outline" class="material__select">
                                  <mat-label>To</mat-label>
                                  <mat-chip-list #chipList>
                                      <mat-chip [selectable]="true" [removable]="true">
                                          john.doe@gmail.com
                                          <mat-icon matChipRemove>cancel</mat-icon>
                                      </mat-chip>
                                      <input>
                                  </mat-chip-list>
                              </mat-form-field> -->
            <div *ngIf="onlySendMail && !emailForward" class="grey-pill border-radius-16 h-30 px-10 py-5 d-flex-items-center g-10">
              <p class="colored__main--text font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Subject' | translate}}:</p>
              <input [ngModelOptions]="{ standalone: true }" [ngClass]="{'small_font-size' : !defaultLayout}" [(ngModel)]="sendEmailSubject" class="p-0 bg-inherit text__ellipsis w-100-p"/>
            </div>
            <div class="d-flex-items-center g-10">
              <p class="font-weight-600 d-flex-items-center" [ngClass]="[emailForward ? 'w-104' : 'w-66', !defaultLayout ? 'medium-font-size no-wrap' : '']">
              {{ emailForward ? ('Forward-To' | translate) : ('To' | translate) }}
              </p>
              <mat-form-field appearance="outline" class="material__select to_tag_input no-outline">
                <!-- <mat-label>To</mat-label> -->
                <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailToEmail,'to')" (keyup)="onParentKeyup($event)">
                  <mat-chip-grid [ngClass]="{'small_font-size' : !defaultLayout}" #sendtoemailchip cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="emailToEmail"
                    (cdkDropListDropped)="reorderDroppedItem($event)" id="to">
                                      <ng-container *ngFor="let mail of emailToEmail | slice:0:emailToChipPosition;">
                    <mat-chip-row [ngClass]="{'small_font-size' : !defaultLayout}" [selectable]="selectable" [removable]="removable"
                      [class.selected]="selectedChips['to']?.includes(mail)" [class.blacklist]="blackListedChips['to'].has(mail) && showBlackList" (removed)="removeEmailPill(mail, 'to')" cdkDrag
                      [cdkDragData]="selectedChips['to']?.length >0 ? selectedChips['to'] : mail"
                      (keydown)="handleCtrlKey($event,emailToEmail,'to')" (click)="selectChip($event,mail,'to')" [ngClass]="{'yellow-pill border__yellow':emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"
                      >
                      <div class="d-flex-items-center g-10">
                          <div *ngIf="emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23 bg__yellow--dark border-round">
                            <mat-icon [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}" class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                          </div>
                        <span class="cursor_move" [ngClass]="{'small_font-size' : !defaultLayout}" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                          [matTooltip]="mail">{{ mail }}</span>
                        <mat-icon matChipRemove *ngIf="removable" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}" class="p-0 mt-1">cancel</mat-icon>
                      </div>
                    </mat-chip-row>
                    </ng-container>
                        <ng-container *ngIf="emailToEmail?.length>emailToChipPosition">
                          <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                            [matMenuTriggerFor]="moreProfiles">
                            <p [ngClass]="{'small_font-size' : !defaultLayout}">+{{emailToEmail?.slice(emailToChipPosition)?.length}}</p>
                          </div>
                          <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300"
                            style="max-height: 220px;min-height: auto !important;">
                            <div class="more-profiles-container flex-direction-column g-10 p-10">
                              <div *ngFor="let mail of emailToEmail | slice:emailToChipPosition:emailToEmail.length;"
                                [ngClass]="{'yellow-pill border__yellow':emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"  
                                class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                                <div class="d-flex-items-center g-5">
                                  <div *ngIf="emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory"
                                     class="w-23 h-23  border-round bg__yellow--dark">
                                    <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                  </div>
                                  <p appEmailTruncate [ngClass]="{'small_font-size' : !defaultLayout}" [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail"
                                    class="colored__main--text">{{mail}}</p>
                                </div>
                                <mat-icon (click)="removeEmailPill(mail, 'to')" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                                  class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                              </div>
                            </div>
                          </mat-menu>
                        </ng-container>
                    <input [ngClass]="{'small_font-size' : !defaultLayout}" [matChipInputFor]="sendtoemailchip" placeholder="{{'New-To-Email' | translate}}"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                      (matChipInputTokenEnd)="addEmailPill($event, 'to')" [ngClass]="{'small_font-size' : !defaultLayout}" (input)="onChangeTo($event,'to')"
                      [matAutocomplete]="autoEmailReplyTO" (click)="selectedChips['to'] = []" #inputRef (keydown.enter)="onChangeTo($event,'to')"/>
                    <mat-autocomplete #autoEmailReplyTO="matAutocomplete" (optionSelected)="addForwardEmailGroup($event, 'to',inputRef, true)">
                      <ng-container *ngIf="inputRecvd['to'] == true">
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length">{{ 'Suggested-Email-Groups' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                          {{ email?.groupName }}
                        </mat-option>
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length">{{ 'Suggested-Emails' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                          {{ email }}
                        </mat-option>
                      </ng-container>
                    </mat-autocomplete>
                  </mat-chip-grid>
                </div>
                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="mr-8" (click)="replyEmailcc=true" *ngIf="!replyEmailcc">+ {{ 'Cc' | translate }}</a>
                <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" (click)="replyEmailBcc=true" *ngIf="!replyEmailBcc">+ {{ 'Bcc' | translate }}</a>
                </span>
              </mat-form-field>
            </div>
            
          </div>
          <div class="send-email__item d-flex-items-center g-10 m-top-10" *ngIf="replyEmailcc">
            <p class="font-weight-600 d-flex-items-center" [ngClass]="[emailForward ? 'w-104' : 'w-66', !defaultLayout ? 'medium-font-size' : '']">
              {{ 'Cc' | translate }}:
            </p>
            <mat-form-field appearance="outline" class="material__select to_tag_input cc_bcc_position no-outline">
              <!-- <mat-label>cc </mat-label> -->
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailCCEmails,'cc')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #emailchipList cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="emailCCEmails"
                  (cdkDropListDropped)="reorderDroppedItem($event)" id="cc">
                  <ng-container *ngFor="let mail of emailCCEmails | slice:0:emailToChipPosition;">
                  <mat-chip-row  [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['cc']?.includes(mail)" [class.blacklist]="blackListedChips['cc'].has(mail) && showBlackList" (removed)="removeEmailPill(mail, 'cc')" cdkDrag [cdkDragData]="selectedChips['cc']?.length >0 ? selectedChips['cc'] : mail" 
                    (keydown)="handleCtrlKey($event,emailCCEmails,'cc')" (click)="selectChip($event,mail,'cc')" [ngClass]="{
                    'yellow-pill border__yellow': emailForward && !tempAllGroupEmailList?.includes(mail) && pageType ==
                    pageTypeEnum.TicketHistory
                    }" >
                    <div class="d-flex-items-center g-10">
                      <div *ngIf="emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23 bg__yellow--dark border-round">
                        <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                      </div>
                      <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                      [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail">{{ mail }}</span>
                      <mat-icon matChipRemove *ngIf="removable" class="p-0 mt-1" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">cancel</mat-icon>
                    </div>
                  </mat-chip-row>
                  </ng-container>
                      <ng-container *ngIf="emailCCEmails?.length>emailToChipPosition">
                        <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                          [matMenuTriggerFor]="moreProfiles">
                          <p>+{{emailCCEmails?.slice(emailToChipPosition)?.length}}</p>
                        </div>
                        <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300"
                          style="max-height: 220px;min-height: auto !important;">
                          <div class="more-profiles-container flex-direction-column g-10 p-10"> 
                            <div *ngFor="let mail of emailCCEmails | slice:emailToChipPosition:emailCCEmails.length;" [ngClass]="{'yellow-pill border__yellow':emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"
                              class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                              <div class="d-flex-items-center g-5">
                                <div *ngIf="emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23  border-round bg__yellow--dark">
                                  <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                </div>
                                <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail"
                                  class="colored__main--text" [ngClass]="{'small_font-size' : !defaultLayout}">{{mail}}</p>
                              </div>
                              <mat-icon (click)="removeEmailPill(mail, 'cc')" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                                class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                            </div>
                          </div>
                        </mat-menu>
                      </ng-container>
                  <input [ngClass]="{'small_font-size' : !defaultLayout}" placeholder="{{'New-Cc-Email' | translate}}" [matChipInputAddOnBlur]="addOnBlur" [matChipInputFor]="emailchipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="addEmailPill($event, 'cc')"
                    (input)="onChangeTo($event,'cc')" [matAutocomplete]="autoEmailReplyCC" (click)="selectedChips['cc'] = []" #inputRef (keydown.enter)="onChangeTo($event,'cc')"/>
                  <mat-autocomplete #autoEmailReplyCC="matAutocomplete" (optionSelected)="addForwardEmailGroup($event, 'cc',inputRef,true)">
                    <ng-container *ngIf="inputRecvd['cc'] == true">
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length">{{ 'Suggested-Email-Groups' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length">{{ 'Suggested-Emails' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-chip-grid>
              </div>
              <span matSuffix class="d-flex-items-center" class="material__select--suffix">
              <a href="javascript:void(0)" [ngClass]="{'small_font-size' : !defaultLayout}" class="mr-8" (click)="replyEmailcc=false" *ngIf="replyEmailcc">- {{ 'Cc' | translate }}</a>
              </span>
            </mat-form-field>
          </div>
          <div class="send-email__item d-flex-items-center g-10 m-top-10" *ngIf="replyEmailBcc">
            <p class="font-weight-600 d-flex-items-center" [ngClass]="[emailForward ? 'w-104' : 'w-66', !defaultLayout ? 'small_font-size' : '']">
              {{ 'Bcc' | translate }}:
            </p>
            <mat-form-field appearance="outline" class="material__select to_tag_input cc_bcc_position no-outline">
              <!-- <mat-label>Bcc </mat-label> -->
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailBCCEmails,'bcc')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #bccEmailchipList cdkDropList cdkDropListOrientation="horizontal" [cdkDropListData]="emailBCCEmails"
                  (cdkDropListDropped)="reorderDroppedItem($event)" id="bcc">
                  <ng-container *ngFor="let mail of emailBCCEmails | slice:0:emailToChipPosition;">
                  <mat-chip-row  [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['bcc']?.includes(mail)" [class.blacklist]="blackListedChips['bcc'].has(mail) && showBlackList" (removed)="removeEmailPill(mail, 'bcc')" cdkDrag [cdkDragData]="selectedChips['bcc']?.length >0 ? selectedChips['bcc'] : mail"
                    (keydown)="handleCtrlKey($event,emailBCCEmails,'bcc')" (click)="selectChip($event,mail,'bcc')" [ngClass]="{'yellow-pill border__yellow':emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}" >
                    <div class="d-flex-items-center g-10">
                      <div *ngIf="emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23  border-round bg__yellow--dark">
                        <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                      </div>
                      <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                      [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail">{{ mail }}</span>
                      <mat-icon matChipRemove *ngIf="removable" class="p-0 mt-1" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">cancel</mat-icon>
                    </div>
                  </mat-chip-row>
                  </ng-container>
                  <ng-container *ngIf="emailBCCEmails?.length>emailToChipPosition">
                    <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                      [matMenuTriggerFor]="moreProfiles">
                      <p>+{{emailBCCEmails?.slice(emailToChipPosition)?.length}}</p>
                    </div>
                    <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300"
                      style="max-height: 220px;min-height: auto !important;">
                      <div class="more-profiles-container flex-direction-column g-10 p-10">
                        <div *ngFor="let mail of emailBCCEmails | slice:emailToChipPosition:emailBCCEmails.length;" [ngClass]="{'yellow-pill border__yellow':emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"
                          class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                          <div class="d-flex-items-center g-5">
                            <div *ngIf="emailForward && !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23  border-round bg__yellow--dark">
                              <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                            </div>
                            <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail"
                              class="colored__main--text" [ngClass]="{'small_font-size' : !defaultLayout}">{{mail}}</p>
                          </div>
                          <mat-icon (click)="removeEmailPill(mail, 'bcc')" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                            class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                        </div>
                      </div>
                    </mat-menu>
                  </ng-container>
                <input #emailField3 [ngClass]="{'small_font-size' : !defaultLayout}" placeholder="{{'New-Bcc-Email' | translate}}" [matChipInputFor]="bccEmailchipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                    (matChipInputTokenEnd)="addEmailPill($event, 'bcc')" (input)="onChangeTo($event,'bcc')"
                    [matAutocomplete]="autoEmailReply" (click)="selectedChips['bcc'] = []" (keydown.enter)="onChangeTo($event,'bcc')"/>
                  <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'bcc',emailField3,true)">
                    <ng-container *ngIf="inputRecvd['bcc'] == true">
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-chip-grid>
              </div>
              <span matSuffix class="d-flex-items-center" class="material__select--suffix">
              <a href="javascript:void(0)" (click)="replyEmailBcc=false" *ngIf="replyEmailBcc">- {{ 'Bcc' | translate }}</a>
              </span>
            </mat-form-field>
          </div>
          <div *ngIf="blackListDisabled && showBlackList" class="blackListErrorMessage" [ngClass]="{'mt-0 mb-8' : !defaultLayout}">
            <mat-icon [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}" style="margin-right: 8px; color: #f44336;">error</mat-icon>
            <span [ngClass]="{'small_font-size' : !defaultLayout}">{{ 'You-Can-Only-Use-Emails' | translate }}</span>
          </div>
        </div>
        <div class="send-email__item">
          <ckeditor (ready)="onReady($event)" class="ckeditor position-relative editor-height" (drop)="drop($event)" (paste)="paste($event)" formControlName="ckeditorText" [(ngModel)]="emailReplyText" [config]="editorConfig"
            type="Classic">
          </ckeditor>
          <div *ngIf="onlySendMail && emailForward"
            class="position-absolute w-30 h-30 border-round popup-btn cursor-pointer d-flex-items-center justify-content__center"
            (click)="emailPopUpView(true)">
            <mat-icon
              class="font-size-16 d-flex-items-center justify-content__center popup-icon mt-3">picture_in_picture_alt</mat-icon>
          </div>
          <div fxLayout="row" *ngIf = "emailForward" class="toggle_pre_mail_icon"
            [ngClass]="{'toggle_pre_mail_icon__loader': rephraseLoader, 'toggle__Mail':selectedTicketView == 1}">
            <div fxFlex="0 1 calc(100%)" class="d-flex-items-center">
                <span *ngIf="showPrevoiusMail" [ngClass]="{'element__disable': ckEditorLoader}" class="post-reply__mail--open mr-7"
                  matTooltip="{{'Show-Trimmed-Content' | translate}}" matTooltipClass="custom-tooltip" (click)="toggleForForwardEmail()">
                  <mat-icon fontSet="material-icons-outlined">more_horiz</mat-icon>
                </span>
                <!-- <ng-container >
                  <img class="w-20 cursor-pointer" src="assets/images/common/float_landscape_2.svg" matTooltip="Open in a pop-up"
                    matTooltipClass="custom-tooltip" (click)="emailPopUpView(true)">
                </ng-container> -->
            </div>
          </div>
        </div>
        <div class="send-email__item mt-12">
          <div class="textarea-featured__foot--item">
            <a [ngClass]="{ element__disable: ssreSimulationRight }"
              class="textarea-featured__foot--icon text__regular--sm" href="javascript:void(0)"
              (click)="openMediaDialog()">
              <mat-icon fontSet="material-icons-outlined custom__icon--md">insert_photo</mat-icon>
              <span>{{ 'Attach-Media' | translate }}</span>
            </a>
          </div>
        </div>
        <!-- ck editor loader -->
        <!-- <div class="editor-loader" [@fadeInOut]>
                <div class="editor-loader__content">
                   <div class="editor-loader__content--line short"></div>
                   <div class="editor-loader__content--line very-short"></div>
                   <div class="editor-loader__content--line very-short"></div>
                   <div class="editor-loader__content--line very-short"></div>
                   <div class="editor-loader__content--line very-short"></div>
                   <div class="editor-loader__content--line very-short"></div>
                </div>
                <div class="editor-loader__body">
                    <div class="editor-loader__body__content">
                        <div class="editor-loader__body__content--line high-long"></div>
                        <div class="editor-loader__body__content--line high-long"></div>
                      </div>
                      <div class="editor-loader__body__content">
                        <div class="editor-loader__body__content--line short"></div>
                      </div>
                      <div class="editor-loader__body__content">
                        <div class="editor-loader__body__content--line long"></div>
                      </div>
                </div>
              </div> -->
        <!-- ends ck editor loader -->
        <!-- <div [ngClass]="{ element__disable: ssreSimulationRight }" *ngIf="mediaSelectedAsync$ | async as MediaSelected"
          class="textarea-featured__foot--item--media pt-10">
          <ng-template ngFor let-ugc [ngForOf]="MediaSelected">
            <span *ngIf="ugc.mediaType == 2" matTooltip="{{ugc?.displayFileName}}"
              class="textarea-featured__foot--item--icon">
              <img class="media__img--icon" [src]="ugc.mediaPath" alt="" />
              <span class="item__overlay">
                <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
              </span>
            </span>
            <span *ngIf="ugc.mediaType == 3" matTooltip="{{ugc?.displayFileName}}"
              class="textarea-featured__foot--item--icon">
              <video class="media__img--icon">
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/m4v" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mp4" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mpeg" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-msvideo" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-ms-wmv" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/avi" />
              </video>
              <span class="item__overlay--video">
                <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                <mat-icon class="play__img--icon">play_circle_outline</mat-icon>
              </span>
            </span>
            <span matTooltip="{{ugc?.displayFileName}}"
              *ngIf="ugc.mediaType == mediaTypeEnum.PDF || ugc.mediaType == mediaTypeEnum.DOC || ugc.mediaType == mediaTypeEnum.EXCEL"
              class="textarea-featured__foot--item--icon">
              <img src="assets/images/common/pdf.png" *ngIf="ugc.mediaType == mediaTypeEnum.PDF"
                class="media__img--icon">
              <img src="assets/images/common/word.png" *ngIf="ugc.mediaType == mediaTypeEnum.DOC"
                class="media__img--icon">
              <img src="assets/images/common/excel-file.png" *ngIf="ugc.mediaType == mediaTypeEnum.EXCEL"
                class="media__img--icon">
              <span class="item__overlay">
                <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
              </span>
            </span>
          </ng-template>
        </div> -->
        <div #attachmentContainer class="d-flex-items-center g-10 mt-10">
          <div (click)="previewFile(obj,true);$event.stopPropagation()" #attachmentRef
            *ngFor="let obj of selectedAttachmentList | slice:0:maximumAttachmentLength ;index as i"
            class="d-flex-items-center pl-2 pr-5 py-2 file-pill" [ngClass]="{'h-30' : defaultLayout}">
            <img [src]="obj.iconUrl" [ngClass]="defaultLayout ? 'w-21' : 'small-image-width'"/>
            <!-- <mat-icon *ngIf="obj.mediaType==mediaEnum.PDF"
                                          class="material-icons-outlined colored__red font-size-18 d-flex-items-center justify-content__center">picture_as_pdf</mat-icon>
                                        <mat-icon *ngIf="obj.mediaType==mediaEnum.IMAGE"
                                          class="material-icons-outlined colored__purple font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                        <img *ngIf="obj.mediaType==mediaEnum.EXCEL" class="w-21" src="assets/icons/excel-icon.svg">
                                        <img *ngIf="obj.mediaType==mediaEnum.VIDEO" class="w-21" src="assets/icons/video-icon.svg">
                                        <img *ngIf="obj.mediaType==mediaEnum.FILE" class="w-21" src="assets/images/other-attachment.svg" /> -->
            <p class="cursor-pointer" [matTooltip]="obj?.fileName?.length > 12 ? obj.fileName :''"
              matTooltipClass="custom__tooltip-normal" [ngClass]="{'small_font-size' : !defaultLayout}">{{ obj?.fileName | slice: 0:8 }}{{ obj?.fileName?.length
              > 8 ? '...' : '' }}</p>
            <mat-icon (click)="removeSelectedMedia(obj);$event.stopPropagation()" class="ml-6 s-18 cursor-pointer"
              fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">delete_outline</mat-icon>
          </div>
          <div *ngIf="showMoreAttachment">
            <span class="more-count" *ngIf="remainingAttachmentCount>0" (click)="$event.stopPropagation()"
              [matMenuTriggerFor]="attachmentMore">+{{remainingAttachmentCount}}</span>
            <mat-menu #attachmentMore="matMenu" class="">
              <button mat-menu-item class="d-flex-items-center" (click)="previewFile(obj,true)"
                *ngFor="let obj of selectedAttachmentList | slice:maximumAttachmentLength:selectedAttachmentList.length ;index as i">
                
                <!-- <mat-icon *ngIf="obj.mediaType==mediaEnum.PDF"
                                              class="material-icons-outlined colored__red mr-6 font-size-18 d-flex-items-center justify-content__center">picture_as_pdf</mat-icon>
                                            <mat-icon *ngIf="obj.mediaType==mediaEnum.IMAGE"
                                              class="material-icons-outlined colored__purple mr-6 font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                            <img *ngIf="obj.mediaType==mediaEnum.EXCEL" class="w-21" src="assets/icons/excel-icon.svg">
                                            <img *ngIf="obj.mediaType==mediaEnum.VIDEO" class="w-21" src="assets/icons/video-icon.svg">
                                            <img *ngIf="obj.mediaType==mediaEnum.FILE" class="w-21" src="assets/images/other-attachment.svg" /> -->
                <span class="d-flex-items-center">
                  <img class="w-21 mr-6" [src]="obj.iconUrl" />
                  <span class="more-count__text text__ellipsis" [matTooltip]="obj.fileName.length > 12 ? obj.fileName :''"
                    matTooltipClass="custom__tooltip-normal">
                    {{ obj?.fileName | slice: 0:15 }}{{ obj?.fileName?.length
                    > 15 ? '...' : '' }}</span>
                  <mat-icon
                    class="ml-auto mr-0 s-18 cursor-pointer" (click)="removeSelectedMedia(obj);$event.stopPropagation()"
                    fontSet="material-icons-outlined">delete_outline</mat-icon>
                </span>
              </button>
            </mat-menu>
          </div>
          <!-- <div class="d-flex-items-center pl-2 pr-5 py-2 file-pill">
                                                      <mat-icon
                                                          class="material-icons-outlined colored__purple font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                                      <p>untitled_file.jpg</p>
                                                      <mat-icon class="ml-6 s-18 cursor-pointer" fontSet="material-icons-outlined">file_download</mat-icon>
                                                  </div>
                                                  <div class="d-flex-items-center g-3 pl-2 pr-5 py-4 file-pill">
                                                      <img class="w-21" src="assets/icons/excel-icon.svg">
                                                      <p>untitled_file.excl</p>
                                                      <mat-icon class="ml-6 s-18" fontSet="material-icons-outlined">close</mat-icon>
                                                  </div> -->
        </div>
        <p *ngIf="caption" class="caption"><b>{{'Caption' | translate}}:</b> {{caption}}</p>

        <div [ngClass]="{ element__disable: ssreSimulationRight }" class="input__wrapper mt-15"
          *ngIf="replyLinkCheckbox && !showEscalateview && !showReplyAssignView && !showGroupsView">
          <mat-checkbox *ngFor="let item of replyLinkCheckbox" [checked]="item.checked"
            [disabled]="item.disabled || ssreSimulationRight ? 'true' : null" [ngClass]="{'small_font-size' : !defaultLayout}" [value]="item.replyLinkId"
            (change)="onReplyLinkChange($event,item.name)">{{ item.name | translate }}</mat-checkbox>
        </div>
      </div>

      <!-- Reply Email  -->
      <div [ngClass]="{ element__disable: ssreSimulationRight }" class="reply-email"
        *ngIf="showEmailView && !onlySendMail && !showGroupsView">
        <div *ngIf="selectedTicketView == 1" fxLayout="column" fxFlex="30%" class="email-layout email-new right-border custom__column">
          <div class="reply">
            <div class="send-email__item">
              <div class="send-email__reply--handle">
                <div fxFlex="0 1 calc(50%)" class="flex-select">
                  <ng-template [ngIf]="this.ticketReplyDTO.replyOptions">
                    <mat-form-field *ngIf="selectedTicketView==1" appearance="outline" class="send-email__item material__select">
                    <mat-label>{{ 'Reply-Type' | translate }}</mat-label>
                      <mat-select formControlName="replyType" [(ngModel)]="selectedReplyType" 
                        (selectionChange)="replyTypeChange($event.value)">

                        <ng-container *ngFor="let item of this.ticketReplyDTO.replyOptions">
                        
                          <ng-container *ngIf="item.id == 5 && currentUser?.data?.user?.actionButton?.ticketEscalationEnabled">
                      <mat-option [value]="item.id"> {{ item.value | translate }} </mat-option>
                          </ng-container>
                        
                          <ng-container *ngIf="item.id == 18 && (currentUser?.data?.user?.actionButton?.assignmentEnabled || currentUser?.data?.user?.actionButton?.allowAssignment)">
                      <mat-option [value]="item.id"> {{ item.value | translate }} </mat-option>
                          </ng-container>
                        
                          <ng-container *ngIf="item.id != 5 && item.id != 18 ">
                      <mat-option [value]="item.id"> {{ item.value | translate }} </mat-option>
                          </ng-container>
                        
                        </ng-container>

                      </mat-select>
                    </mat-form-field>
                  </ng-template>
                </div>
                <div fxFlex="0 1 calc(50%)" class="flex-select">
                  <ng-template [ngIf]="
                this.ticketReplyDTO.handleNames &&
                this.ticketReplyDTO.handleNames.length > 0
              ">
                    <mat-form-field *ngIf="selectedTicketView==1" class="material__select" appearance="outline">
                    <mat-label>{{ 'Reply-Handle' | translate }}</mat-label>
                      <mat-select formControlName="replyHandler" (selectionChange)="replyHandleChanged()">
                        <mat-option matTooltip="{{item.handleName.length + item.handleId.length>25?item.handleName+ ' ' +'('+ item.handleId+')':''}}" *ngFor="let item of this.ticketReplyDTO.handleNames" [value]="item.socialId">
                          {{item.handleName }} ({{item.handleId}})
                        </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </ng-template>
                </div>
              </div>

            </div>
          </div>
          <div class="email escemail__header account-profile__matinputvalue" cdkDropListGroup>
            <mat-form-field *ngIf="selectedTicketView==1"  appearance="outline" class="send-email__item material__select chip-list to_tag_input">
              <mat-label>{{ 'To' | translate }}</mat-label>
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailToEmail,'replyTo')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #toemailchipList cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="emailToEmail"
                (cdkDropListDropped)="reorderDroppedItem($event)" id="replyTo">
                  <mat-chip-row *ngFor="let mail of emailToEmail" [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['replyTo']?.includes(mail)" (removed)="removeEmailPill(mail, 'to')" cdkDrag [cdkDragData]="selectedChips['replyTo']?.length >0 ? selectedChips['replyTo'] : mail"
                    (keydown)="handleCtrlKey($event,emailToEmail,'replyTo')" (click)="selectChip($event,mail,'replyTo')">
                    <span class="cursor_move">{{ mail }}</span>
                    <!-- <mat-icon matChipRemove *ngIf=" (!tempToEmail?.includes(mail))">cancel</mat-icon> -->
                    <mat-icon matChipRemove class="pl-2 pr-0 mt-1">cancel</mat-icon>
                  </mat-chip-row>
                  <input #inputRef [matChipInputFor]="toemailchipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                    [matChipInputAddOnBlur]="addOnBlur" (matChipInputTokenEnd)="addEmailPill($event, 'replyTo')" (input) = "onChangeTo($event,'replyTo')" [matAutocomplete]="autoEmailReplyTO" (click)="selectedChips['replyTo'] = []" (keydown.enter)="onChangeTo($event,'replyTo')"/>
                  <mat-autocomplete #autoEmailReplyTO="matAutocomplete"
                    (optionSelected)="addForwardEmailGroup($event, 'to',inputRef)">
                    <ng-container *ngIf="inputRecvd['replyTo']">
                  <p class="toEmailGroupLabel" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
                      <mat-option class="h-30" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                  <p class="toEmailGroupLabel" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
                      <mat-option class="h-30" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-chip-grid>
              </div>
            </mat-form-field>
            <mat-form-field appearance="outline" class="send-email__item material__select chip-list mt-14 to_tag_input cc_bcc_position" *ngIf="replyEmailcc && selectedTicketView == 1">
              <mat-label>{{ 'Cc' | translate }}</mat-label>
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailCCEmails,'replyCC')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #emailchipList cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="emailCCEmails"
                (cdkDropListDropped)="reorderDroppedItem($event)" id="replyCC">
                  <mat-chip-row *ngFor="let mail of emailCCEmails" [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['replyCC']?.includes(mail)" (removed)="removeEmailPill(mail, 'cc')" cdkDrag [cdkDragData]="selectedChips['replyCC']?.length >0 ? selectedChips['replyCC'] : mail"
                    (keydown)="handleCtrlKey($event,emailCCEmails,'replyCC')" (click)="selectChip($event,mail,'replyCC')">
                    <span class="cursor_move">{{ mail }}</span>
                    <mat-icon matChipRemove *ngIf="removable" class="pl-2 pr-0 mt-1">cancel</mat-icon>
                  </mat-chip-row>
                  <input  #emailFieldCc [matChipInputFor]="emailchipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                    (matChipInputTokenEnd)="addEmailPill($event, 'replyCC')" (input) = "onChangeTo($event,'replyCC')"  [matAutocomplete]="autoEmailReplyCC" (click)="selectedChips['replyCC'] = []" (keydown.enter)="onChangeTo($event,'replyCC')"/>
                    <mat-autocomplete #autoEmailReplyCC="matAutocomplete"
                      (optionSelected)="addForwardEmailGroup($event, 'cc',emailFieldCc)">
                      <ng-container *ngIf="inputRecvd['replyCC']">
                  <p class="toEmailGroupLabel" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
                        <mat-option class="h-30" *ngFor="let email of emailGroupSuggestList" [value]="email">
                          {{ email?.groupName }}
                        </mat-option>
                  <p class="toEmailGroupLabel" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
                        <mat-option class="h-30" *ngFor="let email of allGroupEmailList" [value]="email">
                          {{ email }}
                        </mat-option>
                      </ng-container>
                    </mat-autocomplete>
                </mat-chip-grid>
              </div>
                            <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                      <a href="javascript:void(0)" class="ml-7" (click)="replyEmailcc=false" *ngIf="replyEmailcc">- {{ 'Cc' | translate }}</a>
                            </span>
            </mat-form-field>
            <mat-form-field appearance="outline" class="send-email__item material__select chip-list mt-14 to_tag_input cc_bcc_position" *ngIf="replyEmailBcc && selectedTicketView == 1">
              <mat-label>{{ 'Bcc' | translate }}</mat-label>
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailBCCEmails,'replyBCC')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #bccEmailchipList cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="emailBCCEmails"
                (cdkDropListDropped)="reorderDroppedItem($event)" id="replyBCC">
                  <mat-chip-row *ngFor="let mail of emailBCCEmails" [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['replyBCC']?.includes(mail)" (removed)="removeEmailPill(mail, 'bcc')" cdkDrag [cdkDragData]="selectedChips['replyBCC']?.length >0 ? selectedChips['replyBCC'] : mail"
                    (keydown)="handleCtrlKey($event,emailBCCEmails,'replyBCC')" (click)="selectChip($event,mail,'replyBCC')">
                    <span class="cursor_move">{{ mail }}</span>
                    <mat-icon matChipRemove *ngIf="removable" class="pl-2 pr-0 mt-1">cancel</mat-icon>
                  </mat-chip-row>
                  <input #emailField4 [matChipInputFor]="bccEmailchipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                    (matChipInputTokenEnd)="addEmailPill($event, 'replyBCC')" (input) = "onChangeTo($event,'replyBCC')" (click) = "onClickInput()" [matAutocomplete]="autoEmailReply" (click)="selectedChips['replyBCC'] = []" (keydown.enter)="onChangeTo($event,'replyBCC')"/>
                  <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'bcc',emailField4)">
                    <ng-container *ngIf="inputRecvd['replyBCC']">
                  <p class="toEmailGroupLabel" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
                      <mat-option class="h-30" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                  <p class="toEmailGroupLabel" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
                      <mat-option class="h-30" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-chip-grid>
              </div>
                          <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                    <a href="javascript:void(0)" class="ml-7" (click)="replyEmailBcc=false" *ngIf="replyEmailBcc">- {{ 'Bcc' | translate }}</a>
                          </span>
            </mat-form-field>
          </div>
          <div *ngIf="selectedTicketView==1" class="d-flex-items-center">
              <span  class="ml-auto" >
              <a href="javascript:void(0)" class="mr-4" (click)="checkReplyEmailCc()" *ngIf="!replyEmailcc">+ {{ 'Cc' | translate }}</a>
              <a href="javascript:void(0)" (click)="checkReplyEmailBcc()" *ngIf="!replyEmailBcc">+ {{ 'Bcc' | translate }}</a>
              </span>
          </div>


          <div [ngClass]="{ element__disable: ssreSimulationRight }" class="input__wrapper"
            *ngIf="replyLinkCheckbox && !showEscalateview && !showReplyAssignView && !showGroupsView && selectedTicketView==1">
            <mat-checkbox *ngFor="let item of replyLinkCheckbox" matTooltip="{{item.tooltip}}" [checked]="item.checked"
              [disabled]="item.disabled || ssreSimulationRight ? 'true' : null" [value]="item.replyLinkId"
              (change)="onReplyLinkChange($event,item.name)"><span class="input__wrapper--label">{{ item.name | translate }}</span></mat-checkbox>
          </div>
        </div>
        <div [fxFlex]="selectedTicketView == 3?'100%':'70%'" class="custom__column">
        <!-- <div class="ai-note" *ngIf="isAICaution">
          <p><span class="text__label ai-note__title">Caution: </span> <span class="ai-note__note">{{cautionText}}</span></p>
          <mat-icon fontSet="material-icons-outlined" class="cursor-pointer" (click)="this.isAICaution = false">close</mat-icon>
        </div> -->
        <div class="send-email__item position-relative post-reply__ckeditor">
        <div *ngIf="ckEditorLoader" class="send-email__item--spinner">
          <mat-spinner color="accent"></mat-spinner>
        </div>

        <div *ngIf="selectedTicketView==3" class="send-email__item--option d-flex-items-center">
          <span class="email-reply text__light d-flex-items-center blue-pill border-radius-16"
          [ngClass]="defaultLayout ? 'g-10 px-10 py-2' : 'small_font-size g-5 pr-5 pl-8'" [matMenuTriggerFor]="replyEscalate">
            <!-- <mat-icon class="mb-5 mr-2" fontSet="material-icons-outlined">reply</mat-icon> -->
             <p class="colored__main--text font-weight-600">{{'Reply-Type' | translate}}: </p>
            <span class="cursor-pointer colored__locobuzz text__ellipsis max-w-130">{{replyTypeName | translate}}</span>
            <mat-icon class="cursor-pointer s-20" fontSet="material-icons-outlined colored__locobuzz">expand_more</mat-icon>
          </span>
          <span class="email-reply text__light d-flex-items-center blue-pill border-radius-16 ml-8"
            [ngClass]="defaultLayout ? 'g-10 px-10 py-2' : 'small_font-size g-5 pr-5 pl-8'">
            <!-- <mat-icon class="mb-5 mr-2" fontSet="material-icons-outlined">reply</mat-icon> -->
            <p class="colored__main--text font-weight-600">{{'Reply-Handle' | translate}}: </p>
            <span class="cursor-pointer colored__locobuzz">{{replyForm.get('replyHandler').value}} 
              <!-- <mat-icon class="cursor-pointer s-20"
                fontSet="material-icons-outlined colored__locobuzz">expand_more</mat-icon> -->
            </span>
          </span>
          <span class="email-id text__light">
            <span class="text-underline">
              <!-- {{ticketHistoryData?.tomaillist}} -->
               <!-- {{ replyForm.get('replyHandler').value }} -->
            </span>
            <!-- <span  class="add-email">
              <mat-icon *ngIf="!showEmailFriendlyView" (click)="showEmailFriendlyView=true" fontSet="material-icons-outlined"
                class="border-radius-4 bg__grey ml-7 s-20 cursor-pointer">add</mat-icon>
                <mat-icon *ngIf="showEmailFriendlyView" (click)="showEmailFriendlyView=false" fontSet="material-icons-outlined"
                  class="border-radius-4 bg__grey ml-7 s-20 cursor-pointer">cancel</mat-icon>
            </span> -->
          </span>
          <span *ngIf="selectedTicketView==3" class="d-flex-items-center ml-auto g-10 close-option">
            <mat-icon fontSet="material-icons-outlined" class="cursor-pointer"
            [ngClass]="{'small-icon-font-size' : !defaultLayout}" (click)="closePostReply()">close</mat-icon>
          </span>
        </div>
        <mat-menu #replyEscalate="matMenu" [ngClass]="defaultLayout ? 'w-320' : 'w-250'">
          <ng-container *ngFor="let item of this.ticketReplyDTO.replyOptions">
            <ng-container *ngIf="item.id == 5 && currentUser?.data?.user?.actionButton?.ticketEscalationEnabled">
              <button [ngClass]="{'small_font-size h-25' : !defaultLayout}" (click)="replyHandleChanged();changeReplyHandleEvent(item)" mat-menu-item>{{item.value | translate}}</button>
            </ng-container>
            
            <ng-container
              *ngIf="item.id == 18 && (currentUser?.data?.user?.actionButton?.assignmentEnabled || currentUser?.data?.user?.actionButton?.allowAssignment)">
              <button [ngClass]="{'small_font-size h-25' : !defaultLayout}" (click)="replyHandleChanged();changeReplyHandleEvent(item)" mat-menu-item>{{item.value | translate}}</button>
            </ng-container>
            
            <ng-container *ngIf="item.id != 5 && item.id != 18 ">
              <button [ngClass]="{'small_font-size h-25' : !defaultLayout}" (click)="replyHandleChanged();changeReplyHandleEvent(item)" mat-menu-item>{{item.value | translate}}</button>
            </ng-container>
          </ng-container>
        </mat-menu>

        <!-- <div *ngIf="selectedTicketView==3" class="custom-chip">
          <span class="text__label mr-10">To</span>
          <span class="custom-chip__list">john@locobuzz.com <mat-icon class="mr-8"
              fontSet="material-icons-outlined">cancel</mat-icon></span>
          <input type="text" placeholder="Enter email address">
        </div>
        <div class="custom-chip" *ngIf="replyEmailcc && selectedTicketView==3">
          <span class="text__label mr-10">Cc</span>
          <span class="custom-chip__list">john@locobuzz.com <mat-icon class="mr-8"
              fontSet="material-icons-outlined">cancel</mat-icon></span>
          <input type="text" placeholder="Enter email address">
          <span matSuffix class="d-flex-items-center ml-auto material__select--suffix">
            <a href="javascript:void(0)" class="ml-7" (click)="replyEmailcc=false" *ngIf="replyEmailcc">- Cc</a>
          </span>
        </div>
        <div class="custom-chip mb-12" *ngIf="replyEmailBcc && selectedTicketView==3">
          <span class="text__label mr-10">Bcc</span>
          <span class="custom-chip__list">john@locobuzz.com <mat-icon class="mr-8"
              fontSet="material-icons-outlined">cancel</mat-icon></span>
          <input type="text" placeholder="Enter email address">
          <span matSuffix class="d-flex-items-center ml-auto material__select--suffix">
            <a href="javascript:void(0)" class="ml-7" (click)="replyEmailBcc=false" *ngIf="replyEmailBcc">- Bcc</a>
          </span>
        </div> -->

        <div cdkDropListGroup class="flex-direction-column g-1">
        <div *ngIf="selectedTicketView==3 && showEmailFriendlyView" class="send-email__item send-email__emailfriendly">
          <!-- <mat-form-field appearance="outline" class="material__select">
                        <mat-label>To</mat-label>
                        <mat-chip-list #chipList>
                            <mat-chip [selectable]="true" [removable]="true">
                                john.doe@gmail.com
                                <mat-icon matChipRemove>cancel</mat-icon>
                            </mat-chip>
                            <input>
                        </mat-chip-list>
                    </mat-form-field> -->
          <div class="send-email__emailfriendly--left d-flex-items-center mr-10" [ngClass] = "{'w-5-p': pageType == pageTypeEnum.TicketHistory, 'w-unset' : !defaultLayout, 'w-88' : defaultLayout}" >
            <span class="font-weight-600" [ngClass]="{'medium-font-size whitespace-nowrap' : !defaultLayout}">{{'Reply-To' | translate}}:</span>
          </div>
          <div class="send-email__emailfriendly--right" [ngClass] = "{'w-95-p': pageType == pageTypeEnum.TicketHistory}">
              <mat-form-field appearance="outline" class="material__select to_tag_input no-outline">
                <mat-label></mat-label>
                <div class="chip-container" #emailToChipContainer (keydown)="handleKeyboardEvent($event,emailToEmail,'EFreplyTo')" (keyup)="onParentKeyup($event)">
                  <mat-chip-grid #sendtoemailchip cdkDropList
                                cdkDropListOrientation="horizontal" [cdkDropListData]="emailToEmail"
                                (cdkDropListDropped)="reorderDroppedItem($event)" id="EFreplyTo">
                    <ng-container  *ngFor="let mail of emailToEmail | slice:0:emailToChipPosition;">
                      <mat-chip-row #emailToChipElement [selectable]="selectable" [removable]="removable" [class.selected]="selectedChips['EFreplyTo']?.includes(mail)"
                      (removed)="removeEmailPill(mail, 'to')" cdkDrag [cdkDragData]="selectedChips['EFreplyTo']?.length >0 ? selectedChips['EFreplyTo'] : mail"
                      (keydown)="handleCtrlKey($event,emailToEmail,'EFreplyTo')" (click)="selectChip($event,mail,'EFreplyTo')"
                      [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory, 'h-30' : !defaultLayout}">
                        <div class="d-flex-items-center g-10">
                          <div *ngIf="!tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23 bg__yellow--dark border-round">
                            <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                          </div>
                          <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail"
                          [ngClass]="{'small_font-size' : !defaultLayout}">{{ mail }}</span>
                          <mat-icon matChipRemove [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                          *ngIf=" (!tempToEmail?.includes(mail))" class="s-16 pl-2 pr-0 mt-1">cancel</mat-icon>
                        </div>
                      </mat-chip-row>
                    </ng-container>

                   <ng-container *ngIf="emailToEmail?.length>emailToChipPosition">
                      <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                        [matMenuTriggerFor]="moreProfiles">
                        <p>+{{emailToEmail?.slice(emailToChipPosition)?.length}}</p>
                      </div>
                      <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300" style="max-height: 220px;min-height: auto !important;">
                        <div class="more-profiles-container flex-direction-column g-10 p-10">
                          <!-- <div  *ngFor="let mail of emailToEmail | slice:emailToChipPosition:emailToEmail.length;"
                            class="grey-pill subject-pill width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between">
                            <div class="d-flex-items-center g-5">
                              <div class="w-20 h-20 border-round">
                                <img class="w-100-p h-100-p border-round"
                                  src="https://imgv3.fotor.com/images/slider-image/A-clear-close-up-photo-of-a-woman.jpg">
                              </div>
                              <p>{{mail}}</p>
                            </div>
                            <mat-icon class="cursor-pointer font-size-14 d-flex-items-center justify-content__center">close</mat-icon>
                          </div> -->
                          <div *ngFor="let mail of emailToEmail | slice:emailToChipPosition:emailToEmail.length;" [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"
                            class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                            <div class="d-flex-items-center g-5">
                              <div  *ngIf="!tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" [ngClass]="{'bg__yellow--dark': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}" class="w-23 h-23  border-round">
                                <mat-icon
                                  class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                              </div>
                              <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail"
                              class="colored__main--text" [ngClass]="{'small_font-size' : !defaultLayout}">{{mail}}</p>
                            </div>
                            <mat-icon (click)="removeEmailPill(mail, 'to')" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                              class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                          </div>
                        </div>
                      </mat-menu>
                   </ng-container>
                  
                <input #emailToInputRef placeholder="{{ 'Enter-Email-Address' | translate }}" [matChipInputFor]="sendtoemailchip"
                      [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                      (matChipInputTokenEnd)="addEmailPill($event, 'EFreplyTo')" [matAutocomplete]="autoEmailReply" (input) = "onChangeTo($event,'EFreplyTo')" (click)="selectedChips['EFreplyTo'] = []" (keydown.enter)="onChangeTo($event,'EFreplyTo')"/>
                    <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'to',emailToInputRef)">
                      <ng-container *ngIf="inputRecvd['EFreplyTo']">
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                          {{ email?.groupName }}
                        </mat-option>
                  <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
                  <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                          {{ email }}
                        </mat-option>
                      </ng-container>
                    </mat-autocomplete>
                  </mat-chip-grid>
                </div>
              <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                <a href="javascript:void(0)" [ngClass]="{'medium-font-size' : !defaultLayout}" class="mr-8 colored__locobuzz" (click)="replyEmailcc=true" *ngIf="!replyEmailcc">+
                {{ 'Cc' | translate }}</a>
                <a href="javascript:void(0)" [ngClass]="{'medium-font-size' : !defaultLayout}" class="colored__locobuzz" (click)="replyEmailBcc=true" *ngIf="!replyEmailBcc">+ {{ 'Bcc' | translate }}</a>
               </span>
              </mat-form-field>
          </div>
        </div>
        <div class="send-email__item send-email__emailfriendly m-top-10" *ngIf="replyEmailcc && selectedTicketView==3 && showEmailFriendlyView">
          <div class="send-email__emailfriendly--left d-flex-items-center mr-10" [ngClass] = "{'w-5-p': pageType == pageTypeEnum.TicketHistory, 'medium-font-size ai-layout-width' : !defaultLayout, 'w-88' : defaultLayout}">
            <span class="font-weight-600">{{'Cc' | translate}}:</span>
          </div>
          <div class="send-email__emailfriendly--right" [ngClass] = "{'w-95-p': pageType == pageTypeEnum.TicketHistory}">
            <mat-form-field appearance="outline" class="material__select to_tag_input cc_bcc_position no-outline">
              <mat-label></mat-label>
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailCCEmails,'EFreplyCC')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #emailchipList cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="emailCCEmails"
                (cdkDropListDropped)="reorderDroppedItem($event)" id="EFreplyCC">
                  <mat-chip-row *ngFor="let mail of emailCCEmails | slice:0:emailToChipPosition;" [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['EFreplyCC']?.includes(mail)" (removed)="removeEmailPill(mail, 'cc')" cdkDrag [cdkDragData]="selectedChips['EFreplyCC']?.length >0 ? selectedChips['EFreplyCC'] : mail"
                    (keydown)="handleCtrlKey($event,emailCCEmails,'EFreplyCC')" (click)="selectChip($event,mail,'EFreplyCC')" [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}">
                    <div class="d-flex-items-center g-10">
                      <div *ngIf="!tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23 bg__yellow--dark border-round">
                        <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                      </div>
                      <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                      [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail">{{ mail }}</span>
                      <mat-icon matChipRemove *ngIf="removable" class="s-16 pl-2 pr-0 mt-1" [ngClass]="{'small-icon-font-size' : !defaultLayout}">cancel</mat-icon>
                    </div>
                  </mat-chip-row>
                    <ng-container  *ngIf="emailCCEmails?.length>emailToChipPosition">
                      <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                        [matMenuTriggerFor]="moreProfiles">
                        <p>+{{emailCCEmails?.slice(emailToChipPosition)?.length}}</p>
                      </div>
                      <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300" style="max-height: 220px;min-height: auto !important;">
                        <div class="more-profiles-container flex-direction-column g-10 p-10">
                          <!-- <div  *ngFor="let mail of emailToEmail | slice:emailToChipPosition:emailToEmail.length;"
                                                class="grey-pill subject-pill width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between">
                                                <div class="d-flex-items-center g-5">
                                                  <div class="w-20 h-20 border-round">
                                                    <img class="w-100-p h-100-p border-round"
                                                      src="https://imgv3.fotor.com/images/slider-image/A-clear-close-up-photo-of-a-woman.jpg">
                                                  </div>
                                                  <p>{{mail}}</p>
                                                </div>
                                                <mat-icon class="cursor-pointer font-size-14 d-flex-items-center justify-content__center">close</mat-icon>
                                              </div> -->
                          <div *ngFor="let mail of emailCCEmails | slice:emailToChipPosition:emailCCEmails.length;"
                            [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"
                            class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                            <div class="d-flex-items-center g-5">
                              <div *ngIf="!tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" [ngClass]="{'bg__yellow--dark': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}" class="w-23 h-23  border-round">
                                <mat-icon 
                                  class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                              </div>
                              <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail"
                              [ngClass]="{'small_font-size' : !defaultLayout}" class="colored__main--text">{{mail}}</p>
                            </div>
                            <mat-icon (click)="removeEmailPill(mail, 'cc')" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                              class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                          </div>
                        </div>
                      </mat-menu>
                    </ng-container>
                  <input #inputRef placeholder="{{'Enter-Email-Address' | translate}}" [matChipInputAddOnBlur]="addOnBlur" [matChipInputFor]="emailchipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="addEmailPill($event, 'EFreplyCC')" [matAutocomplete]="autoEmailReply" (input) = "onChangeTo($event,'EFreplyCC')" (click)="selectedChips['EFreplyCC'] = []" (keydown.enter)="onChangeTo($event,'EFreplyCC')"/>
                  <mat-autocomplete #autoEmailReply="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'cc',inputRef)">
                    <ng-container *ngIf="inputRecvd['EFreplyCC']">
                <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd">{{ 'Suggested-Email-Groups' | translate }}</p>
                <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of emailGroupSuggestList" [value]="email">
                        {{ email?.groupName }}
                      </mat-option>
                <p class="toEmailGroupLabel" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd">{{ 'Suggested-Emails' | translate }}</p>
                <mat-option class="h-30" [ngClass]="{'small_font-size' : !defaultLayout}" *ngFor="let email of allGroupEmailList" [value]="email">
                        {{ email }}
                      </mat-option>
                    </ng-container>
                  </mat-autocomplete>
                </mat-chip-grid>
              </div>
              <span matSuffix class="d-flex-items-center" class="material__select--suffix" [ngClass]="{'medium-font-size' : !defaultLayout}">
                <a href="javascript:void(0)" class="mr-8 colored__locobuzz" (click)="replyEmailcc=false" *ngIf="replyEmailcc">-
                  {{'Cc' | translate}}</a>
              </span>
            </mat-form-field>
          </div>
        </div>
        <div class="send-email__item send-email__emailfriendly m-top-10" *ngIf="replyEmailBcc && selectedTicketView==3 && showEmailFriendlyView">
          <div class="send-email__emailfriendly--left d-flex-items-center mr-10 w-88" [ngClass] = "{'w-5-p': pageType == pageTypeEnum.TicketHistory, 'medium-font-size ai-layout-width' : !defaultLayout, 'w-88' : defaultLayout}">
            <span class="font-weight-600 d-flex-items-center pr-16-p" [ngClass]="{'medium-font-size' : !defaultLayout}">{{'Bcc' | translate}}:</span>
          </div>
          <div class="send-email__emailfriendly--right" [ngClass] = "{'w-95-p': pageType == pageTypeEnum.TicketHistory}">
            <mat-form-field appearance="outline" class="material__select to_tag_input cc_bcc_position no-outline">
              <mat-label></mat-label>
              <div class="chip-container" (keydown)="handleKeyboardEvent($event,emailBCCEmails,'EFreplyBCC')" (keyup)="onParentKeyup($event)">
                <mat-chip-grid #bccEmailchipList cdkDropList
                cdkDropListOrientation="horizontal" [cdkDropListData]="emailBCCEmails"
                (cdkDropListDropped)="reorderDroppedItem($event)" id="EFreplyBCC">
                  <mat-chip-row *ngFor="let mail of emailBCCEmails | slice:0:emailToChipPosition;" [selectable]="selectable" [removable]="removable"
                    [class.selected]="selectedChips['EFreplyBCC']?.includes(mail)" (removed)="removeEmailPill(mail, 'bcc')" cdkDrag [cdkDragData]="selectedChips['EFreplyBCC']?.length >0 ? selectedChips['EFreplyBCC'] : mail"
                    (keydown)="handleCtrlKey($event,emailBCCEmails,'EFreplyBCC')" (click)="selectChip($event,mail,'EFreplyBCC')" [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}">
                    <div class="d-flex-items-center g-10">
                      <div *ngIf="!tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" class="w-23 h-23 bg__yellow--dark border-round">
                        <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                      </div>
                      <span class="cursor_move" appEmailTruncate [emailId]="mail" [ngClass]="{'small_font-size' : !defaultLayout}" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail">{{ mail }}</span>
                      <mat-icon matChipRemove *ngIf="removable" class="s-16 pl-2 pr-0 mt-1">cancel</mat-icon>
                    </div>
                  </mat-chip-row>
                  <ng-container  *ngIf="emailBCCEmails?.length>emailToChipPosition">
                    <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                      [matMenuTriggerFor]="moreProfiles">
                      <p>+{{emailBCCEmails?.slice(emailToChipPosition)?.length}}</p>
                    </div>
                    <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300" style="max-height: 220px;min-height: auto !important;">
                      <div class="more-profiles-container flex-direction-column g-10 p-10">
                        <!-- <div  *ngFor="let mail of emailToEmail | slice:emailToChipPosition:emailToEmail.length;"
                                                                  class="grey-pill subject-pill width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between">
                                                                  <div class="d-flex-items-center g-5">
                                                                    <div class="w-20 h-20 border-round">
                                                                      <img class="w-100-p h-100-p border-round"
                                                                        src="https://imgv3.fotor.com/images/slider-image/A-clear-close-up-photo-of-a-woman.jpg">
                                                                    </div>
                                                                    <p>{{mail}}</p>
                                                                  </div>
                                                                  <mat-icon class="cursor-pointer font-size-14 d-flex-items-center justify-content__center">close</mat-icon>
                                                                </div> -->
                        <div *ngFor="let mail of emailBCCEmails | slice:emailToChipPosition:emailBCCEmails.length;"
                          [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}"
                          class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                          <div class="d-flex-items-center g-5">
                            <div *ngIf="!tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory" [ngClass]="{'bg__yellow--dark': !tempAllGroupEmailList?.includes(mail) && pageType == pageTypeEnum.TicketHistory}" class="w-23 h-23  border-round">
                              <mat-icon 
                                class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                            </div>
                            <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail" class="colored__main--text">{{mail}}</p>
                          </div>
                          <mat-icon (click)="removeEmailPill(mail, 'bcc')" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                            class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                        </div>
                      </div>
                    </mat-menu>
                  </ng-container>
            <input #emailField5 placeholder="{{ 'Enter-Email-Address' | translate }}" [matChipInputFor]="bccEmailchipList"
                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                    (matChipInputTokenEnd)="addEmailPill($event, 'EFreplyBCC')" (input) = "onChangeTo($event,'EFreplyBCC')" [matAutocomplete]="autoReply1" (click)="selectedChips['EFreplyBCC'] = []" (keydown.enter)="onChangeTo($event,'EFreplyBCC')"/>
                    <mat-autocomplete #autoReply1="matAutocomplete" (optionSelected)="addForwardEmailGroup($event,'bcc',emailField5)">
                      <ng-container *ngIf="inputRecvd['EFreplyBCC']">
                        <p class="toEmailGroupLabel" *ngIf="emailGroupSuggestList && emailGroupSuggestList.length && inputRecvd" [ngClass]="{'small_font-size' : !defaultLayout}">Suggested Email Groups</p>
                        <mat-option class="h-30" *ngFor="let email of emailGroupSuggestList" [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                          {{ email?.groupName }}
                        </mat-option>
                        <p class="toEmailGroupLabel" *ngIf="allGroupEmailList && allGroupEmailList.length && inputRecvd" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Emails' | translate}}</p>
                        <mat-option class="h-30" *ngFor="let email of allGroupEmailList" [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                          {{ email }}
                        </mat-option>
                      </ng-container>
                    </mat-autocomplete>
                </mat-chip-grid>
              </div>
              <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                <a href="javascript:void(0)" (click)="replyEmailBcc=false" *ngIf="replyEmailBcc" class="colored__locobuzz">- {{'Bcc' | translate}}</a>
              </span>
            </mat-form-field>
          </div>
        </div>
        </div>
          
        <!-- <div class="send-email__emailblock p-0" contenteditable="true" [innerHTML]="emailReplyText"></div> -->

          <!-- <textarea  (ready)="onReady($event)" id="ckeditor" [editor]="Editor" formControlName="ckeditorText" (drop)="drop($event)"
            (paste)="paste($event)" [(ngModel)]="emailReplyText" [config]="editorConfig"></textarea> -->
            <div class="position-relative">
          <ckeditor (ready)="onReady($event)" id="ckeditor"[editor]="Editor" formControlName="ckeditorText" (drop)="drop($event)" (paste)="paste($event)"  [(ngModel)]="emailReplyText"
            [config]="editorConfig" class="editor-height"></ckeditor>
            <div *ngIf="showEmailPopup" class="position-absolute w-35 h-35 border-round popup-btn cursor-pointer d-flex-items-center justify-content__center" (click)="emailPopUpView()">
              <mat-icon class="s-18 d-flex-items-center justify-content__center popup-icon mt-3">picture_in_picture_alt</mat-icon>
            </div>
        <!-- rephraseLoader -->
            <app-component-loader class="message__line--loader" *ngIf="rephraseLoaderForTextarea" [postCountTotal]="2"
              [loaderType]="loaderTypeEnum.messageline" [rephraseLoader]="true" [emailRephraseLoader]="true">
            </app-component-loader>
            </div>
            <div fxLayout="row" class="toggle_pre_mail_icon"  [ngClass]="{'toggle_pre_mail_icon__loader': rephraseLoader, 'toggle__Mail':selectedTicketView == 1}">
              <div fxFlex="0 1 calc(100%)" class="d-flex-items-center ">
                <!-- <div [ngClass]="{ element__disable: ssreSimulationRight }" class="input__wrapper mt-15"
                          *ngIf="replyLinkCheckbox && !showEscalateview && !showGroupsView">
                          <mat-checkbox *ngFor="let item of replyLinkCheckbox" matTooltip="{{item.tooltip}}"
                            [checked]="item.checked" [disabled]="item.disabled || ssreSimulationRight ? 'true' : null"
                            [value]="item.replyLinkId" (change)="onReplyLinkChange($event,item.name)">{{ item.name }}</mat-checkbox>
                        </div> -->
                <!-- <div [ngClass]="{ element__disable: ssreSimulationRight }" class="textarea-featured__foot--item ml-auto"
                          (click)="openCannedResponse()">
                          <a href="javascript:void(0)" class="text__regular--sm textarea-featured__foot--boxed">Canned Response</a>
                        </div> -->

                <span *ngIf="showPrevoiusMail" [ngClass]="{'element__disable': ckEditorLoader}" class="post-reply__mail--open mr-7" matTooltip="{{'Show-Trimmed-Content' | translate}}" matTooltipClass="custom-tooltip" (click)="togglePrevMail()">
                  <mat-icon fontSet="material-icons-outlined">more_horiz</mat-icon>
                  <!-- [ngClass]="{'element__disable': !item.text && item.text.length <= 0}" -->
                  <!-- <mat-icon fontSet="material-icons-outlined">{{ showPrevoiusMail ? 'arrow_drop_up' : 'arrow_drop_down'}}</mat-icon> -->
                </span>

                <ng-container *ngIf="selectedTicketView == 1">
                  <ng-container
                    *ngIf="showAiFeature && loadAiFeature && isRephraseToolbar && !this.showAICreditExpired; else otherRephraseIcon">
                    <img [src]="AIFeatureStyleObj?.rephraseIcon" class="cursor-pointer"
                      [ngClass]="{'element__disable': !emailReplyText && emailReplyText.length <= 0}"
                      (click)="setSelectText( false, true); $event.stopPropagation(); openRephrasePopup(0);" id="rephrase_0"
                      [matTooltip]="AIFeatureStyleObj?.rephraseTootip" [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip"
                      matTooltipClass="custom-tooltip">
                  </ng-container>
                  <ng-template #otherRephraseIcon>
                    <img [src]="AIFeatureStyleObj?.rephraseIcon" [matTooltip]="AIFeatureStyleObj?.rephraseTootip"
                      [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip" matTooltipClass="custom-tooltip">
                  </ng-template>

                  <ng-container *ngIf="AIFeatureStyleObj?.suggestIcon">
                    <ng-container
                      *ngIf="showAiFeature && rephraseOptions?.isAISuggestion && loadAiFeature && !this.showAICreditExpired; else otherSuggestIcon">
                      <span (click)="openAISmartSuggestion($event); aiMessageFeedback = 2" class="d-flex-items-center">
                        <img [src]="AIFeatureStyleObj?.suggestIcon" (click) = "aiMessageFeedback = 2" [ngClass]="{ element__disable: aiSuggestionLoader}"
                          class="cursor-pointer aiSmartSuggesionMenu ml-5"   (menuOpened)="validate()" (menuClosed)="removeCloneBackdrop()" [matMenuTriggerFor]="showLockStrip ? '' :menu"
                          [matTooltip]="AIFeatureStyleObj?.suggestTootip" [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip"
                          matTooltipClass="custom-tooltip" [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" />
                      </span>
                    </ng-container>
                    <ng-template #otherSuggestIcon>
                      <img [src]="AIFeatureStyleObj?.suggestIcon" [ngClass]="{ element__disable: aiSuggestionLoader}"
                        class="cursor-pointer ml-5" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                        [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip" />
                    </ng-template>
                  </ng-container>
                  <img class="ml-13 cursor-pointer" (click)="openCannedResponse()" src="assets/images/chatbot/canned.svg"
                    matTooltip="{{'Canned-Response' | translate}}" matTooltipClass="custom-tooltip" [ngClass]="defaultLayout ? 'w-20' : 'small-image-width'">
                  <ng-container *ngIf="showMediaButton">
                    <a class="ml-13" matTooltip="{{'Attach-Media' | translate}}" matTooltipClass="custom-tooltip"
                      [ngClass]="{'element__disable' : ssreSimulationRight }" href="javascript:void(0)" (click)="openMediaDialog()">
                      <mat-icon [ngClass]="defaultLayout ? 's-22' : 'small-icon-font-size d-flex-items-center justify-content__center'"
                      fontSet="material-icons-outlined" style="color:var(--color-light-text)">insert_photo</mat-icon>
                    </a>
                  </ng-container>
                    <mat-menu #menu="matMenu"  backdropClass="controlled" class="aiinsertMenu w-622 border-radius-8" yPosition="above" xPosition="after">
                    <div class="aiinsertMenu__head bg__grey">
                      <div class="d-flex-items-center" (click)="$event.stopPropagation()">
                        <img src="assets/images/AI_Icon.svg" [ngClass]="{'small-image-width' : !defaultLayout}" class="w-16 mr-3" />
                        <span class="font-size-12 font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Generate-Response' | translate}}</span>
                      </div>
                      <mat-icon fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                        (click)="$event.preventDefault(); rephraseLoader = false;aiSuggestionLoader = false"
                        class="s-22 ml-auto right-auto cursor-pointer">
                        close</mat-icon>
                    </div>
                    <div class="aiinsertMenu__body bg__white">
                      <div class="aiinsertMenu__body--content" [ngClass]="isAICaution ? 'bg__red02' : ''">
                        <div class="body" (click)="$event.stopPropagation()">
                          <div class="h-50" *ngIf="rephraseLoader">
                            <app-component-loader class="message__line--loader" [postCountTotal]="2"
                              [loaderType]="loaderTypeEnum.aiAutoResponse" [rephraseLoader]="true" [emailRephraseLoader]="true">
                            </app-component-loader>
                          </div>
                          <p class="disabled_select" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="rephraseText && !rephraseLoader" [innerHtml]="rephraseText"></p>
                          <ng-container *ngIf="!rephraseText && !rephraseLoader">
                            <div class="noData block-center rowSize">
                              <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}">error_outline</mat-icon>
                              <p [ngClass]="{'small_font-size' : !defaultLayout}">{{'No-Response-Found' | translate}}</p>
                            </div>
                          </ng-container>
                        </div>
                        <div class="foot g-15">
                          <button mat-flat-button color="accent" [ngClass]="{'small_font-size' : !defaultLayout}" class="btn-insert" [disabled]="rephraseLoader || !rephraseText"
                            (click)="aiResponseInsert();$event.preventDefault()">
                            {{'Use' | translate}}
                          </button>
                          <button mat-stroked-button color="accent" [ngClass]="{'small_font-size' : !defaultLayout}" [disabled]="rephraseLoader || !rephraseText"
                            (click)="rejectAi();$event.preventDefault()" class="btn-reject" [mat-dialog-close]="true">
                            {{'Discard' | translate}}
                          </button>
                          <span class="text__light--sm text-italic" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="!isAICaution && !rephraseLoader"
                            (click)="$event.stopPropagation()"><mat-icon class="mr-5 in_knowledge" [ngClass]="{'small-icon-font-size' : !defaultLayout}">check_circle</mat-icon>{{'Response-From-Knowledge-Base' | translate}}</span>
                          <span class="text__light--sm text-italic" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="isAICaution && !rephraseLoader"
                            (click)="$event.stopPropagation()"><mat-icon class="mr-5 out_of_knowledge" [ngClass]="{'small-icon-font-size' : !defaultLayout}">cancel</mat-icon>{{'Response-From-Outside-Knowledge-Base' | translate}}</span>
                          <div class="ml-auto right-auto d-flex-items-center g-12" [ngClass]="{ element__disable: rephraseLoader}" (click)="$event.stopPropagation()">
                            <mat-icon *ngIf="aiMessageFeedback == 1" class="s-18 text-green" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                              (click)="$event.stopPropagation()">thumb_up</mat-icon>
                            <mat-icon *ngIf="aiMessageFeedback != 1" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="material-icons-outlined s-18 text__light cursor-pointer"
                              (click)="aiMessageFeedback = 1;trackAIResponse()">
                              thumb_up
                            </mat-icon>
                            <mat-icon class="material-icons-outlined s-18 text__light cursor-pointer" [ngClass]="{'small-icon-font-size' : !defaultLayout}" *ngIf = "aiMessageFeedback != 0" (click)="rejectAi(true)">
                              thumb_down
                            </mat-icon>
                            <mat-icon class="material-icons-outlined s-18 text__light cursor-pointer colored__red--dark" [ngClass]="{'small-icon-font-size' : !defaultLayout}"  *ngIf = "aiMessageFeedback == 0" (click)="rejectAi(true)">
                              thumb_down
                            </mat-icon>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="aiinsertMenu__foot bg__white" *ngIf="rephraseText" (click)="$event.stopPropagation()">
                      <app-rephrase class="rephrase" [aiAutoResponse]="true" [rephraseOptions]="rephraseOptions"></app-rephrase>
                    </div>
                  </mat-menu>
                </ng-container>
                <!-- <ng-container >
                  <img class="ml-13 w-20 cursor-pointer" src="assets/images/common/float_landscape_2.svg" matTooltip="Open in a pop-up"
                    matTooltipClass="custom-tooltip" (click)="emailPopUpView()">
                </ng-container> -->
              </div>
            </div>
        </div>

        <!-- <ng-container *ngIf="selectedTicketView == 1">
          <div class="d-flex-items-center mt-12 w-auto">
            <a [ngClass]="{ element__disable: ssreSimulationRight }"
              class="textarea-featured__foot--icon textarea-featured__foot--item" href="javascript:void(0)"
              (click)="openMediaDialog()">
              <mat-icon fontSet="material-icons-outlined">insert_photo</mat-icon>
              <span>Attach Media</span>
              <span *ngIf="selectedMedia.length > 0">({{ selectedMedia.length }})</span>
            </a>
            <div class="d-flex-items-center ml-auto">
              <ng-container *ngIf="AIFeatureStyleObj?.suggestIcon">
                <ng-container
                  *ngIf="showAiFeature && rephraseOptions?.isAISuggestion && loadAiFeature && !this.showAICreditExpired; else otherSuggestIcon">
                  <div class="textarea-featured__foot--item" [ngClass]="{ element__disable: aiSuggestionLoader}"
                      (click)="openAISmartSuggestion($event); aiMessageFeedback = 2">
                    <a href="javascript:void(0)" [matMenuTriggerFor]="showLockStrip ? '' :menu" (menuOpened)="validate()" (menuClosed)="removeCloneBackdrop()" class="text__regular--sm textarea-featured__foot--boxed"
                      [ngStyle]="{'border': AIFeatureStyleObj?.suggestionBorder}" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                      [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip">
                      <img [src]="AIFeatureStyleObj?.suggestIcon"
                        [ngClass]="{'m-3 ml-0': !showAICreditExpired && !showAICreditExpiredAlert}">
                      Smart Suggestions</a>
                  </div>
                </ng-container>
                <ng-template #otherSuggestIcon>
                  <div class="textarea-featured__foot--item">
                    <a href="javascript:void(0)" class="text__regular--sm textarea-featured__foot--boxed"
                      [ngStyle]="{'border': AIFeatureStyleObj?.suggestionBorder}" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                      [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip">
                      <img [src]="AIFeatureStyleObj?.suggestIcon"
                        [ngClass]="{'m-3 ml-0': !showAICreditExpired && !showAICreditExpiredAler ||(!rephraseOptions?.isAISuggestion)}">
                      Smart Suggestions</a>
                  </div>
                </ng-template>
              </ng-container>
              <div [ngClass]="{ element__disable: ssreSimulationRight }" class="textarea-featured__foot--item "
                (click)="openCannedResponse()">
                <a href="javascript:void(0)" class="text__regular--sm textarea-featured__foot--boxed">Canned Response</a>
              </div>
            </div>
          </div>
        </ng-container> -->
        <ng-container>
        <!-- <div [ngClass]="{ element__disable: ssreSimulationRight }" *ngIf="mediaSelectedAsync$ | async as MediaSelected"
          class="textarea-featured__foot--item--media mt-10" (click)="checkCcBccEmpty()">
          <ng-template ngFor let-ugc [ngForOf]="MediaSelected">
            <span *ngIf="ugc.mediaType == 2" matTooltip="{{ugc?.displayFileName}}"
              class="textarea-featured__foot--item--icon">
              <img class="media__img--icon" [src]="ugc.mediaPath" alt="" />
              <span class="item__overlay">
                <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
              </span>
            </span>
            <span *ngIf="ugc.mediaType == 3" matTooltip="{{ugc?.displayFileName}}"
              class="textarea-featured__foot--item--icon">
              <video class="media__img--icon">
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/m4v" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mp4" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mpeg" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-msvideo" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-ms-wmv" />
                <source [src]="ugc.mediaPath" data-autoplay="false" type="video/avi" />
              </video>
              <span class="item__overlay--video">
                <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                <mat-icon class="play__img--icon">play_circle_outline</mat-icon>
              </span>
            </span>
            <span matTooltip="{{ugc?.displayFileName}}"
              *ngIf="ugc.mediaType == mediaTypeEnum.PDF || ugc.mediaType == mediaTypeEnum.DOC || ugc.mediaType == mediaTypeEnum.EXCEL"
              class="textarea-featured__foot--item--icon">
              <img src="assets/images/common/pdf.png" *ngIf="ugc.mediaType == mediaTypeEnum.PDF"
                class="media__img--icon">
              <img src="assets/images/common/word.png" *ngIf="ugc.mediaType == mediaTypeEnum.DOC"
                class="media__img--icon">
              <img src="assets/images/common/excel-file.png" *ngIf="ugc.mediaType == mediaTypeEnum.EXCEL"
                class="media__img--icon">
              <span class="item__overlay">
                <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
              </span>
            </span>
          </ng-template>
        </div> -->
        <div class="d-flex-items-center g-10 mt-10 flex-wrap__wrap" #attachmentContainer>
          <div #attachmentRef (click)="previewFile(obj,true);$event.stopPropagation()"
            *ngFor="let obj of selectedAttachmentList | slice:0:maximumAttachmentLength ;index as i"
            class="d-flex-items-center pl-2 pr-5 py-2 file-pill" [ngClass]="{'h-30' : defaultLayout}">
            <img [src]="obj.iconUrl" [ngClass]="defaultLayout ? 'w-21' : 'small-image-width'" />
            <!-- <mat-icon *ngIf="obj.mediaType==mediaEnum.PDF"
                                  class="material-icons-outlined colored__red font-size-18 d-flex-items-center justify-content__center">picture_as_pdf</mat-icon>
                                <mat-icon *ngIf="obj.mediaType==mediaEnum.IMAGE"
                                  class="material-icons-outlined colored__purple font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                <img *ngIf="obj.mediaType==mediaEnum.EXCEL" class="w-21" src="assets/icons/excel-icon.svg">
                                <img *ngIf="obj.mediaType==mediaEnum.VIDEO" class="w-21" src="assets/icons/video-icon.svg">
                                <img *ngIf="obj.mediaType==mediaEnum.FILE" class="w-21" src="assets/images/other-attachment.svg" /> -->
            <p class="cursor-pointer" [matTooltip]="obj.fileName.length > 12 ? obj.fileName :''"
              matTooltipClass="custom__tooltip-normal" [ngClass]="{'small_font-size' : !defaultLayout}">{{ obj?.fileName | slice: 0:8 }}{{ obj?.fileName?.length
              > 8 ? '...' : '' }}</p>
            <mat-icon (click)="removeSelectedMedia(obj);$event.stopPropagation()" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
              class="ml-6 s-18 cursor-pointer" fontSet="material-icons-outlined">delete_outline</mat-icon>
          </div>
          <div *ngIf="showMoreAttachment">
            <span class="more-count" *ngIf="remainingAttachmentCount>0" (click)="$event.stopPropagation()"
              [matMenuTriggerFor]="attachmentMore">+{{remainingAttachmentCount}}</span>
            <mat-menu #attachmentMore="matMenu" class="">
              <button mat-menu-item class="d-flex-items-center" (click)="previewFile(obj,true)"
                *ngFor="let obj of selectedAttachmentList | slice:maximumAttachmentLength:selectedAttachmentList.length ;index as i">
                
                <!-- <mat-icon *ngIf="obj.mediaType==mediaEnum.PDF"
                                      class="material-icons-outlined colored__red mr-6 font-size-18 d-flex-items-center justify-content__center">picture_as_pdf</mat-icon>
                                    <mat-icon *ngIf="obj.mediaType==mediaEnum.IMAGE"
                                      class="material-icons-outlined colored__purple mr-6 font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                    <img *ngIf="obj.mediaType==mediaEnum.EXCEL" class="w-21" src="assets/icons/excel-icon.svg">
                                    <img *ngIf="obj.mediaType==mediaEnum.VIDEO" class="w-21" src="assets/icons/video-icon.svg">
                                    <img *ngIf="obj.mediaType==mediaEnum.FILE" class="w-21" src="assets/images/other-attachment.svg" /> -->
                <span class="d-flex-items-center">
                  <img class="w-21 mr-6" [src]="obj.iconUrl" />
                  <span class="more-count__text text__ellipsis" [matTooltip]="obj.fileName.length > 12 ? obj.fileName :''"
                    matTooltipClass="custom__tooltip-normal">
                    {{ obj?.fileName | slice: 0:15 }}{{ obj?.fileName?.length
                    > 15 ? '...' : '' }}</span>
                  <mat-icon (click)="downloadFile(obj.mediaUrl,obj.fileName);$event.stopPropagation()"
                    class="ml-auto mr-0 s-18 cursor-pointer" (click)="removeSelectedMedia(obj);$event.stopPropagation()" fontSet="material-icons-outlined">delete_outline</mat-icon>
                </span>
              </button>
            </mat-menu>
          </div>
          <!-- <div class="d-flex-items-center pl-2 pr-5 py-2 file-pill">
                                              <mat-icon
                                                  class="material-icons-outlined colored__purple font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                              <p>untitled_file.jpg</p>
                                              <mat-icon class="ml-6 s-18 cursor-pointer" fontSet="material-icons-outlined">file_download</mat-icon>
                                          </div>
                                          <div class="d-flex-items-center g-3 pl-2 pr-5 py-4 file-pill">
                                              <img class="w-21" src="assets/icons/excel-icon.svg">
                                              <p>untitled_file.excl</p>
                                              <mat-icon class="ml-6 s-18" fontSet="material-icons-outlined">close</mat-icon>
                                          </div> -->
        </div>
        </ng-container>
        <p *ngIf="caption" class="caption"><b>{{'Caption' | translate}}:</b> {{caption}}</p>

        <!-- <div [ngClass]="{'element__disable' : ssreSimulationRight }" class="textarea-featured__foot--item"
          (click)="openCannedResponse()">
          <a href="javascript:void(0)" class="textarea-featured__foot--boxed">Canned Response</a>
        </div> -->
        <!-- previous mail -->
        <!-- <div fxLayout="row" *ngIf="showPrevoiusMail" class="mt-12">
          <div fxFlex="0 1 calc(100%)" class="d-flex-items-center ">
            <div class="post-reply__prev--mail">
              <div class="post-reply__prev--show">
                <iframe [srcdoc]="emailReplyText | safehtml" frameborder="0"
                  width="100%" height="100%"></iframe>
              </div>
            </div>
          </div>
        </div> -->
        <!-- previous mail -->
        </div>
      </div>
    </div>
    <div class="p-10" *ngIf="selectedTicketView==3 && outsideEmailFlag && !showEscalateview && (emailForward || !onlySendMail) && pageType == pageTypeEnum.TicketHistory">
      <div class="px-10 py-5 border-radius-4 bg__yellow--dark w-100-p d-flex-items-center justify-content__between">
        <div class="d-flex-items-center g-10">
          <mat-icon class="colored-black" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">domain_disabled</mat-icon>
          <div class="d-flex-items-center flex-container__item-wrap" [ngClass]="{'small_font-size' : !defaultLayout}">
            <!-- <p class="font-weight-500 colored-black mr-5">Be cautious about sharing sensitive information.</p> -->
            <p class="colored-black" [ngClass]="{'small_font-size' : !defaultLayout}"><span *ngIf="outsideEmails?.length==1"><span appEmailTruncate [matTooltip]="outsideEmails?.[0]" matTooltipClass="custom-tooltip" [emailId]="outsideEmails?.[0]">{{outsideEmails?.[0]}}</span> wasn't in the original conversation. Please review the content before sharing.</span>
            <span *ngIf="outsideEmails?.length>1"><span appEmailTruncate [matTooltip]="outsideEmails?.[0]" matTooltipClass="custom-tooltip" [emailId]="outsideEmails?.[0]">{{outsideEmails?.[0]}}</span> and <span [matTooltip]="remainingEmailTooltip" matTooltipClass="custom-tooltip" class="text-underline">{{outsideEmails?.length-1}} {{outsideEmails?.length > 2 ? 'others' : 'other'}}</span> {{outsideEmails?.length > 2 ? "weren't" : "wasn't"}} in the original conversation. Please review the content before sharing.</span></p>
          </div>
        </div>
        <mat-icon (click)="outsideEmailFlag=false" class="colored-black cursor-pointer" [ngClass]="{'small-icon-font-size' : !defaultLayout}">close</mat-icon>
      </div>
    </div>
    <div class="post-reply__foot" (click)="checkCcBccEmpty()" [ngClass]="{'p-5' : !defaultLayout}"
    *ngIf="(IsreplyAndEscalate && showEscalateview && !sendtoGroupsClicked && baseMentionObj.channelGroup == channelGroup.Voice) || ( baseMentionObj.channelGroup != channelGroup.Voice)">
      <!-- <div [ngClass]="{'element__disable' : ssreSimulationRight }" class="input__wrapper" *ngIf="replyLinkCheckbox && !showEscalateview
        && !showGroupsView">
                <mat-checkbox *ngFor="let item of replyLinkCheckbox" [checked]="item.checked" [disabled]="item.disabled || ssreSimulationRight ? 'true' : null" [value]="item.replyLinkId" (change)="onReplyLinkChange($event,item.name)">{{item.name}}</mat-checkbox>
            </div> -->
      <!-- <div class="input__wrapper">
        <mat-checkbox>Send as DM</mat-checkbox>
      </div> -->
      <!-- <div *ngIf="showEscalateview" class="input__wrapper">
        <mat-checkbox>Send to Groups</mat-checkbox>
      </div> -->
      <!-- <div class="input__wrapper">
        <mat-checkbox>Send For Approval</mat-checkbox>
      </div> -->

      <p class="mb-0" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="escalateMsg">
        <span class="colored__red">*</span>
        {{ 'After-Escalation-Message' | translate }}
      </p>
      <div class="send-email__foot--option d-flex-items-center ml-auto right-auto" [ngClass]="{'fxFlex':selectedTicketView != 1}">
          <!-- post reply options -->
          <div *ngIf="selectedTicketView == 3 && baseMentionObj.channelGroup==channelGroup.Email && isEmailChannel && showEmailView" class="d-flex-items-center mt-10 w-auto">
            <a [ngClass]="{ element__disable: ssreSimulationRight }" class="mr-15 ml-7" href="javascript:void(0)"
          (click)="openMediaDialog()" matTooltip="{{ 'Attached-Media' | translate }}" matTooltipClass="custom-tooltip">
          <img src="assets/email/Attached-Media.svg" [ngClass]="{'small-image-width' : !defaultLayout}" alt="">
            </a>
            <!-- <div class="mr-15 cursor-pointer" matTooltip="Format" matTooltipClass="custom-tooltip">
              <img src="assets/email/Format.svg" alt="">
            </div> -->
            <div class="mr-15 cursor-pointer">
            <ng-container
              *ngIf="showAiFeature && loadAiFeature && isRephraseToolbar && !this.showAICreditExpired; else otherRephraseIcon">
              <img [src]="AIFeatureStyleObj?.rephraseIcon" class="cursor-pointer"
                [ngClass]="{'element__disable': !emailReplyText && emailReplyText.length <= 0, 'small-image-width': !defaultLayout}"
                (click)="setSelectText( false, true); $event.stopPropagation(); openRephrasePopup(0);" id="rephrase_0"
                [matTooltip]="AIFeatureStyleObj?.rephraseTootip" [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip"
                matTooltipClass="custom-tooltip">
            </ng-container>
            <ng-template #otherRephraseIcon>
              <img [src]="AIFeatureStyleObj?.rephraseIcon" [matTooltip]="AIFeatureStyleObj?.rephraseTootip"
                [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip" [ngClass]="{'small-image-width' : !defaultLayout}" matTooltipClass="custom-tooltip">
            </ng-template>
            </div>
            <div class="d-flex-items-center mr-15">
              <ng-container *ngIf="AIFeatureStyleObj?.suggestIcon">
                <ng-container
                  *ngIf="showAiFeature && rephraseOptions?.isAISuggestion && loadAiFeature && !this.showAICreditExpired; else otherSuggestIcon">
                  <div [ngClass]="{ element__disable: aiSuggestionLoader}"
                    (click)="openAISmartSuggestion($event)">
                    <a href="javascript:void(0)" [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                      [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip" [matMenuTriggerFor]="showLockStrip ? '' :menu">
                      <img [src]="AIFeatureStyleObj?.suggestIcon" [ngClass]="{'small-image-width' : !defaultLayout}">
                      <!-- <img [src]="AIFeatureStyleObj?.suggestIcon"> -->
                    </a>
                  </div>
                </ng-container>
                <ng-template #otherSuggestIcon>
                    <a href="javascript:void(0)"[matTooltip]="AIFeatureStyleObj?.suggestTootip"
                      [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip">
                      <img [src]="AIFeatureStyleObj?.suggestIcon" [ngClass]="{'small-image-width' : !defaultLayout}">
                      <!-- <img [src]="AIFeatureStyleObj?.suggestIcon"> -->
                    </a>
                </ng-template>
              </ng-container>
            </div>
            <div (click)="openCannedResponse()" class="mr-15 cursor-pointer" matTooltip="{{'Canned-Responses' | translate}}" matTooltipClass="custom-tooltip">
              <img src="assets/email/Canned-Responses.svg" [ngClass]="{'small-image-width' : !defaultLayout}" alt="">
            </div>
            <div class="vertical-line mb-5"></div>
            <!-- <div class=" ml-15 cursor-pointer" matTooltip="Popup" matTooltipClass="custom-tooltip" (click)="openEmailPopUp()">
              <img src="assets/email/Popup.svg" alt="">
            </div> -->
          </div>  
          <div *ngIf="selectedTicketView == 3 && baseMentionObj.channelGroup == channelGroup.Email && isEmailChannel && showEmailView"class="ml-16 mt-2 checkbox-converstion  d-flex-items-center">
            <mat-checkbox *ngFor="let item of replyLinkCheckbox" [checked]="item.checked" [disabled]="
            item.disabled || ssreSimulationRight ? 'true' : null
          " [value]="item.replyLinkId" [ngClass]="{'small_font-size' : !defaultLayout}" (change)="onReplyLinkChange($event,item.name)"><span
            class="text__regular--sm" [ngClass]="{'small_font-size' : !defaultLayout}">{{
            item.name | translate
            }}</span>
          <mat-icon
        matTooltip="{{ 'Authentication-Skipped' | translate }}"
        matTooltipPosition="above" matTooltipClass="custom-tooltip " [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="ml-7"
            *ngIf="item.name=='Send Feedback' && item.checked && !item.disabled && (baseMentionObj.channelType==channelType.DirectMessages || baseMentionObj.channelType==channelType.FBMessages) "
            aria-label="remove_red_eye">
            remove_red_eye</mat-icon>
        </mat-checkbox>
          </div>
        <!-- ends post reply options -->
        <div class="d-flex-items-center g-8 ml-auto">
          <button type="button"
            *ngIf="(IsreplyAndEscalate && showEscalateview && !sendtoGroupsClicked && baseMentionObj.channelGroup == channelGroup.Voice) || ( baseMentionObj.channelGroup != channelGroup.Voice)"
            (click)="closePostReply()" mat-stroked-button class="blank-hoverBtn colored__blue" [ngClass]="{'send-email__cancel--btn':selectedTicketView != 1, 'h-26 w-60 small_font-size' : !defaultLayout}">
            {{'Cancel' | translate}}
          </button>
          <button type="button" [ngClass]="{'small_font-size h-26' : !defaultLayout}" *ngIf="
                    (IsreplyAndEscalate && showEscalateview && !onlyEscalation) ||
                    showGroupsView || (IsreplyAndAssign && showReplyAssignView)
                  " class="blank-hoverBtn" (click)="SetBackClick()" mat-stroked-button class="mr-8 colored__blue blank-hoverBtn">
            {{'Back' | translate}}
          </button>

          <ng-container *ngIf="selectedTicketView == 1">
            <button [ngClass]="{'element__disable': ckEditorLoader || disableSaveButton || disableSendButton || (blackListDisabled && showBlackList) || (groupBlackListDisabled && sendtoGroupsClicked && showBlackList) || ticketData, 'h-26 w-60 small_font-size' : !defaultLayout}" *ngIf="(IsreplyAndEscalate && showEscalateview && !sendtoGroupsClicked) 
                        || ((sendtoGroupsClicked && showGroupsView)  
                        || (!IsreplyAndEscalate && !sendtoGroupsClicked) 
                        && baseMentionObj.channelGroup != channelGroup.Voice) && (!IsreplyAndAssign || ((showReplyAssignView && !sendtoGroupsClicked) || showGroupsView))" type="submit" mat-flat-button color="accent"
              [loading]="actionProcessing" class="circle-animation">
              {{'Send' | translate}} 
            </button>
          </ng-container>

          <ng-container *ngIf="selectedTicketView == 3">
            <button [ngClass]="{'element__disable': ckEditorLoader || disableSaveButton || disableSendButton || (blackListDisabled && showBlackList) || (groupBlackListDisabled && sendtoGroupsClicked && showBlackList) || ticketData, 'h-26 w-60 small_font-size' : !defaultLayout}" *ngIf=" (IsreplyAndEscalate && showEscalateview && !sendtoGroupsClicked) 
                        || ((sendtoGroupsClicked && showGroupsView) 
                        || (!IsreplyAndEscalate && !sendtoGroupsClicked) 
                        && baseMentionObj.channelGroup != channelGroup.Voice) && (!IsreplyAndAssign || ((showReplyAssignView && !sendtoGroupsClicked) || showGroupsView))" type="submit" mat-flat-button color="accent"
              [loading]="actionProcessing" class="circle-animation send-button send-email__send--btn w-50">
              <mat-icon fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="s-22 mr-0 ml-2 mt-3">send</mat-icon>
            </button>
          </ng-container>

          <button *ngIf="
                    (IsreplyAndEscalate &&
                      sendtoGroupsClicked &&
                      showEscalateview &&
                      !showGroupsView) ||
                    (sendtoGroupsClicked && !showGroupsView) ||
                    (IsreplyAndEscalate && !sendtoGroupsClicked && !showEscalateview) || (IsreplyAndAssign && ((!showReplyAssignView && !sendtoGroupsClicked) || (sendtoGroupsClicked && !showGroupsView)))
                  " (click)="SetNextClick()" [ngClass]="{'small_font-size h-26' : !defaultLayout}" type="button" mat-flat-button color="accent">
            {{'Next' | translate}}
          </button>
        </div>
      </div>
    </div>
  </form>
</div>


<mat-menu #menu="matMenu" backdropClass="controlled" class="aiinsertMenu w-622 border-radius-8" yPosition="above" xPosition="after">
  <div class="aiinsertMenu__head bg__grey">
    <div class="d-flex-items-center" (click)="$event.stopPropagation()">
      <img src="assets/images/AI_Icon.svg" class="w-16 mr-3" [ngClass]="{'small-image-width' : !defaultLayout}"/>
      <span class="font-size-12 font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Generate-Response' | translate}}</span>
    </div>
    <mat-icon fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
      (click)="$event.preventDefault(); onCloseDiscardAIResponse();"
      class="s-22 ml-auto right-auto cursor-pointer">
      close</mat-icon>
  </div>
  <div class="aiinsertMenu__body bg__white">
    <div class="aiinsertMenu__body--content" [ngClass]="isAICaution ? 'bg__red02' : ''">
      <div class="body" (click)="$event.stopPropagation()">
        <div class="h-50" *ngIf="rephraseLoader">
          <app-component-loader class="message__line--loader" [postCountTotal]="2"
            [loaderType]="loaderTypeEnum.aiAutoResponse" [rephraseLoader]="true" [emailRephraseLoader]="true">
          </app-component-loader>
        </div>
        <p class="disabled_select" *ngIf="rephraseText && !rephraseLoader" [innerHtml]="rephraseText"></p>
        <ng-container *ngIf="!rephraseText && !rephraseLoader">
          <div class="noData block-center rowSize">
            <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}">error_outline</mat-icon>
            <p [ngClass]="{'small_font-size' : !defaultLayout}">{{'No-Response-Found' | translate}}</p>
          </div>
        </ng-container>
      </div>
      <div class="foot g-15">
        <button mat-flat-button color="accent" class="btn-insert" [ngClass]="{'small_font-size' : !defaultLayout}" [disabled]="rephraseLoader || !rephraseText"
          (click)="aiResponseInsert();$event.preventDefault()">
          {{'Use' | translate}}
        </button>
        <button mat-stroked-button color="accent" [ngClass]="{'small_font-size' : !defaultLayout}" [disabled]="rephraseLoader || !rephraseText"
          (click)="rejectAi();$event.preventDefault()" class="btn-reject" [mat-dialog-close]="true">
          {{'Discard' | translate}}
        </button>
        <span class="text__light--sm text-italic" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="!isAICaution && !rephraseLoader"
          (click)="$event.stopPropagation()"><mat-icon class="mr-5 in_knowledge" [ngClass]="{'small-icon-font-size' : !defaultLayout}">check_circle</mat-icon>{{'Response-Knowledge-Base' | translate}}</span>
        <span class="text__light--sm text-italic" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="isAICaution && !rephraseLoader"
          (click)="$event.stopPropagation()"><mat-icon class="mr-5 out_of_knowledge" [ngClass]="{'small-icon-font-size' : !defaultLayout}">cancel</mat-icon>{{'Response-Outside-Knowledge' | translate}}</span>
        <div class="ml-auto right-auto d-flex-items-center g-12" [ngClass]="{ element__disable: rephraseLoader}" (click)="$event.stopPropagation()">
          <mat-icon *ngIf="aiMessageFeedback == 1" class="s-18 text-green"
            (click)="$event.stopPropagation()" [ngClass]="{'small-icon-font-size' : !defaultLayout}">thumb_up</mat-icon>
          <mat-icon *ngIf="aiMessageFeedback != 1" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="material-icons-outlined s-18 text__light cursor-pointer"
            (click)="aiMessageFeedback = 1;trackAIResponse()">
            thumb_up
          </mat-icon>
          <mat-icon *ngIf="aiMessageFeedback != 0" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="material-icons-outlined s-18 text__light cursor-pointer"
            (click)="rejectAi(true)">
            thumb_down
          </mat-icon>
          <mat-icon *ngIf="aiMessageFeedback == 0" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
            class="material-icons-outlined s-18 colored__red--dark cursor-pointer" (click)="rejectAi(true)">
            thumb_down
          </mat-icon>
        </div>
      </div>
    </div>
  </div>
  <div class="aiinsertMenu__foot bg__white" *ngIf="rephraseText" (click)="$event.stopPropagation()">
    <app-rephrase class="rephrase" [aiAutoResponse]="true" [rephraseOptions]="rephraseOptions"></app-rephrase>
  </div>
</mat-menu>
