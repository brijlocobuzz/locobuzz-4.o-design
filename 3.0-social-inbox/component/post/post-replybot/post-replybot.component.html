<!-- [@scaleInOut] -->
<!-- add this class for full screen "expand" -->
<!-- add this class for minimize screen "minimize" -->

<div class="post-replybot__dialog" [ngClass]="{'expand': maximize && !hideMaximizeView,'expand__content':!maximize && !hideMaximizeView,'minimize':hideMaximizeView}">
    <div *ngIf="!templateFlag" class="post-replybot__head">
        <div class="post-replybot__head--channels justify-content__between" [ngClass]="{'py-4 px-10' : !defaultLayout}">
            <span class="text__label text-ellipsis" [ngClass]="{'small_font-size' : !defaultLayout}">
                {{pageData.isForward ? ('FW:' | translate) : ('Re:' | translate)}} {{pageData?.ticketHistoryData?.title || ('No-Subject' | translate)}}</span>
            <div class="post-replybot__head--actions d-flex-items-center g-10">
                <mat-icon (click)="hideMaximizeView=!hideMaximizeView;hideReplyView()" class="cursor-pointer"
                    [matTooltip]="!hideMaximizeView ? ('Minimize' | translate) : ('Maximize' | translate)" matTooltipPosition="below"
                    [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">remove</mat-icon>
                <mat-icon *ngIf="maximize" (click)="toogleMinimizeView();hideMaximizeView=false;emailMaxLength=1"
                    class="cursor-pointer" [matTooltip]="'Exit-Full-Screen' | translate" matTooltipPosition="below" matTooltipClass="custom-tooltip"
                    [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">close_fullscreen</mat-icon>
                <mat-icon *ngIf="!maximize" (click)="toogleMinimizeView();hideMaximizeView=false;emailMaxLength=2"
                    class="cursor-pointer" [matTooltip]="'Full-Screen' | translate" matTooltipPosition="below" matTooltipClass="custom-tooltip"
                    [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">open_in_full</mat-icon>
                <a href="javascript:void(0)" matTooltip="{{'Close' | translate}}" matTooltipPosition="below"
                    matTooltipClass="custom-tooltip" (click)="onClose()">
                    <mat-icon fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">close</mat-icon>
                </a>
            </div>
        </div>
    </div>
    <div class="post-replybot__content expand__content">
        <div class="post-replybot__block expand__block"
            [ngStyle]="{'height': pageData.selectedMedia.length > 0 ? 'calc(100vh - 290px)' : 'calc(100vh - 290px)'}">
            <div class="d-flex-items-center g-10 mb-10">
                <!-- reply type selections -->
                <ng-container *ngIf="pageData?.reply?.options.length > 0">
                    <span class="email-reply no-wrap blue-pill border-radius-16" [matMenuTriggerFor]="replyTypeOptions"
                        [ngClass]="defaultLayout ? 'px-10 py-2' : 'd-flex-items-center small_font-size pl-8 pr-5'">
                        <span class="font-weight-600 colored__main--text mr-4">{{'Reply-Type' | translate}}:</span>
                        <span class="colored__locobuzz text__ellipsis" [ngClass]="{'w-110' : defaultLayout, 'small_font-size' : !defaultLayout}">{{pageData?.reply?.value?.value}}</span>
                        <mat-icon [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                        class="cursor-pointer" fontSet="material-icons-outlined">expand_more</mat-icon>
                    </span>
                    <mat-menu #replyTypeOptions="matMenu" class="w-312">
                        <ng-container *ngFor="let item of pageData?.reply?.options || []">
                            <ng-container *ngIf="item.id == 5 && currentUser?.data?.user?.actionButton?.ticketEscalationEnabled">
                                <button mat-menu-item (click)="onChange('replyType', item)" [ngClass]="{'small_font-size h-25' : !defaultLayout}">{{item.value | translate}}</button>
                            </ng-container>
                
                            <ng-container
                                *ngIf="item.id == 18 && (currentUser?.data?.user?.actionButton?.assignmentEnabled || currentUser?.data?.user?.actionButton?.allowAssignment)">
                                <button mat-menu-item (click)="onChange('replyType', item)" [ngClass]="{'small_font-size h-25' : !defaultLayout}">{{item.value | translate}}</button>
                            </ng-container>
                
                            <ng-container *ngIf="item.id != 5 && item.id != 18 ">
                                <button mat-menu-item (click)="onChange('replyType', item)" [ngClass]="{'small_font-size h-25' : !defaultLayout}">{{item.value | translate}}</button>
                            </ng-container>
                        </ng-container>
                    </mat-menu>
                </ng-container>
                <!-- reply type selections -->
                
                <!-- `dle selections -->
                <!-- only for forward -->
                <ng-container *ngIf="pageData.isForward && pageData?.handle?.options.length > 0">
                    <span class="email-reply no-wrap blue-pill border-radius-16" [matMenuTriggerFor]="replyHandleOptions"
                        [ngClass]="defaultLayout ? 'px-10 py-2' : 'small_font-size pl-8 pr-5 d-flex-items-center'">
                        <span class="font-weight-600 colored__main--text mr-4">{{'Reply-Handle' | translate}}:</span>
                        <span class="colored__locobuzz" [ngClass]="{'small_font-size' : !defaultLayout}"> {{pageData?.handle?.value}} </span>
                        <mat-icon [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                        class="cursor-pointer" fontSet="material-icons-outlined">expand_more</mat-icon>
                    </span>
                    <mat-menu #replyHandleOptions="matMenu">
                        <ng-container *ngFor="let item of pageData?.handle?.options || []">
                            <button mat-menu-item (click)="onChange('replyHandle', item)" [ngClass]="{'small_font-size h-25' : !defaultLayout}">{{item.socialId}}</button>
                        </ng-container>
                    </mat-menu>
                </ng-container>
                
                <!-- only for reply -->
                <span class="email-id" *ngIf="!pageData.isForward && pageData?.handle?.value?.length > 0">
                    <span class="email-reply no-wrap blue-pill px-10 py-6 border-radius-16">
                        <span class="font-weight-600 colored__main--text mr-4" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Reply-Handle' | translate}}: </span>
                        <span class="colored__locobuzz" [ngClass]="{'small_font-size' : !defaultLayout}">{{pageData?.handle?.value}}</span>
                    </span>
                </span>
                <!-- reply handle selections -->
                
                <!-- subject selection -->
                <span class="email-id w-100-p" [ngClass]="{'ml-0': templateFlag}"
                    *ngIf="(pageData?.isForward && !pageData?.emails?.isSameThred) || templateFlag">
                    <span
                        class="email-input position-relative grey-pill w-100-p subject-pill border-radius-4 h-30 px-10 py-5 d-flex-items-center g-10"
                        [ngClass]="{'w-100-p': templateFlag}">
                        <span class="font-weight-600" [ngClass]="{'font-size-14': templateFlag}">{{'Subject' | translate}}: </span>
                        <input class="w-100-p text__ellipsis p-0 bg-inherit" [ngClass]="{'w-89-p': templateFlag}"
                            placeholder="{{'Enter-Subject' | translate}}" autocomplete="off" [(ngModel)]="pageData.emails.subject"
                            (input)="pageData.ticketHistoryData.title=pageData.emails.subject" />
                        <!-- <mat-form-field appearance="outline">
                                                    <input matInput placeholder="Enter Subject" autocomplete="off"
                                                    [(ngModel)]="pageData.emails.subject">
                                                </mat-form-field> -->
                    </span>
                </span>
                <mat-divider class="mb-12" *ngIf="templateFlag"></mat-divider>
            </div>
            
        
            <div cdkDropListGroup>
                <div class="send-email__item--option send-email__item--option--email-height">
                    <span class="email-id" style="align-items: baseline;">
                        <label class="d-flex-items-center font-weight-600 pl-12" [ngClass]="{ 'w-78' : !pageData.isForward, 'w-90' : pageData.isForward }">
                            <span *ngIf="!templateFlag">{{pageData.isForward ? ('Forward-To' | translate) : ('Reply-To' | translate)}}</span>
                            <span *ngIf="templateFlag">{{'To' | translate}}</span>
                        </label>
                        <div class="chip-container w-95-p" [ngClass]="{'w-92-p': templateFlag}"
                            (keydown)="handleKeyboardEvent($event,pageData?.emails?.to?.value,'to')"
                            (keyup)="onParentKeyup($event)">
                            <mat-form-field appearance="outline" class="material__select input-email to_tag_input no-outline">
                                <mat-chip-grid #toEmailChip cdkDropList cdkDropListOrientation="horizontal"
                                    [cdkDropListData]="pageData?.emails?.to?.value"
                                    (cdkDropListDropped)="reorderDroppedItem($event,'to')" id="to">
                                    <mat-chip-row class="grey-pill" *ngFor="let mail of pageData?.emails?.to?.value | slice:0:emailMaxLength"
                                        [selectable]="true" [removable]="removable" cdkDrag [cdkDragData]="selectedChips['to']?.length >0 ? selectedChips['to'] : mail"
                                        (removed)="removeEmailPill(mail, 'to')" (keydown)="handleCtrlKey($event,pageData?.emails?.to?.value,'to')" (click)="selectChip($event,mail,'to')"
                                        [class.selected]="selectedChips['to']?.includes(mail)"
                                        [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag, 'py-0 h-25' : !defaultLayout}">
                                        <!-- <span class="font-weight-600">To: </span>&nbsp; -->
                                    <div class="d-flex-items-center g-10">
                                        <div *ngIf="!tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag" class="w-23 h-23 bg__yellow--dark border-round">
                                            <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                        </div>
                                        <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                                        [matTooltip]="mail" [ngClass]="{'small_font-size' : !defaultLayout}">{{ mail }}</span>
                                        <mat-icon matChipRemove *ngIf="removable" class="p-0 mt-1"
                                        [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">cancel</mat-icon>
                                    </div>
                                    </mat-chip-row>
                                    <ng-container *ngIf="pageData?.emails?.to?.value?.length>emailMaxLength">
                                        <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                                            [matMenuTriggerFor]="moreProfiles">
                                            <p>+{{pageData?.emails?.to?.value?.slice(emailMaxLength)?.length}}</p>
                                        </div>
                                        <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-300" style="max-height: 220px;min-height: auto !important;">
                                            <div class="more-profiles-container flex-direction-column g-10 p-10">
                                                <div *ngFor="let mail of pageData?.emails?.to?.value | slice:emailMaxLength:pageData?.emails?.to?.value.length;"
                                                    [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag, 'grey-pill': tempAllGroupEmailList?.includes(mail) || templateFlag}"
                                                    class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between bg__grey--lighter border__light-grey">
                                                    <div class="d-flex-items-center g-5">
                                                        <div *ngIf="!tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag" [ngClass]="{'bg__yellow--dark': !tempAllGroupEmailList?.includes(mail) && ticketHistoryFlag}"
                                                            class="w-23 h-23 border-round">
                                                            <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                                        </div>
                                                        <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                                                        [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail" class="colored__main--text">{{mail}}</p>
                                                    </div>
                                                    <mat-icon (click)="removeEmailPill(mail, 'to')" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}"
                                                        class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                                                </div>
                                            </div>
                                        </mat-menu>
                                    </ng-container>
                                    <input #toInputRef [ngClass]="{'small_font-size' : !defaultLayout}" placeholder="{{'New-To-Email' | translate}}..." [matChipInputFor]="toEmailChip"
                                        [matAutocomplete]="autoEmailTo" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                        (matChipInputTokenEnd)="addEmailPill($event, 'to')" 
                                        (input)="sendAlert?onInputProfiles(toInputRef.value):onInput($event,'to')" (click)="selectedChips['to'] = []" (keydown.enter)="sendAlert?onInputProfiles(toInputRef.value):onInput($event,'to')"/>
                                    <mat-autocomplete #autoEmailTo="matAutocomplete"
                                        (optionSelected)="addEmailOptionList($event, 'to',toInputRef)">
                                        <ng-container *ngIf="pageData?.emails?.groupSuggestion?.length > 0 && inputRecvd['to']">
                                            <p class="toEmailGroupLabel font-weight-600 p-5 ml-10" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Email-Groups' | translate}}
                                            </p>
                                            <mat-option class="h-30" *ngFor="let email of pageData?.emails?.groupSuggestion"
                                                [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                                                {{ email?.groupName }}
                                            </mat-option>
                                        </ng-container>
                                        <mat-divider></mat-divider>
                                        <ng-container *ngIf="pageData?.emails?.suggestion?.length > 0 && inputRecvd['to']">
                                            <p class="toEmailGroupLabel font-weight-600 p-5 ml-10" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Emails' | translate}}</p>
                                            <mat-option class="h-30" *ngFor="let email of pageData?.emails?.suggestion"
                                                [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                                                {{ email }}
                                            </mat-option>
                                        </ng-container>
                                        <ng-container *ngIf="templateFlag">
                                                    <ng-container *ngIf="emaillocationAttributes?.length > 0">
                                                        <p class="toEmailGroupLabel font-weight-600 p-5 ml-10">{{'Location-Profile' | translate}}</p>
                                                        <mat-option class="h-30" *ngFor="let obj of emaillocationAttributes" [value]="obj.attributeName">
                                                            {{ obj.attributeFriendlyName }}
                                                        </mat-option>
                                                    </ng-container>
                                            <mat-divider></mat-divider>
                                                                    <ng-container *ngIf="agentEmailIds?.length > 0">
                                                                        <p class="toEmailGroupLabel font-weight-600 p-5 ml-10">{{'Recipients-List' | translate}}</p>
                                                                        <mat-option class="h-30" *ngFor="let email of agentEmailIds" [value]="email">
                                                                            {{ email }}
                                                                        </mat-option>
                                                                    </ng-container>
                                        </ng-container>
                                    </mat-autocomplete>
                                </mat-chip-grid>
                                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                                    <a href="javascript:void(0)" class="mr-8" [ngClass]="{'medium-font-size' : !defaultLayout}"
                                        *ngIf="!isCcEmailShow" (click)="isCcEmailShow = true">+{{'Cc' | translate}}</a>
                                    <a href="javascript:void(0)" class="mr-5" [ngClass]="{'medium-font-size' : !defaultLayout}"
                                        *ngIf="!isBccEmailShow" (click)="isBccEmailShow = true">+{{'Bcc' | translate}}</a>
                                </span>
                            </mat-form-field>
                        </div>
                    </span>
                </div>
        
                <!-- <mat-divider class="mb-6" *ngIf="isCcEmailShow"></mat-divider> -->
        
                <div class="send-email__item--option send-email__item--option--email-height" *ngIf="isCcEmailShow">
                    <span class="email-id mt-5" style="align-items: baseline;">
                        <label class="d-flex-items-center font-weight-600 pl-12" [ngClass]="{ 'w-78' : !pageData.isForward, 'w-90' : pageData.isForward }">{{'Cc' | translate}}:</label>
                        <div class="chip-container w-95-p" [ngClass]="{'w-92-p': templateFlag}"
                            (keydown)="handleKeyboardEvent($event,pageData?.emails?.cc?.value,'cc')"
                            (keyup)="onParentKeyup($event)">
                            <mat-form-field appearance="outline" class="material__select input-email to_tag_input no-outline">
                                <mat-chip-grid #ccEmailChip cdkDropList cdkDropListOrientation="horizontal"
                                    [cdkDropListData]="pageData?.emails?.cc?.value"
                                    (cdkDropListDropped)="reorderDroppedItem($event,'cc')" id="cc">
                                    <mat-chip-row class="grey-pill" *ngFor="let mail of pageData?.emails?.cc?.value | slice:0:emailMaxLength"
                                        (keydown)="handleCtrlKey($event,pageData?.emails?.cc?.value,'cc')" (click)="selectChip($event,mail,'cc')" [selectable]="true" [removable]="removable" cdkDrag [cdkDragData]="selectedChips['cc']?.length >0 ? selectedChips['cc'] : mail"
                                        (removed)="removeEmailPill(mail, 'cc')"
                                        [class.selected]="selectedChips['cc']?.includes(mail)" [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag}">
                                        <!-- <span class="font-weight-600">Cc: </span>&nbsp; -->
                                        <div class="d-flex-items-center g-10">
                                            <div *ngIf="!tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag" class="w-23 h-23 bg__yellow--dark border-round">
                                                <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                            </div>
                                            <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                                            [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail">{{ mail }}</span>
                                            <mat-icon matChipRemove *ngIf="removable" class="p-0 mt-1"
                                            [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">cancel</mat-icon>
                                        </div>
                                    </mat-chip-row>
                                    <ng-container *ngIf="pageData?.emails?.cc?.value?.length>emailMaxLength">
                                        <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                                            [matMenuTriggerFor]="moreProfiles">
                                            <p>+{{pageData?.emails?.cc?.value?.slice(emailMaxLength)?.length}}</p>
                                        </div>
                                        <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-320">
                                            <div class="more-profiles-container flex-direction-column g-10 p-10">
                                                <div *ngFor="let mail of pageData?.emails?.cc?.value | slice:emailMaxLength:pageData?.emails?.cc?.value.length;" [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag}"
                                                    class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between grey-pill">
                                                    <div class="d-flex-items-center g-5">
                                                        <div *ngIf="!tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag" [ngClass]="{'bg__yellow--dark': !tempAllGroupEmailList?.includes(mail)}"
                                                            class="w-23 h-23  border-round">
                                                            <mat-icon 
                                                                class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                                        </div>
                                                        <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail" class="colored__main--text">{{mail}}</p>
                                                    </div>
                                                    <mat-icon (click)="removeEmailPill(mail, 'cc')"
                                                        class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                                                </div>
                                            </div>
                                        </mat-menu>
                                    </ng-container>
                                    <input [ngClass]="{'small_font-size' : !defaultLayout}" #toInputRef placeholder= "{{'New-Cc-Email' | translate}}..." [matChipInputFor]="ccEmailChip"
                                        [matAutocomplete]="autoEmailCc" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                         (matChipInputTokenEnd)="addEmailPill($event, 'cc')"
                                        (input)="sendAlert?onInputProfiles(toInputRef.value):onInput($event,'cc')" (click)="selectedChips['cc'] = []" (keydown.enter)="sendAlert?onInputProfiles(toInputRef.value):onInput($event,'cc')"/>
                                    <mat-autocomplete #autoEmailCc="matAutocomplete"
                                        (optionSelected)="addEmailOptionList($event, 'cc',toInputRef)">
                                        <ng-container *ngIf="pageData?.emails?.groupSuggestion?.length > 0 && inputRecvd['cc']">
                                            <p class="toEmailGroupLabel font-weight-600 p-5 ml-10" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Email-Groups' | translate}}
                                            </p>
                                            <mat-option class="h-30" *ngFor="let email of pageData?.emails?.groupSuggestion"
                                                [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                                                {{ email?.groupName }}
                                            </mat-option>
                                        </ng-container>
                                        <mat-divider></mat-divider>
                                        <ng-container *ngIf="pageData?.emails?.suggestion?.length > 0 && inputRecvd['cc']">
                                            <p class="toEmailGroupLabel font-weight-600 p-5 ml-10" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Emails' | translate}}</p>
                                            <mat-option class="h-30" *ngFor="let email of pageData?.emails?.suggestion"
                                                [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                                                {{ email }}
                                            </mat-option>
                                        </ng-container>
                                        <ng-container *ngIf="templateFlag">
                                            <ng-container *ngIf="emaillocationAttributes?.length > 0">
                                                <p class="toEmailGroupLabel font-weight-600 p-5 ml-10">{{'Location-Profile' | translate}}</p>
                                                <mat-option class="h-30" *ngFor="let obj of emaillocationAttributes" [value]="obj.attributeName">
                                                    {{ obj.attributeFriendlyName }}
                                                </mat-option>
                                            </ng-container>
                                            <mat-divider></mat-divider>
                                            <ng-container *ngIf="agentEmailIds?.length > 0 ">
                                                <p class="toEmailGroupLabel font-weight-600 p-5 ml-10">{{'Recipients-List' | translate}}</p>
                                                <mat-option class="h-30" *ngFor="let email of agentEmailIds" [value]="email">
                                                    {{ email }}
                                                </mat-option>
                                            </ng-container>
                                        </ng-container>
                                    </mat-autocomplete>
                                </mat-chip-grid>
                                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                                    <a href="javascript:void(0)" class="mr-8" [ngClass]="{'medium-font-size' : !defaultLayout}"
                                        (click)="isCcEmailShow = false">-{{'Cc' | translate}}</a>
                                </span>
                            </mat-form-field>
                        </div>
                    </span>
                </div>
        
                <!-- <mat-divider class="mb-6" *ngIf="isBccEmailShow"></mat-divider> -->
        
                <div class="send-email__item--option send-email__item--option--email-height" *ngIf="isBccEmailShow">
                    <span class="email-id mt-5" style="align-items: baseline;">
                        <label class="d-flex-items-center font-weight-600 pl-12" [ngClass]="{ 'w-78' : !pageData.isForward, 'w-90' : pageData.isForward }">{{'Bcc' | translate}}:</label>
                        <div class="chip-container w-95-p" [ngClass]="{'w-91-p': templateFlag}"
                            (keydown)="handleKeyboardEvent($event,pageData?.emails?.bcc?.value,'bcc')"
                            (keyup)="onParentKeyup($event)">
                            <mat-form-field appearance="outline" class="material__select input-email to_tag_input no-outline">
                                <mat-chip-grid #bccEmailChip cdkDropList cdkDropListOrientation="horizontal"
                                    [cdkDropListData]="pageData?.emails?.bcc?.value"
                                    (cdkDropListDropped)="reorderDroppedItem($event,'bcc')" id="bcc">
                                    <mat-chip-row class="grey-pill" *ngFor="let mail of pageData?.emails?.bcc?.value | slice:0:emailMaxLength"
                                        [selectable]="true" [removable]="removable" cdkDrag [cdkDragData]="selectedChips['bcc']?.length >0 ? selectedChips['bcc'] : mail"
                                        (removed)="removeEmailPill(mail, 'bcc')" (keydown)="handleCtrlKey($pageData?.emails?.bcc?.value,'bcc')" (click)="selectChip($event,mail,'bcc')"
                                        [class.selected]="selectedChips['bcc']?.includes(mail)" [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag}">
                                        <!-- <span class="font-weight-600">Bcc: </span>&nbsp; -->
                                        <div class="d-flex-items-center g-10">
                                            <div *ngIf="!tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag" class="w-23 h-23 bg__yellow--dark border-round">
                                                <mat-icon class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                            </div>
                                            <span class="cursor_move" appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal"
                                            [ngClass]="{'small_font-size' : !defaultLayout}" [matTooltip]="mail">{{ mail }}</span>
                                            <mat-icon matChipRemove *ngIf="removable" class="p-0 mt-1"
                                            [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">cancel</mat-icon>
                                        </div>
                                    </mat-chip-row>
                                    <ng-container *ngIf="pageData?.emails?.bcc?.value?.length>emailMaxLength">
                                        <div class="blue-pill ml-10 w-30 h-30 border-round d-flex-items-center justify-content__center cursor-pointer"
                                            [matMenuTriggerFor]="moreProfiles">
                                            <p>+{{pageData?.emails?.bcc?.value?.slice(emailMaxLength)?.length}}</p>
                                        </div>
                                        <mat-menu #moreProfiles="matMenu" yPosition="above" class="w-320">
                                            <div class="more-profiles-container flex-direction-column g-10 p-10">
                                                <div *ngFor="let mail of pageData?.emails?.bcc?.value | slice:emailMaxLength:pageData?.emails?.bcc?.value.length;"
                                                    [ngClass]="{'yellow-pill border__yellow': !tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag}"
                                                    class="width-fit pl-8 py-2 pr-2 border-radius-16 d-flex-items-center justify-content__between grey-pill">
                                                    <div class="d-flex-items-center g-5">
                                                        <div *ngIf="!tempAllGroupEmailList?.includes(mail) && !templateFlag && ticketHistoryFlag" [ngClass]="{'bg__yellow--dark': !tempAllGroupEmailList?.includes(mail)}"
                                                            class="w-23 h-23  border-round">
                                                            <mat-icon
                                                                class="colored-black font-size-14 d-flex-items-center justify-content__center">domain_disabled</mat-icon>
                                                        </div>
                                                        <p appEmailTruncate [emailId]="mail" matTooltipClass="custom__tooltip-normal" [matTooltip]="mail" class="colored__main--text">{{mail}}</p>
                                                    </div>
                                                    <mat-icon (click)="removeEmailPill(mail, 'bcc')"
                                                        class="cursor-pointer font-size-14 d-flex-items-center justify-content__center colored__main--text">close</mat-icon>
                                                </div>
                                            </div>
                                        </mat-menu>
                                    </ng-container>
                                    <input [ngClass]="{'small_font-size' : !defaultLayout}" #toInputRef placeholder="{{'New-Bcc-Email' | translate}}..." [matChipInputFor]="bccEmailChip"
                                        [matAutocomplete]="autoEmailBcc" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                         (matChipInputTokenEnd)="addEmailPill($event, 'bcc')"
                                        (input)="sendAlert?onInputProfiles(toInputRef.value):onInput($event,'bcc')" (click)="selectedChips['bcc'] = []" (keydown.enter)="sendAlert?onInputProfiles(toInputRef.value):onInput($event,'bcc')"/>
                                    <mat-autocomplete #autoEmailBcc="matAutocomplete"
                                        (optionSelected)="addEmailOptionList($event, 'bcc',toInputRef)">
                                        <ng-container *ngIf="pageData?.emails?.groupSuggestion?.length > 0 && inputRecvd['bcc']">
                                            <p class="toEmailGroupLabel font-weight-600 p-5 ml-10" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Email-Groups' | translate}}
                                            </p>
                                            <mat-option class="h-30" *ngFor="let email of pageData?.emails?.groupSuggestion"
                                                [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                                                {{ email?.groupName }}
                                            </mat-option>
                                        </ng-container>
                                        <mat-divider></mat-divider>
                                        <ng-container *ngIf="pageData?.emails?.suggestion?.length > 0 && inputRecvd['bcc']">
                                            <p class="toEmailGroupLabel font-weight-600 p-5 ml-10" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Suggested-Emails' | translate}}</p>
                                            <mat-option class="h-30" *ngFor="let email of pageData?.emails?.suggestion"
                                                [value]="email" [ngClass]="{'small_font-size' : !defaultLayout}">
                                                {{ email }}
                                            </mat-option>
                                        </ng-container>
                                        <ng-container *ngIf="templateFlag">
                                            <ng-container *ngIf="emaillocationAttributes?.length > 0">
                                                <p class="toEmailGroupLabel font-weight-600 p-5 ml-10">{{'Location-Profile' | translate}}</p>
                                                <mat-option class="h-30" *ngFor="let obj of emaillocationAttributes" [value]="obj.attributeName">
                                                    {{ obj.attributeFriendlyName }}
                                                </mat-option>
                                            </ng-container>
                                            <mat-divider></mat-divider>
                                            <ng-container *ngIf="agentEmailIds?.length > 0">
                                                <p class="toEmailGroupLabel font-weight-600 p-5 ml-10">{{'Recipients-List' | translate}}</p>
                                                <mat-option class="h-30" *ngFor="let email of agentEmailIds" [value]="email">
                                                    {{ email }}
                                                </mat-option>
                                            </ng-container>
                                        </ng-container>
                                    </mat-autocomplete>
                                </mat-chip-grid>
                                <span matSuffix class="d-flex-items-center" class="material__select--suffix">
                                    <a href="javascript:void(0)" class="mr-5" [ngClass]="{'medium-font-size' : !defaultLayout}"
                                        (click)="isBccEmailShow = false">-{{'Bcc' | translate}}</a>
                                </span>
                            </mat-form-field>
                        </div>
                    </span>
                </div>
            </div>
            <div class="mt-10"></div>
            <ckeditor id="ckeditor_emailpop" (ready)="onEditorReady($event)" [config]="config" [(ngModel)]="pageData.emails.replyText"
                [ngClass]="{ 'custom-ck-1' : isCcEmailShow || isBccEmailShow, 'custom-ck-2' : isCcEmailShow && isBccEmailShow, 'custom-ck-0' : !isCcEmailShow && !isBccEmailShow }">
            </ckeditor>
        </div>
        <span class="post-reply__mail--open mr-7 mt-7" matTooltip="{{'Show-trimmed-content' | translate}}"
            matTooltipClass="custom-tooltip" *ngIf="pageData?.emails?.showPrevoiusMail && !templateFlag" (click)="togglePrevMail()">
            <mat-icon fontSet="material-icons-outlined">more_horiz</mat-icon>
        </span>
        <!-- <div *ngIf="mediaSelectedAsync$ | async as MediaSelected" class="textarea-featured__foot--item--media mt-10">
            <ng-template ngFor let-ugc [ngForOf]="MediaSelected">
                <span *ngIf="ugc.mediaType == 2" matTooltip="{{ugc?.displayFileName}}"
                    class="textarea-featured__foot--item--icon textarea-featured__foot--item--icon--email-media">
                    <img class="media__img--icon" [src]="ugc.mediaPath" alt="" />
                    <span class="item__overlay">
                        <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                    </span>
                </span>
                <span *ngIf="ugc.mediaType == 3" matTooltip="{{ugc?.displayFileName}}"
                    class="textarea-featured__foot--item--icon">
                    <video class="media__img--icon">
                        <source [src]="ugc.mediaPath" data-autoplay="false" type="video/m4v" />
                        <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mp4" />
                        <source [src]="ugc.mediaPath" data-autoplay="false" type="video/mpeg" />
                        <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-msvideo" />
                        <source [src]="ugc.mediaPath" data-autoplay="false" type="video/x-ms-wmv" />
                        <source [src]="ugc.mediaPath" data-autoplay="false" type="video/avi" />
                    </video>
                    <span class="item__overlay--video">
                        <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                        <mat-icon class="play__img--icon">play_circle_outline</mat-icon>
                    </span>
                </span>
                <span matTooltip="{{ugc?.displayFileName}}"
                    *ngIf="ugc.mediaType == mediaTypeEnum.PDF || ugc.mediaType == mediaTypeEnum.DOC || ugc.mediaType == mediaTypeEnum.EXCEL"
                    class="textarea-featured__foot--item--icon">
                    <img src="assets/images/common/pdf.png" *ngIf="ugc.mediaType == mediaTypeEnum.PDF"
                        class="media__img--icon">
                    <img src="assets/images/common/word.png" *ngIf="ugc.mediaType == mediaTypeEnum.DOC"
                        class="media__img--icon">
                    <img src="assets/images/common/excel-file.png" *ngIf="ugc.mediaType == mediaTypeEnum.EXCEL"
                        class="media__img--icon">
                    <span class="item__overlay">
                        <mat-icon class="delete__img--icon" (click)="removeSelectedMedia(ugc)">delete_outline</mat-icon>
                    </span>
                </span>
            </ng-template>
        </div> -->
        <div #attachmentContainer class="d-flex-items-center g-10 mt-10">
            <div (click)="previewFile(obj,true);$event.stopPropagation()" #attachmentRef
                *ngFor="let obj of selectedAttachmentList | slice:0:maximumAttachmentLength ;index as i"
                class="d-flex-items-center pl-2 pr-5 py-2 file-pill" [ngClass]="{'h-30' : defaultLayout}">
                <img [src]="obj.iconUrl" [ngClass]="defaultLayout ? 'w-21' : 'small-image-width'" />
                <!-- <mat-icon *ngIf="obj.mediaType==mediaEnum.PDF"
                                                  class="material-icons-outlined colored__red font-size-18 d-flex-items-center justify-content__center">picture_as_pdf</mat-icon>
                                                <mat-icon *ngIf="obj.mediaType==mediaEnum.IMAGE"
                                                  class="material-icons-outlined colored__purple font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                                <img *ngIf="obj.mediaType==mediaEnum.EXCEL" class="w-21" src="assets/icons/excel-icon.svg">
                                                <img *ngIf="obj.mediaType==mediaEnum.VIDEO" class="w-21" src="assets/icons/video-icon.svg">
                                                <img *ngIf="obj.mediaType==mediaEnum.FILE" class="w-21" src="assets/images/other-attachment.svg" /> -->
                <p class="cursor-pointer" [matTooltip]="obj.fileName.length > 12 ? obj.fileName :''"
                    matTooltipClass="custom__tooltip-normal" [ngClass]="{'small_font-size' : !defaultLayout}">{{ obj?.fileName | slice: 0:8 }}{{ obj?.fileName?.length
                    > 8 ? '...' : '' }}</p>
                <mat-icon (click)="removeSelectedMedia(obj);$event.stopPropagation()" class="ml-6 s-18 cursor-pointer"
                    fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">delete_outline</mat-icon>
            </div>
            <div *ngIf="showMoreAttachment">
                <span class="more-count" *ngIf="remainingAttachmentCount>0" (click)="$event.stopPropagation()"
                    [matMenuTriggerFor]="attachmentMore">+{{remainingAttachmentCount}}</span>
                <mat-menu #attachmentMore="matMenu" class="">
                    <button mat-menu-item class="d-flex-items-center" (click)="previewFile(obj,true)"
                        *ngFor="let obj of selectedAttachmentList | slice:maximumAttachmentLength:selectedAttachmentList.length ;index as i">
                        
                        <!-- <mat-icon *ngIf="obj.mediaType==mediaEnum.PDF"
                                                      class="material-icons-outlined colored__red mr-6 font-size-18 d-flex-items-center justify-content__center">picture_as_pdf</mat-icon>
                                                    <mat-icon *ngIf="obj.mediaType==mediaEnum.IMAGE"
                                                      class="material-icons-outlined colored__purple mr-6 font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                                    <img *ngIf="obj.mediaType==mediaEnum.EXCEL" class="w-21" src="assets/icons/excel-icon.svg">
                                                    <img *ngIf="obj.mediaType==mediaEnum.VIDEO" class="w-21" src="assets/icons/video-icon.svg">
                                                    <img *ngIf="obj.mediaType==mediaEnum.FILE" class="w-21" src="assets/images/other-attachment.svg" /> -->
                        <span class="d-flex-items-center">
                            <img class="w-21 mr-6" [src]="obj.iconUrl" />
                            <span class="more-count__text text__ellipsis" [matTooltip]="obj.fileName.length > 12 ? obj.fileName :''"
                                matTooltipClass="custom__tooltip-normal">
                                {{ obj?.fileName | slice: 0:15 }}{{ obj?.fileName?.length
                                > 15 ? '...' : '' }}</span>
                            <mat-icon class="ml-auto mr-0 s-18 cursor-pointer"
                                (click)="removeSelectedMedia(obj);$event.stopPropagation()"
                                fontSet="material-icons-outlined">delete_outline</mat-icon>
                        </span>
                    </button>
                </mat-menu>
            </div>
            <!-- <div class="d-flex-items-center pl-2 pr-5 py-2 file-pill">
                                                              <mat-icon
                                                                  class="material-icons-outlined colored__purple font-size-18 d-flex-items-center justify-content__center">image</mat-icon>
                                                              <p>untitled_file.jpg</p>
                                                              <mat-icon class="ml-6 s-18 cursor-pointer" fontSet="material-icons-outlined">file_download</mat-icon>
                                                          </div>
                                                          <div class="d-flex-items-center g-3 pl-2 pr-5 py-4 file-pill">
                                                              <img class="w-21" src="assets/icons/excel-icon.svg">
                                                              <p>untitled_file.excl</p>
                                                              <mat-icon class="ml-6 s-18" fontSet="material-icons-outlined">close</mat-icon>
                                                          </div> -->
        </div>
        <div class="p-10" *ngIf="outsideEmailFlag && !templateFlag && ticketHistoryFlag">
            <div class="px-10 py-5 border-radius-4 bg__yellow--dark w-100-p d-flex-items-center justify-content__between">
                <div class="d-flex-items-center g-10">
                    <mat-icon class="colored-black" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">domain_disabled</mat-icon>
                    <div class="d-flex-items-center g-5">
                        <p class="colored-black" [ngClass]="{'small_font-size' : !defaultLayout}">
                            <span *ngIf="outsideEmails?.length==1">
                                <span appEmailTruncate [matTooltip]="outsideEmails?.[0]" matTooltipClass="custom-tooltip"
                                    [emailId]="outsideEmails?.[0]">{{outsideEmails?.[0]}}</span> 
                                    {{'was-not-in-original-conversation' | translate}}
                            </span>
                            <span *ngIf="outsideEmails?.length>1"><span appEmailTruncate [matTooltip]="outsideEmails?.[0]"
                                matTooltipClass="custom-tooltip" [emailId]="outsideEmails?.[0]">{{outsideEmails?.[0]}}</span> 
                                {{'and' | translate}}
                                <span [matTooltip]="remainingEmailTooltip" matTooltipClass="custom-tooltip" class="text-underline">{{outsideEmails?.length-1}} {{outsideEmails?.length > 2 ? ('others' | translate) : ('other' | translate)}}</span>
                                {{outsideEmails?.length > 2 ? ("were-not-in-original-conversation" | translate) : ("was-not-in-original-conversation" |translate)}}</span>
                        </p>
                    </div>
                </div>
                <mat-icon (click)="outsideEmailFlag=false" class="colored-black cursor-pointer" [ngClass]="{'small-icon-font-size d-flex-items-center justify-content__center' : !defaultLayout}">close</mat-icon>
            </div>
        </div>
        <div *ngIf="sendAlert" class="sms-box__footer d-flex-items-center">
            <button class="px-10 py-5 cursor-pointer colored__locobuzz" mat-button
                [matMenuTriggerFor]="addAttributes">{{'Add-Attributes' | translate}}
                <mat-menu #addAttributes="matMenu" class="w-200">
                    <button  *ngIf="formSubmissionFlag" class="cursor-pointer" mat-menu-item [matMenuTriggerFor]="fromAttributes">{{'Form-Attributes' | translate}}</button>
                    <button *ngIf="authorAttiributes?.length>0" class="cursor-pointer" mat-menu-item
                        [matMenuTriggerFor]="authorAttributesMenu">Author
                        Attributes</button>
                    <button *ngIf="ticketAttributes?.length>0" class="cursor-pointer" mat-menu-item [matMenuTriggerFor]="ticketAttributesMenu">{{'Ticket-Attributes' | translate}}</button>
                        <button *ngIf="mentionAttributes?.length>0" class="cursor-pointer" mat-menu-item
                            [matMenuTriggerFor]="mentionAttributesMenu">Mention Attributes</button>
                    <button class="cursor-pointer" mat-menu-item [matMenuTriggerFor]="locationProfileAttributesMenu">{{'Location-Attributes' | translate}}</button>
                </mat-menu>
                <mat-menu #fromAttributes="matMenu" class="mat-height">
                    <!-- <div class="sticky-top sticky-top__ticketbrand p-10 pb-0">
                        <mat-form-field color="accent" class="material__input mb-12 h-50 input-dark" appearance="outline">
                            <mat-label>Location</mat-label>
                            <input (click)="$event.stopPropagation()" #inputSearch type="text" aria-label="Number" matInput />
                            <mat-icon matSuffix fontSet="material-icons-outlined">search</mat-icon>
                        </mat-form-field>
                    </div> -->
                    <p class="font-weight-600 ml-10 mb-5" *ngIf="questionList?.length>0">{{'Questions' | translate}}</p>
                    <button mat-menu-item class="cursor-pointer" matTooltipClass="custom__tooltip-normal"
                        [matTooltip]="item?.length > 16 ? item : ''" (click)="insertQuestionListPlaceholder(item,true)"
                        *ngFor="let item of questionList">
                        <span class="font-weight-600 mr-3">Q.</span>{{ item?.length > 16 ? item.slice(0, 16) + '...' : item }}
                    </button>
                    <p class="font-weight-600 ml-10 mb-5" *ngIf="formAttributes?.length>0">{{'Data-Attributes' | translate}}</p>
                    <button mat-menu-item class="cursor-pointer" (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of formAttributes">{{item.AttributeFriendlyName}}</button>                    
                    <!-- <mat-checkbox>From Attributes</mat-checkbox>
                                                                    <mat-checkbox>From Attributes</mat-checkbox> -->
                    <!-- <button mat-menu-item> <span class="font-weight-600">Q</span> test</button> -->
                </mat-menu>
                <mat-menu #locationProfileAttributesMenu="matMenu" class="mat-height">
                    <!-- <div class="sticky-top sticky-top__ticketbrand p-10 pb-0">
                        <mat-form-field color="accent" class="material__input mb-12 h-50 input-dark" appearance="outline">
                            <mat-label>Location</mat-label>
                            <input (click)="$event.stopPropagation()" #inputSearch type="text"
                                aria-label="Number" matInput/>
                            <mat-icon matSuffix fontSet="material-icons-outlined">search</mat-icon>
                        </mat-form-field>    
                    </div> -->
                    <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="defaultLocationProfiles?.length>0">{{'Default-Attributes' | translate}}</p>
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of defaultLocationProfiles">{{item.AttributeFriendlyName}}</button>
                    <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="customLocationProfiles?.length>0">{{'Custom-Attributes' | translate}}</p>
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.attributeName,true)"
                        *ngFor="let item of customLocationProfiles">{{item.attributeFriendlyName}}</button>
                </mat-menu>
                <mat-menu #ticketAttributesMenu="matMenu" class="mat-height">
                    <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="defaultLocationProfiles?.length>0">{{'Default-Attributes' | translate}}</p>
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of ticketAttributes">{{item.AttributeFriendlyName}}</button>
                </mat-menu>
                <mat-menu #authorAttributesMenu="matMenu" class="mat-height">
                    <!-- <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="defaultLocationProfiles?.length>0">Default Attributes</p> -->
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of authorAttiributes">{{item.AttributeFriendlyName}}</button>
                </mat-menu>
                <mat-menu #mentionAttributesMenu="matMenu" class="mat-height">
                    <!-- <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="defaultLocationProfiles?.length>0">Default Attributes</p> -->
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of mentionAttributes">{{item.AttributeFriendlyName}}</button>
                </mat-menu>
                <mat-menu #authorAttributesMenu="matMenu" class="mat-height">
                    <!-- <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="defaultLocationProfiles?.length>0">Default Attributes</p> -->
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of authorAttiributes">{{item.AttributeFriendlyName}}</button>
                </mat-menu>
                <mat-menu #mentionAttributesMenu="matMenu" class="mat-height">
                    <!-- <p class="font-weight-600 ml-10 mt-5 mb-5" *ngIf="defaultLocationProfiles?.length>0">Default Attributes</p> -->
                    <button class="cursor-pointer" mat-menu-item (click)="insertPlaceholder(item.AttributeName,true)"
                        *ngFor="let item of mentionAttributes">{{item.AttributeFriendlyName}}</button>
                </mat-menu>
            </button>
            <button *ngIf="emailTemplatesList?.length > 0" class="px-10 py-5 cursor-pointer colored__locobuzz" mat-button [matMenuTriggerFor]="workflowTemplate">Select Template</button>
            <mat-menu class="template-popup-panel" #workflowTemplate="matMenu">
                <div class="template-popup">
                    <div class="template-title">
                        <p class="font-weight-500">Select Template</p>
                        <p class="font-size-12">Choose from pre-built alert templates</p>
                    </div>
                    <div class="template-container">
                        <div *ngFor="let item of emailTemplatesList" class="workflow-template" (click)="selectTemplate(item)">
                            <img [src]="item.TemplateIcon" class="w-168 h-100 border-radius-4">
                            <p class="font-size-12 font-weight-500">{{item.TemplateName}}</p>
                        </div>
                        <!-- <div class="workflow-template" (click)="setTemplate('Influencer Alert Template')">
                            <img src="assets/images/workflow/influencer-alert.jpg" class="w-168 h-100 border-radius-4">
                            <p class="font-size-12 font-weight-500">Influencer Alert Template</p>
                        </div>
                        <div class="workflow-template" (click)="setTemplate('Location-Level Alert Template')">
                            <img src="assets/images/workflow/location-alert.jpg" class="w-168 h-100 border-radius-4">
                            <p class="font-size-12 font-weight-500">Location-Level Alert Template</p>
                        </div>
                        <div class="workflow-template" (click)="setTemplate('Generic Ticket Alert Template')">
                            <img src="assets/images/workflow/generic-alert.jpg" class="w-168 h-100 border-radius-4">
                            <p class="font-size-12 font-weight-500">Generic Ticket Alert Template</p>
                        </div> -->
                    </div>
                </div>
            </mat-menu>
        </div>
    </div>
    <div class="send-email__foot--option post-replybot__foot d-flex-items-center position-sticky pl-12 pr-12">
        <!-- post reply options -->
        <div class="d-flex-items-center py-6 w-auto" *ngIf="!templateFlag">
            <ng-container *ngIf="!pageData.isForward">
                <ng-container *ngIf="!templateFlag">
                <ng-container *ngIf="pageData?.isRephresEnabled else otherRephraseIcon">
                    <img [src]="AIFeatureStyleObj?.rephraseIcon" id="rephrase_emailpop_0" class="cursor-pointer w-18"
                        [ngClass]="{'element__disable': !pageData?.emails?.replyText && pageData?.emails?.replyText?.length <= 0}"
                        [matTooltip]="AIFeatureStyleObj?.rephraseTootip"
                        [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip" matTooltipClass="custom-tooltip"
                        (click)="setSelectText( false, true); $event.stopPropagation(); openRephrasePopup(0);">
                </ng-container>
                <ng-template #otherRephraseIcon>
                    <img class="w-18" [src]="AIFeatureStyleObj?.rephraseIcon"
                        [matTooltip]="AIFeatureStyleObj?.rephraseTootip"
                        [matTooltipDisabled]="!AIFeatureStyleObj?.rephraseTootip" matTooltipClass="custom-tooltip">
                </ng-template>
                </ng-container>

                <ng-container *ngIf="!templateFlag">
                <ng-container *ngIf="pageData?.isSmartSuggestionEnabled else otherSuggestIcon">
                    <img [src]="AIFeatureStyleObj?.suggestIcon" class="cursor-pointer aiSmartSuggesionMenu ml-13 w-20"
                        [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                        [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip"
                        [matMenuTriggerFor]="pageData?.showLockStrip ? '' :menu" (menuOpened)="validate()"
                        (menuClosed)="removeCloneBackdrop()"
                        (click)="openAISmartSuggestion($event); aiMessageFeedback = 2" />
                </ng-container>
                <ng-template #otherSuggestIcon>
                    <img class="w-20" [src]="AIFeatureStyleObj?.suggestIcon" class="cursor-pointer ml-13"
                        [matTooltip]="AIFeatureStyleObj?.suggestTootip"
                        [matTooltipDisabled]="!AIFeatureStyleObj?.suggestTootip" matTooltipClass="custom-tooltip" />
                </ng-template>
                </ng-container>

                <a class="mr-5 h-19 ml-12" href="javascript:void(0)" (click)="templateFlag?openTemplateCannedResponse():openCannedResponse()"
                    matTooltip="{{'Canned-Response' | translate}}" matTooltipClass="custom-tooltip">
                    <img src="assets/images/chatbot/canned.svg" alt="{{'Canned-Response' | translate}}">
                </a>
            </ng-container>
            <a *ngIf="!templateFlag" class="mr-5 h-19 ml-12" href="javascript:void(0)" (click)="templateFlag?openNormalEmailMedia():openMediaDialog()" matTooltip="{{'Attach-Media' | translate}}"
                matTooltipClass="custom-tooltip">
                <img src="assets/email/Attached-Media.svg" alt="">
            </a>

            <div *ngIf="!templateFlag" class="vertical-line"></div>
        </div>
        <div class="ml-10 checkbox-converstion d-flex-items-center">
            <ng-container *ngFor="let item of pageData?.replyCheckbox">
                <mat-checkbox
                    *ngIf="(pageData?.reply?.value?.id == ActionStatusEnum?.ReplyAndClose && item?.name == 'Send Feedback') || item.name != 'Send Feedback'"
                    [checked]="item.checked" [disabled]="item.disabled || ssreSimulationRight ? 'true' : null"
                    [value]="item.replyLinkId" (change)="onReplyLinkChange($event, item)">
                    <span class="text__regular--sm">{{ item.name | translate }}</span>
                </mat-checkbox>
            </ng-container>

        </div>
        <!-- ends post reply options -->
        <button *ngIf="!templateFlag" type="button" mat-stroked-button
            class="blank-hoverBtn send-email__cancel--btn ml-auto mr-8 colored__blue" (click)="onClose()">
            {{'Cancel' | translate}}
        </button>
        <!-- <button type="button" class="blank-hoverBtn" mat-stroked-button
                    class="mr-8 colored__blue blank-hoverBtn">
                    Back
                </button> -->
        <!-- <button type="submit" mat-flat-button class="ml-8" color="accent" class="circle-animation send-button send-email__send--btn">
                    send
                </button> -->
        <button *ngIf="!templateFlag" type="button" mat-flat-button class="ml-8" color="accent" (click)="onNext()">
            {{'Next' | translate}}
        </button>
    </div>
</div>

<mat-menu #menu="matMenu" backdropClass="controlled" class="aiinsertMenu w-622 border-radius-8" yPosition="above"
    xPosition="after">
    <div class="aiinsertMenu__head bg__grey">
        <div class="d-flex-items-center" (click)="$event.stopPropagation()">
            <img src="assets/images/AI_Icon.svg" [ngClass]="{'small-image-width' : !defaultLayout}" class="w-16 mr-3" />
            <span class="font-size-12 font-weight-600" [ngClass]="{'small_font-size' : !defaultLayout}">{{'Generate-response' | translate}}</span>
        </div>
        <mat-icon fontSet="material-icons-outlined" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="s-22 ml-auto cursor-pointer"
            (click)="$event.preventDefault(); rephraseLoader = false;aiSuggestionLoader = false">
            close
        </mat-icon>
    </div>
    <div class="aiinsertMenu__body bg__white">
        <div class="aiinsertMenu__body--content" [ngClass]="isAICaution ? 'bg__red02' : ''">
            <div class="body" (click)="$event.stopPropagation()">
                <div class="h-50" *ngIf="rephraseLoader">
                    <app-component-loader class="message__line--loader" [postCountTotal]="2"
                        [loaderType]="loaderTypeEnum.aiAutoResponse" [rephraseLoader]="true"
                        [emailRephraseLoader]="true">
                    </app-component-loader>
                </div>
                <p class="disabled_select" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="rephraseText && !rephraseLoader" [innerHtml]="rephraseText"></p>
                <ng-container *ngIf="!rephraseText && !rephraseLoader">
                    <div class="noData block-center">
                        <mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}">error_outline</mat-icon>
                        <p [ngClass]="{'small_font-size' : !defaultLayout}">{{'No-Response-Found' | translate}}</p>
                    </div>
                </ng-container>
            </div>
            <div class="foot">
                <button mat-flat-button color="accent" [ngClass]="{'small_font-size' : !defaultLayout}" class="btn-insert" [disabled]="rephraseLoader || !rephraseText"
                    (click)="aiResponseInsert();$event.preventDefault()">
                    {{'Use' | translate}}
                </button>
                <button mat-stroked-button color="accent" [ngClass]="{'small_font-size' : !defaultLayout}" [disabled]="rephraseLoader || !rephraseText"
                    (click)="rejectAi();$event.preventDefault()" class="btn-reject" [mat-dialog-close]="true">
                    {{'Discard' | translate}}
                </button>
                <span class="text__light--sm text-italic ml-17" [ngClass]="{'small_font-size' : !defaultLayout}" *ngIf="!isAICaution && !rephraseLoader"
                    (click)="$event.stopPropagation()"><mat-icon
                        class="mr-5 in_knowledge" [ngClass]="{'small-icon-font-size' : !defaultLayout}">check_circle</mat-icon>{{'Response-from-Knowledge-Base' | translate}}</span>
                <span class="text__light--sm text-italic ml-17" *ngIf="isAICaution && !rephraseLoader"
                    (click)="$event.stopPropagation()" [ngClass]="{'small_font-size' : !defaultLayout}"><mat-icon [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="mr-5 out_of_knowledge">cancel</mat-icon>{{'Response-from-Outside-Knowledge-Base' | translate}}</span>
                <div class="ml-auto" [ngClass]="{ element__disable: rephraseLoader}" (click)="$event.stopPropagation()">
                    <mat-icon *ngIf="aiMessageFeedback == 1" [ngClass]="{'small-icon-font-size' : !defaultLayout}" class="mr-12 s-18 text-green"
                        (click)="$event.stopPropagation()">thumb_up</mat-icon>
                    <mat-icon *ngIf="aiMessageFeedback != 1" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                        class="material-icons-outlined mr-12 s-18 text__light cursor-pointer"
                        (click)="aiMessageFeedback = 1;trackAIResponse()">
                        thumb_up
                    </mat-icon>
                    <mat-icon *ngIf="aiMessageFeedback != 0" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                        class="material-icons-outlined s-18 text__light cursor-pointer" (click)="rejectAi(true)">
                        thumb_down
                    </mat-icon>
                    <mat-icon *ngIf="aiMessageFeedback == 0" [ngClass]="{'small-icon-font-size' : !defaultLayout}"
                        class="material-icons-outlined s-18 colored__red--dark cursor-pointer" (click)="rejectAi(true)">
                        thumb_down
                    </mat-icon>
                </div>
            </div>
        </div>
    </div>
    <div class="aiinsertMenu__foot bg__white" *ngIf="rephraseText" (click)="$event.stopPropagation()">
        <app-rephrase class="rephrase" [isFromEmailPopUp]="true" [aiAutoResponse]="true"
            [rephraseOptions]="rephraseOptions"></app-rephrase>
    </div>
</mat-menu>